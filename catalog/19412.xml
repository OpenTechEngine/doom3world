<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="19412"><title>sprites with Normalmaps and Alpha channels</title><posts><post id="p177213" date="Posted: Tue May 01, 2007 2:21 pm "><author>mikebart</author><body><![CDATA[<div class="postbody">I'd like to get sprites in to work in quake4 for foliage like the ES: oblivion trees.&#13;<br />The material includes diffuse, specular and a normal map aswell as the alpha channel.&#13;<br />Does anyone know of an existing shader in quake4 or doom3 that does this?</div>]]></body></post><post id="p177593" date="Posted: Mon May 07, 2007 1:13 am "><author>mikebart</author><body><![CDATA[<div class="postbody">I think that description might have been a bit vague so ill try again:&#13;<br /><br />Ive been trying to get an alphatested shader with a specular and a normalmap for foliage on trees to work in quake4.&#13;<br /><br />This is the shader im using:&#13;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">models/nature/tree_foliage01<br />{<br />   deform sprite<br />    noShadows<br />   nonsolid<br />   noimpact<br />   twoSided<br /><br />   qer_editorimage models/nature/tree_foliage01_d.tga<br />   <br />   {       <br />          blend   diffusemap<br />    map   models/nature/tree_foliage01_d.tga<br />    alphaTest 0.5<br />   }<br />}</div>&#13;<br /><br />This is what im getting:&#13;<br /><a href="https://web.archive.org/web/20070509181516/http://img244.imageshack.us/my.php?image=trees5hq3.jpg" class="postlink">[image]http://img244.imageshack.us/img244/3382/trees5hq3.th.jpg[/image]</a>&#13;<br />basicly an unlit alphatested sprite.&#13;<br /><br />I know its possible to get a particle effect sprite to use an alphatested shader, but havent found a way to get it to work through the material alone using the 'deform sprite' def, im really not too clued up on doom3 shaders but it just seems like such a simple thing.&#13;<br /><br />Would really appreciate any help on this, even if you can tell me it cant be done <img src="https://web.archive.org/web/20070509181516im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p177596" date="Posted: Mon May 07, 2007 2:22 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">I don't believe sprites can be illuminated by lights. Not so much because it's impossible but rather id never bothered to implement a solution. &#13;<br /><br />I mean, the idea behind a sprite is that it's like a decal that always faces the player. And while visually it might appear to be a quad floating in space it's probably represented by nothing more than a set of xyz coordinates that designate a location in game space.&#13;<br /><br />You have to think about it from the perspective of the developer. If each sprite was represented by a quad that existed in game space, you'd need a routine to rotate each quad to face the player.&#13;<br /><br />Meanwhile you could simply render each sprite directly onto the users screen using the sprite's distance from the player to scale the sprite to the correct dimensions.&#13;<br /><br />I might be wrong but I think that the engine goes with the latter. It renders the sprites in post. And because the sprites don't occupy space in the game world, they are unaffected by lights.</div>]]></body></post><post id="p177603" date="Posted: Mon May 07, 2007 2:57 am "><author>mikebart</author><body><![CDATA[<div class="postbody">Thanks for the response Rich, I also asked about this on the darkmod forums and SneaksiDave showed me this, its a particle sprite pointing to an alphatested material and clearly showing bump and spec and being illuminated by lights.&#13;<br /><br /><a href="https://web.archive.org/web/20070509181516/http://img488.imageshack.us/my.php?image=fliesbz5.jpg" class="postlink">http://img488.imageshack.us/my.php?image=fliesbz5.jpg</a>&#13;<br /><br />I may have missed a key point you made there but isnt this image closer to the former of your two descriptions?&#13;<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">If each sprite was represented by a quad that existed in game space, you'd need a routine to rotate each quad to face the player.</div>&#13;<br /><br />and if so, im wondering if its possible to do the same thing but within the shader alone.&#13;<br /><br />thanks again for the reply <img src="https://web.archive.org/web/20070509181516im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p177609" date="Posted: Mon May 07, 2007 3:32 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">Well here's the shader where that image is used...&#13;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">textures/particles/fly<br /><br />{<br />   <br />   noSelfShadow<br />   translucent<br />   noShadows<br />   twosided<br />   //deform sprite<br />   {<br />      blend add<br />      map textures/particles/fly.tga<br />      vertexcolor<br />      clamp<br />   }<br /><br /><br />}</div>&#13;<br /><br />Notice that deform is commented out? So this isn't a sprite. It's just a decal.&#13;<br /><br />As far as creating a routine that rotates quads to face the player, you might be able to do that by making a custom entity that uses a scriptobject.&#13;<br /><br />It would be more robust if you could address the problem directly via the SDK but it's doubtful that the necessary code is included.&#13;<br /><br />I'm also doubtful that the problem could be addressed through a material shader alone. I can't think of a way to rotate a surface in 3D space via just a material shader and that's just half the problem. The other half is getting information about where the player is in relation to each sprite and furthermore rotating each sprite independently.&#13;<br /><br />BTW, i noticed you used twoSided in your material shader. Is there any particular reason for this given you'd never see the backside of a sprite?</div>]]></body></post><post id="p177613" date="Posted: Mon May 07, 2007 4:08 am "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">Not sure why you want to use sprites for trees.  Check out <a href="https://web.archive.org/web/20070509181516/http://planetquake.gamespy.com/fms/Image.php?id=6957" class="postlink">this</a> shot.  Those really really simple trees but I used spectrum lights to light them properly so they weren't all black (like yours.  Here's the <a href="https://web.archive.org/web/20070509181516/http://planetquake.gamespy.com/View.php?view=Quake4.Detail&amp;id=64" class="postlink">map</a>).&#13;<br /><br />Try using different blend techniques.  With <div class="codetitle"><b>Code:</b></div><div class="codecontent">    blend gl_one_minus_src_alpha, gl_src_alpha</div> for example, I get full bright &amp; alpha channels.&#13;<br /><br />you'll also notice sprites don't sort properly.  that's a reason I don't really use them.  So if you had several trees with that sprite it would look really really bad.</div>]]></body></post><post id="p177614" date="Posted: Mon May 07, 2007 5:07 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">BTW, can someone verify my theory here. I think this would be valuable information for the wiki.</div>]]></body></post><post id="p177615" date="Posted: Mon May 07, 2007 5:29 am "><author>mikebart</author><body><![CDATA[<div class="postbody">@the happy friar; im not sure what spectrum lights are but I did try a shader simalar to that with a previous tree model, it did the trick but yeah, it also wouldnt sort properly or react to light, I ended up just creating a 6-tri cluster model (3 planes facing at each axis) for the foliage using the same material but removed the 'deform sprite' def and I personally think it looks ok possibly even better than it would have if i'd used sprites.&#13;<br /><br />Heres the shader that goes with the image I posted of the fly;&#13;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">textures/decals/junebug<br />{<br />    noSelfShadow<br />    noshadows<br />    nonsolid<br />    twosided<br /><br />    qer_editorimage textures/decals/junebug.tga<br /><br />        {       <br />           blend    diffusemap<br />     map    textures/decals/junebug.tga<br />     scale  bugwings[ time *10 ],1<br />     alphaTest 0.5<br />    }<br />    {       <br />           blend    bumpmap    <br />     map    textures/decals/junebug_local.tga<br />    }<br />    {       <br />           blend    specularmap<br />     map    textures/decals/junebug_s.tga<br />     scale  bugwings[ time *10 ],1<br />    }<br />    {       <br />           blend    add<br />     map    textures/decals/junebug_s.tga<br />     scale  bugwings[ time *10 ],1<br />        <br />    }<br />}</div>&#13;<br /><br />as you can see it has normal and spec.&#13;<br />Im suprised this question hasnt come up before, are alphatested sprites a common thing in games these days?&#13;<br /><br />thx for pointing that out about the 2sided too <img src="https://web.archive.org/web/20070509181516im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p177618" date="Posted: Mon May 07, 2007 6:35 am "><author>Tron</author><body><![CDATA[<div class="postbody"><div class="quotetitle">mikebart wrote:</div><div class="quotecontent">@the happy friar; im not sure what spectrum lights are but I did try a shader simalar to that with a previous tree model, it did the trick but yeah, it also wouldnt sort properly or react to light, </div>&#13;<br /><br />Spectrum lights only affect materials which are set to that spectrum.&#13;<br /><br />In this testmap of mine: <!-- m --><a class="postlink" href="https://web.archive.org/web/20070509181516/http://www.mapsbytron.com/secret/16JAN07-02.jpg">http://www.mapsbytron.com/secret/16JAN07-02.jpg</a><!-- m --> the foliage on the trees has a material set to only use lights on a seperate spectrum.  This allows you to setup the lighting better for foliage so you don't get as much harsh contrast.  The downside is that you don't get any shadows being cast off other objects.</div>]]></body></post><post id="p177625" date="Posted: Mon May 07, 2007 9:28 am "><author>mikebart</author><body><![CDATA[<div class="postbody">thanks tron, ill look into that.&#13;<br /><br />Well, should we conclude that doom3 cant render an alphatested material as a sprite with spec and bump?</div>]]></body></post><post id="p177629" date="Posted: Mon May 07, 2007 10:56 am "><author>6th Venom</author><body><![CDATA[<div class="postbody">Did you just try to remove the <span style="font-weight: bold">twosided</span> keyword?&#13;<br />Cause a <span style="font-weight: bold">deform sprite</span> don't got to be twosided, cause it always point to the player.</div>]]></body></post><post id="p177639" date="Posted: Mon May 07, 2007 12:11 pm "><author>mikebart</author><body><![CDATA[<div class="postbody">It doesnt seem to matter, it still shows the black sprite.</div>]]></body></post><post id="p177686" date="Posted: Tue May 08, 2007 1:33 am "><author>mikebart</author><body><![CDATA[<div class="postbody">I just double checked about the fly, its definitly a sprite with bump and spec, should we conclude that this can only be done through a particle effect but not a material?, if so I guess thats how one would go about creating oblivion like trees.</div>]]></body></post><post id="p177693" date="Posted: Tue May 08, 2007 4:33 am "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">the fly isn't a sprite to the material file.  Just the particle file. So a particle would work for you since you cold tell it to always face the player &amp; it would still handle normal material's w/o any problem.</div>]]></body></post><post id="p177695" date="Posted: Tue May 08, 2007 4:45 am "><author>LDAsh</author><body><![CDATA[<div class="postbody">It is possible to have alphatest autosprites even with specular, just no bumpmapping and no light interaction, which makes for some pretty crappy trees mostly, in my opinion.  There's nothing to indicate the junebug material up there can have the "deform sprite" keyword, I'd bet it will turn fullblack like any other normalmapped light-friendly alphatest material the moment you try to make it happen, and from my experience shooting it from a particle emitter won't make any difference to how the material is rendered, but I'll give it a shot later to prove to myself.&#13;<br />Been a while since I last saw Oblivion but did that actually have autosprites in the trees?  I don't think it had bumpmapped or light-friendly trees, I mean there was no reason for them to be bumpmapped anyway.  Probably just texture baked to seem so.  I've been working on a new technique for normalmapped foliage that avoids harsh seams or the need for strong/flat ambient light, and is completely light and fog friendly, but it's pretty weird and I haven't fully figured it all out yet:-&#13;<br /><a href="https://web.archive.org/web/20070509181516/http://www.violationentertainment.com/images/g_sh/SH_ingame_070506a.jpg" class="postlink">http://www.violationentertainment.com/images/g_sh/SH_ingame_070506a.jpg</a></div>]]></body></post><post id="p177834" date="Posted: Thu May 10, 2007 11:22 am "><author>mikebart</author><body><![CDATA[<div class="postbody">Oblivion does have sprites for the foliage, but I dont think they were normal mapped or spec mapped, I just used them as an example of a sprite being used for foliage.&#13;<br /><br /><img src="https://web.archive.org/web/20070509181516im_/http://www.violationentertainment.com/images/g_sh/SH_ingame_070506a.jpg" alt="Image" /><br /><br />hey this scenes looking really nice btw, how did you do the foliage on the pines? could you tell me more about this new technique you're working on?</div>]]></body></post><post id="p177851" date="Posted: Thu May 10, 2007 6:22 pm "><author>kat</author><body><![CDATA[<div class="postbody">Trees in Oblivion have normal and specular maps. I'd suggest you don't use sprites for trees beacsue after a while the 'popping' that happens as the rotate and intersect each gets rather noticable (and annoying).</div>]]></body></post><post id="p177882" date="Posted: Fri May 11, 2007 12:16 am "><author>mikebart</author><body><![CDATA[<div class="postbody">Did they have normal and spec on the sprites?, I agree about the sprites 'popping' issue, I had them set up in 3dsmax to always face a camera. I had to keep them quite small, so that they would be less noticable, in the end after failing to get them working the way I wanted them to in quake4 as sprites I ended up making a 6-tri cluster model (3 planes facing at each axis) for the foliage and ended up saving a few tris, and like you say it looks alot better too</div>]]></body></post></posts></thread></xml>
