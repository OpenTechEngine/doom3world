<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="5494"><title>Complete GUI Scripting - 8: Using named events</title><posts><post id="p46888" date="Posted: Sat Sep 04, 2004 9:22 pm "><author>zeh</author><body><![CDATA[<div class="postbody">Hi, and welcome back to lesson number eight in the GUI scripting series.
<br /><br />This time, we'll make the GUI script respond to a named event - the weapon pickup - and update the HUD accordingly. Following the tradition of having small topics covered in each lesson (so you can skip them individually if it's covering a topic you already know), this will be a pretty short article.
<br /><br /><span style="font-size: 167%; line-height: normal"><span style="font-weight: bold">Complete GUI Scripting - 8: Using named events</span></span>
<br /><br />One of the features that add the most power to the GUI system is the ability to respond to certain built-in events. These events include not only GUI events - onAction, onTime, etc - but also 'external' events triggered by the system. They're called "named events", and we can defined them by using onNamedEvent blocks.
<br /><br />Simply enough, a named event works like this:
<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">onNamedEvent &lt;event name&gt; {<br />   &lt;statements to execute&gt;<br />}</div><br /><br />Of course, the &lt;event name&gt; is the name of the event we want to capture. This is an special name, and depends on the scope you're running your GUI script. Since we're using a HUD GUI script, there are certain built in named events we can work with.<br /><br />The first thing we'll do is open up the HUD script we created in the previous lesson, which is as follows.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">windowDef Desktop {<br />   rect   0,0,640,480<br />   visible   1<br />   noevents   1<br />   nocursor  1<br /><br />//=============================================================================<br />// Main bar<br />//=============================================================================<br /><br />   windowDef base {<br />      rect   0,416,1024,64<br />      visible   1<br />      background   "guis/assets/hud_base"<br />      matcolor   1,1,1,1<br />   }<br /><br />//-----------------------------------------------------------------------------<br />// Standard indications: ammo, armor, health<br />//-----------------------------------------------------------------------------<br /><br />   windowDef bar_health {<br />      rect   110,420,60,49<br />      visible   1<br />      forecolor   1,1,1,1<br />      text   "gui::player_health"<br />      textscale   0.6<br />      textalign   2<br />      font   "fonts/english"<br />   }<br />   windowDef bar_health_percent {<br />      rect   170,420,40,49<br />      visible   1<br />      forecolor   1,1,1,1<br />      text   "%"<br />      textscale   0.6<br />      textalign   0<br />      font   "fonts/english"<br />   }<br />   windowDef bar_armor {<br />      rect   370,420,60,49<br />      visible   1<br />      forecolor   1,1,1,1<br />      text   "gui::player_armor"<br />      textscale   0.6<br />      textalign   2<br />      font   "fonts/english"<br />   }<br />   windowDef bar_armor_percent {<br />      rect   430,420,40,49<br />      visible   1<br />      forecolor   1,1,1,1<br />      text   "%"<br />      textscale   0.6<br />      textalign   0<br />      font   "fonts/english"<br />   }<br />   windowDef bar_ammo {<br />      rect   15,420,60,49<br />      visible   1<br />      forecolor   1,1,1,1<br />      text   "gui::player_ammo"<br />      textscale   0.6<br />      textalign   2<br />      font   "fonts/english"<br />   }<br /><br />//-----------------------------------------------------------------------------<br />// Weapon numbers<br />//-----------------------------------------------------------------------------<br /><br />   windowDef gun_2 {<br />      rect   218, 416, 40, 40<br />      visible   1<br />      forecolor   1,1,0,1<br />      text   "2"<br />      textscale   0.25<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_3 {<br />      rect   242, 416, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "3"<br />      textscale   0.25<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_4 {<br />      rect   266, 416, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "4"<br />      textscale   0.25<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_5 {<br />      rect   218, 436, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "5"<br />      textscale   0.25<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_6 {<br />      rect   242, 436, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "6"<br />      textscale   0.25<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_7 {<br />      rect   266, 436, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "7"<br />      textscale   0.25<br />      font   "fonts/micro"<br />   }<br /><br />//=============================================================================<br />// Marine faces<br />//=============================================================================<br /><br />//-----------------------------------------------------------------------------<br />// Normal face<br />//-----------------------------------------------------------------------------<br /><br />   windowDef marineFace {<br />      rect   290,418,64,64<br />      visible   1<br />      background   "guis/assets/hud_face_100_center"<br />      matcolor   1,1,1,1<br />   }<br /><br />}</div><br /><br />Now, we're going to add a new event to it. Right after the desktop windowDef properties are declared, we add a new event block.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">windowDef Desktop {<br />   rect   0,0,640,480<br />   visible   1<br />   noevents   1<br />   nocursor  1<br /><br />//=============================================================================<br />// Events<br />//=============================================================================<br /><br />   onNamedEvent newWeapon {<br />   <br />   }<br /><br />(...strip...)</div><br /><br />This is the basics of our new event block. Since we're trying to update the weapon numbers on the HUD, we want to capture the "newWeapon" event, which is fired when a new weapon has been picked up. This event name came from the original HUD file, of course - reading the original script sources, from the original game, is the best way to learn how to accomplish certain goals in DOOM 3 modding. Reverse engineering is your friend.<br /><br />Anyway, remember our "gun_*" windowDef declarations? They had the numbers of the weapons available for the player. Like I said on the previous lesson, most of the weapons numbers have a "forecolor" property of "1,1,1,0.4" - 40% black. When they are available, they turn into "1,1,0,1" - yellow. What we need to do, then, is discover which weapon was picked up and update the text color accordingly.<br /><br />That will be accomplished by using the "gui::newweapon" variable inside of the newWeapon named event block. Just like the "gui::player_health" we discussed on the previous lesson, "gui::newweapon" is an special variable which has the number of the last weapon picked up, so it's easy to find out which weapon number should be highlighted. Let's start with a simple conditional statement.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">(...strip...)<br /><br />//=============================================================================<br />// Events<br />//=============================================================================<br /><br />   onNamedEvent newWeapon {<br />      // Now turns on the correct number when a new weapon is picked<br />      if ("gui::newweapon" == 2) {<br />      }<br />   }<br /><br />(...strip...)</div><br /><br />the "if" statement compares the "gui::newweapon" to 2. If this is true -- meaning, the last weapon picked up was weapon 2 - the statements inside of the "if" block will be executed.<br /><br />One thing to notice here is that the weapon indexing inside of the GUI system start with the pistol. So, weapon 1 is the pistol, not the fists; weapon 2 is the shotgun, not the pistol.<br /><br />So, since the code inside of the if block will be executed when the shotgun has been picked up, we just need to update the "forecolor" property of the correct "gun_*" windowDef to make it bright yellow. That's easy, using the "set" command we used previously.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">(...strip...)<br /><br />//=============================================================================<br />// Events<br />//=============================================================================<br /><br />   onNamedEvent newWeapon {<br />      // Now turns on the correct number when a new weapon is picked<br />      if ("gui::newweapon" == 1) { <br />         set "gun_2::forecolor" "1,1,0,1";<br />      }<br />   }<br /><br />(...strip...)</div><br /><br />Easier than <a href="https://web.archive.org/web/20100522161840/http://www.shacknews.com/ja.zz?id=8295783" class="postlink">taking candy from a baby</a>. So we just need to add if statements for the other guns; we're just going up to gun 6, or the plasma gun, so...<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">(...strip...)<br /><br />//=============================================================================<br />// Events<br />//=============================================================================<br /><br />   onNamedEvent newWeapon {<br />      // Now turns on the correct number when a new weapon is picked<br />      if ("gui::newweapon" == 2) { <br />         set "gun_3::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 3) { <br />         set "gun_4::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 4) { <br />         set "gun_5::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 5) { <br />         set "gun_6::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 6) { <br />         set "gun_7::forecolor" "1,1,0,1";<br />      }<br />   }<br /><br />(...strip...)</div>
<br /><br />Let's test it. Fire up our DOOM 3 shortcut - or do a reloadguis command if you already had it running.
<br /><br />We have a pistol on hand...
<br /><br /><img src="https://web.archive.org/web/20100522161840im_/http://hosted.zeh.com.br/doom3/tutorials/tut8_01.jpg" alt="Image" /><br /><br />...going to grab the shotgun...
<br /><br /><img src="https://web.archive.org/web/20100522161840im_/http://hosted.zeh.com.br/doom3/tutorials/tut8_02.jpg" alt="Image" /><br /><br />...and voila, the corresponding number - 3 - has been lit on the HUD bar. Simple, and easy.
<br /><br />That's it for now. We'll use a few more named events on the next lessons.
<br /><br /><a href="https://web.archive.org/web/20100522161840/http://hosted.zeh.com.br/doom3/tutorials/tut8.zip" class="postlink">Download source and example files</a> (8kb)</div>]]></body></post><post id="p47618" date="Posted: Mon Sep 06, 2004 6:31 pm "><author>b0ksah</author><body><![CDATA[<div class="postbody"><img src="https://web.archive.org/web/20100522161840im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /> You are da God mate <img src="https://web.archive.org/web/20100522161840im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /> *bump*</div>]]></body></post><post id="p47627" date="Posted: Mon Sep 06, 2004 6:38 pm "><author>MNeMiC</author><body><![CDATA[<div class="postbody">bumpetiBUMP!</div>]]></body></post><post id="p128738" date="Posted: Fri Jan 06, 2006 7:41 pm "><author>Luigi</author><body><![CDATA[<div class="postbody">*Topic revival*
<br />I've been trying to fix this for three hours and I just can't figure it out:
<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   onNamedEvent newWeapon {<br />         if ("gui::newweapon" == 0) {<br />         set "gun_1::forecolor" "1,1,0,1";<br />      }<br />    if ("gui::newweapon" == 1) {<br />         set "gun_2::forecolor" "1,1,0,1";<br />      }<br />         if ("gui::newweapon" == 2) {<br />         set "gun_3::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 3) {<br />         set "gun_4::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 4) {<br />         set "gun_5::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 5) {<br />         set "gun_6::forecolor" "1,1,0,1";<br />      }<br />      if ("gui::newweapon" == 6) {<br />         set "gun_7::forecolor" "1,1,0,1"; <br />      }<br />      if ("gui::newweapon" == 7) {<br />         set "gun_8::forecolor" "1,1,0,1"; <br />      }<br />      if ("gui::newweapon" == 8) {<br />         set "gun_9::forecolor" "1,1,0,1"; <br /><br />    }<br />   } <br /><br />(strip)<br /><br />  windowDef gun_1 {<br />      rect   450,10, 40, 40<br />      visible   1<br />      forecolor   1,1,0,1<br />      text   "1"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br /><br />   windowDef gun_2 {<br />      rect   465,10, 40, 40<br />      visible   1<br />      forecolor   1,1,0,1<br />      text   "2"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_3 {<br />      rect   480, 10, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "3"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_4 {<br />      rect   495, 10, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "4"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_5 {<br />      rect   510, 10, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "5"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_6 {<br />      rect   525,10, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "6"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_7 {<br />      rect   540, 10, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "7"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_8 {<br />      rect   555, 10, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "8"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br />   windowDef gun_9 {<br />      rect   570, 10, 40, 40<br />      visible   1<br />      forecolor   1,1,1,0.4<br />      text   "9"<br />      textscale   0.2<br />      font   "fonts/micro"<br />   }<br /><br /></div>
<br /><br />I have no problems with the shotgun and all of the weapons after it but when it comes to the chainsaw and pistol for some reason the chainsaw will always be highlighted as "picked up" even when it isn't, same for the pistol. This is <span style="font-weight: bold">really</span> annoying me.
<br /><br />Thanks in advance.</div>]]></body></post><post id="p129247" date="Posted: Tue Jan 10, 2006 11:12 pm "><author>Luigi</author><body><![CDATA[<div class="postbody">Gee, thanks a lot for the help.  <img src="https://web.archive.org/web/20100522161840im_/http://www.doom3world.org/phpbb2/images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" /></div>]]></body></post><post id="p129248" date="Posted: Tue Jan 10, 2006 11:21 pm "><author>zeh</author><body><![CDATA[<div class="postbody">I'm sorry, I haven't been able to use the computer that much as of lately.
<br /><br />Anyways, unless I'm missing something big from your question, it's a very simple problem. You'll notice from the source that both weapons are pre-lighted as being picked up. Watch for this line on the first two gun windowdefs:
<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">forecolor   1,1,0,1</div><br /><br />That's hardcoded and you might have to change that if both your weapons aren't automatically available to the player. Then it should be:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">forecolor   1,1,1,0.4</div>
<br /><br />This is the default for non-picked weapons.</div>]]></body></post><post id="p129251" date="Posted: Tue Jan 10, 2006 11:41 pm "><author>Luigi</author><body><![CDATA[<div class="postbody">Oh my god, how could I have missed that? I'm such an idiot. <img src="https://web.archive.org/web/20100522161840im_/http://www.doom3world.org/phpbb2/images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /><br /><br />Another problem I noticed is that if there are two or more "new weapons" and the player picks them up quickly then the first weapon the player picks up will register, but the others won't and the numbers will stay in the grey color.</div>]]></body></post></posts></thread></xml>
