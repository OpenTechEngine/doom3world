<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="3529"><title>Tutorial: Throwing a Ragdoll through Glass</title><posts><post id="p32806" date="Posted: Wed Aug 11, 2004 10:49 am "><author>lophyte</author><body><![CDATA[<div class="postbody">FLYING CORPSE TUTORIAL
<br />By: lophyte &lt;lophyteNO@SPAMgmail.com&gt;
<br /><br />This effect was used throughout Doom 3 to startle the player. You may recall it from the beginning of Delta Labs Sector 1, right near the beginning where you walk up to a locked door, and a body comes crashing through the window next to you.
<br /><br />This tutorial assumes you know the basics of editing with DoomEdit. The <a href="https://web.archive.org/web/20091206235303/http://lophyte.is-a-geek.org/doom3/tutorials/flyingcorpse/flyingcorpse.rar" class="postlink">demo map</a> is available for download if you'd like something to take a look at.
<br /><br />First, create a 512x512x256 room. Clone one of the walls and drag it to the middle of the room, thus creating 2 rooms approximately 512x256x256 in size. Add a light into the room where the player spawns. Now, we're gonna want to cut a hole in the middle wall for our window, so resize the middle wall to be 192 units in length. Clone it, then put the new one on the other side, as detailed in the image.
<br /><br /><img src="https://web.archive.org/web/20091206235303im_/http://lophyte.is-a-geek.org/doom3/tutorials/flyingcorpse/corpse1.jpg" alt="Image" /><br /><br />Clone the wall again, but this time resize it to 128 units long. Place this wall in between the two walls we've got now. Press Ctrl+Tab to switch to Front view, and resize the wall until its about jumping height high. Clone the wall again, this time raise the top of it to the ceiling, and the bottom of it to about half-way down.
<br /><br /><img src="https://web.archive.org/web/20091206235303im_/http://lophyte.is-a-geek.org/doom3/tutorials/flyingcorpse/corpse2.jpg" alt="Image" /><br /><br />Switch the 2D view back to the top. Right click on the grid, and go to func, then select func_fracture. Resize it so that it fits perfectly into the cut in our wall. Texture it using a texture from base/textures/glass, and in the Entity Properties window, give it key "health", with a val of "0". Also, set a key of "model" with a val that matches the name of the entity (default "func_fracture_1")
<br /><br />Deselect everything, right click on the grid, and go to env, then select one of the ragdolls - I used env_ragdoll_marine1.  Place the ragdoll in the room in which the player is not going to be, and make sure he's on the floor.  In the entity properties, give the ragdoll a descriptive name such as "corpse1". Next, we need to create a mover that will move our ragdoll. Right click on the grid, and go to func, then select func_mover. Give the mover a descriptive name as well, like "corpse_mover1".  Now go select the ragdoll again, and in the entity properties, add key "bind" with a val matching the name of the mover. Also, add key "bindConstraint name1" wiht a val of "ballAndSocket waist Hips". This means that we'll be binding the ragdolls hips to the mover.
<br /><br /><br />If you'd like to bind another part of the ragdoll's body, go into the map and play around with the g _dragentity cvar. Select different parts of the ragdoll's body and figure out the name for them. Also, I've found that if you leave the ragdoll in its default position, it will hang in mid-air by its waist and spin slowly. The way to fix this is to go into the game, and use the g_dragentity cvar to re-shape the ragdoll. There's more information about ragdoll shaping <a href="https://web.archive.org/web/20091206235303/http://www.doom3world.org/phpbb2/viewtopic.php?t=3181" class="postlink">here</a>.
<br /><br />Next, we need to make an entity that the mover will move to. Deselect everything, then right click on the grid, go to func, and select func_static. 
<br />Texture this entity with base/textures/common/nodraw. In the entity properties, give it a descriptive name, such as "corpse_mover1_movepoint". Place this movepoint around the upper half of the window, on the side with the player start and the light, somewhat like in the image below.
<br /><br /><img src="https://web.archive.org/web/20091206235303im_/http://lophyte.is-a-geek.org/doom3/tutorials/flyingcorpse/corpse3.jpg" alt="Image" /><br /><br /><br />Now it's time for scripting. Open up notepad and write the following code:
<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void corpse_move () <br />{<br />   $corpse_mover1.time(.4);<br />   $corpse_mover1.moveTo ( $corpse_mover1_movepoint );<br />   sys.waitFor ($corpse_mover1);<br />   $corpse1.unbind();<br />}<br /></div>
<br /><br />Code explanation: corpse_move is the function we're going to call from a trigger in the next part. The <span style="font-weight: bold">time</span> command sets how long it will take for the mover to move to its destination point. The <span style="font-weight: bold">moveTo</span> command causes the mover to move to the location at which the movepoint is. The <span style="font-weight: bold">sys.waitFor</span> allows the mover to complete its move before executing the next line of code. And finally, we unbind our corpse from the mover so that it falls to the ground, and doesn't hang in the air.
<br /><br />Save the script in the same directory as your map, with the same filename (ie if your map is flyingcorpse.map, the script should be flyingcorpse.script)
<br /><br />Now all that's left to do is create a trigger that will cause the body to fly through the glass. Deselect everything, right click on the grid and go to trigger, then trigger_once. Place this entity next to the window, so that if the player walks by the window, the body will fly through.
<br /><br /><img src="https://web.archive.org/web/20091206235303im_/http://lophyte.is-a-geek.org/doom3/tutorials/flyingcorpse/corpse4.jpg" alt="Image" /><br /><br /><br />Go into the entity properties for the trigger, and set key "call" to the name of the function in our script - "corpse_move". To wrap up, move the mover so that it's directly on top of the ragdoll. This is so that they both start from the same point.
<br /><br />Now fire up Doom and try out your map - but don't jump when the body crashes through the glass! That's all for now.. feedback is appreciated.
<br /><br />- lophyte</div>]]></body></post><post id="p32866" date="Posted: Wed Aug 11, 2004 1:11 pm "><author>BNA!</author><body><![CDATA[<div class="postbody">Accompany your post with a screenie please <img src="https://web.archive.org/web/20091206235303im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p33038" date="Posted: Wed Aug 11, 2004 4:47 pm "><author>bljohnson</author><body><![CDATA[<div class="postbody"><div class="quotetitle">BNA! wrote:</div><div class="quotecontent">Accompany your post with a screenie please <img src="https://web.archive.org/web/20091206235303im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>
<br /><br />I just ran through the tutorial.  Very nice!  An excellent effect I'll tell ya.  One thing though - I would suggest placing your movepoint in the lower half of the window instead of the upper half.  That way the corpse flies right past you at eye level.  Here's my screenshot as I tested the tutorial results:
<br /><br /><img src="https://web.archive.org/web/20091206235303im_/http://www.bjohnson.net/files/doom3/flyingcorpse.jpg" alt="Image" /></div>]]></body></post><post id="p33063" date="Posted: Wed Aug 11, 2004 5:12 pm "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">That's sweet. Great job. <img src="https://web.archive.org/web/20091206235303im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p33067" date="Posted: Wed Aug 11, 2004 5:18 pm "><author>bullet</author><body><![CDATA[<div class="postbody">Awesome! I gotta try this on a larger scale..</div>]]></body></post><post id="p33173" date="Posted: Wed Aug 11, 2004 7:18 pm "><author>goliathvt</author><body><![CDATA[<div class="postbody">Yeah, I'm itching to get home and try this....
<br /><br />Perhaps a re-enactment of a few scenes from Hitchcock's "Birds"... except it'll be aptly named, "Dead People"...
<br /><br />G</div>]]></body></post><post id="p33180" date="Posted: Wed Aug 11, 2004 7:26 pm "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">Yeah, now just set this up so the guy flys out the outboard facing window on a highrise and it will be great. <img src="https://web.archive.org/web/20091206235303im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p33194" date="Posted: Wed Aug 11, 2004 7:40 pm "><author>goliathvt</author><body><![CDATA[<div class="postbody">You know, that'd be a great camera/cinematics tutorial... tossing a corpse out a window of a tower/high-rise and have the camera follow them down the fall, with various camera movements on the way...
<br /><br />GAH... so many tutorials... so little time.
<br /><br />G</div>]]></body></post><post id="p33203" date="Posted: Wed Aug 11, 2004 7:55 pm "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">Yeah that would be cool. You'd need one tall ass map though.</div>]]></body></post><post id="p33489" date="Posted: Thu Aug 12, 2004 3:54 am "><author>Crawdad_Cletis</author><body><![CDATA[<div class="postbody">My trigger isn't working.
<br /><br />I verified that Doom is looking at my script by putting some garbage that won't compile in it.  Doom complains when I try to load the map.
<br /><br />Then I added a <div class="codetitle"><b>Code:</b></div><div class="codecontent">sys.print("here");</div> to the script to let me know if it was being run.  It never prints "here" to the console.
<br /><br />I made a trigger_once trigger and set a key "call" with a value of "corpse_move".  (Yes, I've checked a zillion times that I spelled everything the same in my script and trigger.)
<br /><br />Why isn't the trigger calling my script?</div>]]></body></post><post id="p33640" date="Posted: Thu Aug 12, 2004 9:28 am "><author>l7oc</author><body><![CDATA[<div class="postbody">I am having the same problem.  If I create a trig once trigger type and have a call to a function, but it will not do anything.  The *.script and *.map are in the same dir and have the same name.  I know that the script works b/c I added a main() to the *.script and that worked.  So, I know its not the function.  What am I doing wrong? Is there a step missing in the tutorial?
<br /><br />Thanks!!!!</div>]]></body></post><post id="p33736" date="Posted: Thu Aug 12, 2004 12:06 pm "><author>lophyte</author><body><![CDATA[<div class="postbody">Is the trigger big enough and in a position that the player would walk through it?</div>]]></body></post><post id="p33859" date="Posted: Thu Aug 12, 2004 4:21 pm "><author>l7oc</author><body><![CDATA[<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Is the trigger big enough and in a position that the player would walk through it?</div>
<br /><br />Yeah, it is definently big enought.  I tried making server differnt size zones.  Then I even tried...... ohh shit it works.  I think the problem was the I had not defined the a "model" key for the zone with the same name as the zone.  
<br /><br />I'm guessing the engine doesn't know what piece of geometry to look for in the level to tie the call too.  But make sure that you have done this and it will work.  
<br /><br />If you get stuck, sleep on it.  Thats what I just did and it worked.  BTW, great tutorial.</div>]]></body></post><post id="p34174" date="Posted: Thu Aug 12, 2004 10:15 pm "><author>k40t1k_g3m1n1</author><body><![CDATA[<div class="postbody">My trigger wont work, I'm sure i have the *.script correct but it keeps telling me that my trigger "calls unknown function 'corpse_move' ".  Can anyone please give me some help.</div>]]></body></post><post id="p34193" date="Posted: Thu Aug 12, 2004 10:39 pm "><author>Crawdad_Cletis</author><body><![CDATA[<div class="postbody">The model key?  That could be my problem too.  I'll check it when I get home.</div>]]></body></post><post id="p34232" date="Posted: Thu Aug 12, 2004 11:23 pm "><author>Crawdad_Cletis</author><body><![CDATA[<div class="postbody">Outstanding!  That did it.
<br /><br />Thanks for the help.</div>]]></body></post><post id="p34233" date="Posted: Thu Aug 12, 2004 11:25 pm "><author>3xodus</author><body><![CDATA[<div class="postbody">How could you make this where a live enemy such as a zombie or a demon jumps through the window on the opposite side and attacks?</div>]]></body></post><post id="p34242" date="Posted: Thu Aug 12, 2004 11:35 pm "><author>k40t1k_g3m1n1</author><body><![CDATA[<div class="postbody">what should i have the model value set to for the trigger? I'm sorry i'm really new to mapping <img src="https://web.archive.org/web/20091206235303im_/http://www.doom3world.org/phpbb2/images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /></div>]]></body></post><post id="p34249" date="Posted: Thu Aug 12, 2004 11:41 pm "><author>lophyte</author><body><![CDATA[<div class="postbody">The model key in the trigger should be set to the name of the trigger.
<br />I must've overlooked this when writing the tutorial, apologies <img src="https://web.archive.org/web/20091206235303im_/http://www.doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div>]]></body></post><post id="p34250" date="Posted: Thu Aug 12, 2004 11:42 pm "><author>Razputin</author><body><![CDATA[<div class="postbody">The model value should equal the name of the trigger.
<br />I had this problem just last night, and recreating a trigger fixed it.
<br /><br />It seems sometimes the model value is populated and sometimes not.</div>]]></body></post></posts></thread></xml>
