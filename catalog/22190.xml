<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="22190"><title>How do I call my code from the GUI?</title><posts><post id="p207773" date="Posted: Mon Nov 24, 2008 3:30 pm "><author>EGD Eric</author><body><![CDATA[<div class="postbody">I've tried to call my own C++ function from the gui, and it doesn't seem to be happening. I tried declaring a script function in script_Thread.h, defining it in script_thread.cpp, but it still doesn't call it. Maybe I'm calling it wrong?<br />I put it in the onMouseEnter event of the buttons in the main menu, its called: "playRollover"<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">         <br />                                onMouseEnter {<br />            if ("desktop::active" == 0) {<br />               stoptransitions "main_b_newgame" ;<br />               <br />               set "main_b1::matcolor_w" "0.8" ;<br />               transition "main_t_b1::forecolor" "$desktop::white_8" "$desktop::orange" "0" ; <br />               transition "main_b1_corner::matcolor" "$desktop::corner" "$desktop::orange" "0" ;<br />               <br />               set "main_t_b1::textscale" "0.34" ; <br />               <br />               set "cmd" "play main_menu_mouseover" ;      <br />            }<br />            set "cmd" "playRollover";<br />         }<br /></div><br />Here you can see I declared it as an event in script_thread.cpp:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   EVENT( EV_Thread_SetMatSort,         idThread::Event_SetMatSort )<br />// RAVEN END<br /><br />//play rollover effect<br />   EVENT(EV_Thread_PlayRollover,         idThread::Event_PlayRollover)<br /><br /></div><br />And above that, I've declared it as an idEventDef:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">const idEventDef EV_Thread_SetMatSort( "setMatSort", "ss", 0 );<br />// RAVEN END<br />const idEventDef EV_Thread_PlayRollover("playRollover", 0);<br /></div></div>]]></body></post><post id="p207779" date="Posted: Mon Nov 24, 2008 8:42 pm "><author>TinMan</author><body><![CDATA[<div class="postbody">Ah, the event system isn't directly connected to the gui system.<br />The gui cmd is handled by the engine first then passed through to the game, which function depends on what type of gui.<br />Looking at your gui snippet it looks like you're working with the main menu. <br />In that case you'll have to work with<br />idGameLocal::HandleMainMenuCommands<br />Plenty of code there to figure out how it works, pretty simple if string == "nameofcommand".<br /><br />Another approach would would be something along the lines of<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">..build command string into a token list..<br />..if token == "event"..<br />..read next token..<br />      <br />      const idEventDef * foundEvent = idEventDef::FindEvent( token ); // doesn't seem too fast from my quick look at the function, manual loop through all events and string compare.<br />      if ( foundEvent ) {<br />         // You could get more fancy here and read sucessive tokens to use as arguments for the event<br />         idThread * thread = new idThread(); // For the main menu, at pre-map load there isn't likely to be any idThreads around to repurpose, creating an idThread just for this may be a bit heavy, building a MainMenu class might be better.<br />         thread-&gt;PostEventMS( foundEvent, 0 );<br />         return true;<br />      }<br />   }</div><br />then you should be able to do this in the gui<br />set "cmd" "event myFabulousEvent";<br />To call the event called myFabulousEvent.<br /><br />This could also be adapted for idEntity::HandleGuiCommands for entityguis</div>]]></body></post><post id="p207803" date="Posted: Tue Nov 25, 2008 3:48 pm "><author>EGD Eric</author><body><![CDATA[<div class="postbody">Thanks, that really helped! I've got the main menu calling my code, now I've just got to find where all the other guis are handled...<br />Edit: I just want to change code from the restart.gui as well, but I haven't yet found where in the code that's being handled. I've placed breakpoints in idEntity::HandleGuiCommands, idPlayer::HandleSingleGuiCommand, idMultiplayerGame::HandleGuiCommands, idEntity::HandleSingleGuiCommand, the restart gui (the one you get when you die in single player) doesn't seem to call use any of these functions to handle its commands...</div>]]></body></post><post id="p207814" date="Posted: Tue Nov 25, 2008 6:17 pm "><author>simulation</author><body><![CDATA[<div class="postbody"><div class="quotetitle">EGD Eric wrote:</div><div class="quotecontent">Thanks, that really helped! I've got the main menu calling my code, now I've just got to find where all the other guis are handled...<br />Edit: I just want to change code from the restart.gui as well, but I haven't yet found where in the code that's being handled. I've placed breakpoints in idEntity::HandleGuiCommands, idPlayer::HandleSingleGuiCommand, idMultiplayerGame::HandleGuiCommands, idEntity::HandleSingleGuiCommand, the restart gui (the one you get when you die in single player) doesn't seem to call use any of these functions to handle its commands...</div><br />I think restart.gui is loaded and controlled by the main exe, not the gamecode. So unless it passes to the gamecode throught HandleMainmenuComamnds() then you're probably going to be out of luck with that one.<br /><br />Out of interest, what is it that these custom events do for your GUIs?</div>]]></body></post><post id="p207980" date="Posted: Mon Dec 01, 2008 10:16 pm "><author>EGD Eric</author><body><![CDATA[<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Out of interest, what is it that these custom events do for your GUIs?</div><br />sry, I want to tell you, but I'd be in breach of my NDA.</div>]]></body></post><post id="p207984" date="Posted: Tue Dec 02, 2008 9:43 am "><author>simulation</author><body><![CDATA[<div class="postbody"><div class="quotetitle">EGD Eric wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Out of interest, what is it that these custom events do for your GUIs?</div><br />sry, I want to tell you, but I'd be in breach of my NDA.</div><br />A mod team with an NDA for something based on a freely available SDK? Wow!</div>]]></body></post><post id="p207991" date="Posted: Tue Dec 02, 2008 6:46 pm "><author>EGD Eric</author><body><![CDATA[<div class="postbody">Its more like a demo (among many other demos) to show clients... something. I've said too much! <img src="/web/20081204032832im_/http://www.doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /></div>]]></body></post></posts></thread></xml>
