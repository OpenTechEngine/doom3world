<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="3070"><title>D3W Tutorial: Connecting two rooms, doors and visportals</title><posts><post id="p29691" date="Posted: Fri Aug 06, 2004 10:07 pmÂ "><author>BNA!</author><body><![CDATA[<div class="postbody">Hi everybody - here's the second D3W tutorial:
<br />How to connect two rooms, add working doors and block efficiently the visibility so you wont have to render more than what you really see.
<br />Basically it's a 3in1 tutorial, but you'll like it, wont take you too much time and what you learn is something you will need every single day as a mapper.
<br /><br />I'm referencing to the first D3W tutorial often, so make sure that you at least take a look at it:
<br /><a href="https://web.archive.org/web/20121105165634/http://www.doom3world.org/phpbb2/viewtopic.php?t=3016" class="postlink">D3W Tutorial: Getting started with your first map</a>
<br /><br />That's the map I've created with this little tutorial:
<br /><!-- m --><a class="postlink" href="https://web.archive.org/web/20121105165634/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_2rooms_doors.rar">http://www.doom3world.org/doom3/tut/bna ... _doors.rar</a><!-- m -->
<br /><br />This said we start with two boxes, one of them has an info_player_start in it and both are lit as in the first tutorial (by now you sould be able to crank out these two boxes in less than 60 seconds).
<br /><br />Just in case you don't know yet:
<br />When you select something in DoomEdit and hit the space bar it'll clone it so you have a perfect copy, you'll need that a few times now.
<br />If you want to select the whole box at once to duplicate it, just make a brush which encloses the whole thing - right click into the grid, selection &gt; select inside. 
<br /><br />Top down starting view like this:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_1.jpg" alt="Image" /><br /><br />Next step is to create a <span style="font-weight: bold">good</span> cut into the wall, otherwise we wouldn't be able to walk from room 1 to room 2 <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />So just select the wall in front of you by shift+lmb clicking it:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_2.jpg" alt="Image" /><br /><br />Then we ctrl+tab to side view (or was it frontview? doesn't matter - just look at the screenshot, you can't go wrong):
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_3.jpg" alt="Image" /><br /><br />Now drag outside the selected brush and resize it so it looks like this:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_4.jpg" alt="Image" /><br /><br />Now clone this, place it to the right side, clone it one more time, place it in the middle an resize it so it looks like this:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_5.jpg" alt="Image" /><br /><br />Done that? Fine - go to room2, delete the wall we just edited, go back to room1, select the three brushes now making our wall with entry, clone them and drag them over to room2 so it looks like room1.
<br />Sounds complicated, but it's only because it's my second language and I'd  rather play Doom now <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Let's progress - we need an infamous claustrophobic corridor to walk from room1 to room2.
<br />The fastest way is to select the floor of room1 (or room2, doesn't matter), clone it, drag it outside to line up exactely with the floor, resize it so that it extends the opening in the wall for one unit on both sides and make it a similar shape as shown below:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_6.jpg" alt="Image" /><br /><br />Now you clone that and drag it over to room2.
<br />Clone it one more time and hit the z-axis rotate button - will rotate your clone at 90degrees. Line it up so it looks like this (make sure the brushes touch each other perfectly and line up with the floors in the rooms):
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_7.jpg" alt="Image" /><br /><br />Select the three floor brushes, clone them and drag them upwards to form the ceiling. Make sure to align them with the top part of our nice hole in the wall:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_8.jpg" alt="Image" /><br /><br />Now we need walls - clone one of the floor brushes, drag it upwards so it just sits on the floor (don't leave a gap open and don't overlap them). 
<br /><br />Then you resize it so it's only a unit thick (that's why we extended the floor and the cieling one unit beyond the hole in the wall) and resize it upwards to match up with the cieling:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_9.jpg" alt="Image" /><br /><br />Continue, repeat, z-axis rotate till it looks like this - always make sure not to leave any gaps open!!
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_10.jpg" alt="Image" /><br /><br />Claustrophobic and dark is cool, but pitch black is not, so we quickly add a light in the middle of the corridor.
<br /><br />Watch your map from all sides and make sure the light is not outside the corridor tho:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_11.jpg" alt="Image" /><br /><br />Now we add a door. To do so we right click and choose func_door.
<br />This will insert something that looks like a random brush, don't mind at this stage:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_12.jpg" alt="Image" /><br /><br />Since we want our door to look cool, we use a model for it.
<br />To do so we right click and select the option new model.
<br />This will open the fancy model browser (in the preview window: rotate the model with the lmb and resize it with alt + rmb)
<br /><br />In our case: models/mapobjects/doors/airlockdoor/separates/airdoor.lwo ffor the door and 
<br />models/mapobjects/doors/airlockdoor/separates/airdoorfrm.lwo for the frame.
<br /><br />Both models will show up just as boxes when you add them - select the boxes and clone them, then the models will show up nicely (most famous Radiant bug since ever). Delete the old boxes, keep the models (these are func_statics now).
<br /><br />We wont really need them, but now you've learned how to add models.
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_13.jpg" alt="Image" /><br /><br />Now select your func_door and switch to the entity tab in the inspector window.
<br /><br />In the lower right click the "model" button which will bring up the already shown model browser. Select the door model we've talked about previously.
<br /><br />As usual you'll still see the box - select it, clone it delete old box...
<br />Now you have a nice model as a door.
<br />Use the z-axis rotate button so it faces the wall hole.
<br /><br />Then move it into the hole:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_14.jpg" alt="Image" /><br /><br />Should look like this:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_15.jpg" alt="Image" /><br /><br />Now select the frame we've brought into the map earlier and line it up with the func_door and the wall.
<br /><br />You'll see small red dots in the view - these are the pivot points of the models. id software had modeled both in a fashion so that these points should line up (pure design decision, not a functionality you need to learn now). 
<br /><br />Drag the models into places:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_16.jpg" alt="Image" /><br /><br />Select both, the func_door and the func_static showing the door frame, clone them and move the copy to room2:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_17.jpg" alt="Image" /><br /><br />Now make a brush that fits just nicely into the wallhole and the func_door we've created earlier - this will be our visportal. Make it a little thinner than the func_door.
<br /><br />Assign the visportal material: textures &gt; editor &gt; visportal to the brush face either facing towards or away from us, no real difference.
<br /><br />The other faces you texture with textures &gt; common &gt; nodraw.
<br /><br />Quick workflow / tool tip:
<br /><br />Select the brush you want to act as a visportal and give it the nodraw material, then deselect it and select only designated visportal face by ctrl+shift clicking it in the cam window. Then assign the visportal material.
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_18.jpg" alt="Image" /><br /><br />Copy, clone roate... till it looks like this:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_19.jpg" alt="Image" /><br /><br />Save the map, compile it and load it up.
<br /><br />Enjoy your initial pleasure seeing a working door <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Beyond that you've achieved a seond goal - you have learnt how to block sufficiently the visibility.
<br /><br />Quick explanation:
<br />The engine draws every part of the level eve when you can't see it.
<br />This obviously is a bad idea for performance.
<br /><br />That's why you use visportals - these tell the engine how far it can look.
<br />If you see a visportal, the engine checks whether this visportal can see another visportal. If so then the engine checks whether this visportal can see another one - if the first visportal can't see the third, the engine wont rrender the world benind it - that's called "reducing overdraw" to throw in a catch phrase.
<br /><br />if you lower the console and enter "r_showPortals 1" you can see your visportals ingame.
<br /><br />Red means it's closed, nothing behind it get's rendered, green means it's open and renders stuff to the next red visportal (highly simplified, but I hope you get the concept):
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_20.jpg" alt="Image" /><br /><br />A viportal insice a func_door automatically actvates itself when the door opens.
<br /><br />By typing "r_showtris 3" in the console you'll get a nice wireframe view which shows you which triangles get rendered and which don't.
<br /><br />See how the corridor doesn't get rendered when the door is closed:
<br /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_21.jpg" alt="Image" /><br /><img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/doom3/tut/bna_tut2_box_doors_visportal/bna_tut2_box_drs_visprt_22.jpg" alt="Image" /><br /><br />As usual, it's late, I was in a hurry, needed the money and any possible excuse else for any potential errors, don't get me started on typos and exotic grammar...
<br /><br />Comments welcome below <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p29693" date="Posted: Fri Aug 06, 2004 10:16 pmÂ "><author>Hunter</author><body><![CDATA[<div class="postbody">The screenshots are a bit small, I can't tell what you are doing on some of them.</div>]]></body></post><post id="p29701" date="Posted: Fri Aug 06, 2004 10:40 pmÂ "><author>Acid303</author><body><![CDATA[<div class="postbody"><div class="quotetitle">Hunter wrote:</div><div class="quotecontent">The screenshots are a bit small, I can't tell what you are doing on some of them.</div>
<br />I have to agree on that <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> BNA! is obviously an experienced mapper, well I'll try to get the best out of this tommorow <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Thanx for the tutorial   <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p29714" date="Posted: Fri Aug 06, 2004 11:06 pmÂ "><author>BNA!</author><body><![CDATA[<div class="postbody">Yes, sorry for the small screens, but the tutorial is fairly long, so I didn't want users to wait an eternity for the screens to load, 56k users might drop dead then.
<br /><br />Try to follow the text - i'm rather sure you'll get along, if not, catch back here.</div>]]></body></post><post id="p29718" date="Posted: Fri Aug 06, 2004 11:13 pmÂ "><author>Acid303</author><body><![CDATA[<div class="postbody"><div class="quotetitle">BNA! wrote:</div><div class="quotecontent">Yes, sorry for the small screens, but the tutorial is fairly long, so I didn't want users to wait an eternity for the screens to load, 56k users might drop dead then.<br /><br />Try to follow the text - i'm rather sure you'll get along, if not, catch back here.</div>
<br />I'll try it out later today(first I need some sleep), thanx for your efforts <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Adding text seems like a good idea so this will probably be more helpfull now <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p29719" date="Posted: Fri Aug 06, 2004 11:14 pmÂ "><author>BNA!</author><body><![CDATA[<div class="postbody"><div class="quotetitle">Acid303 wrote:</div><div class="quotecontent">Adding text seems like a good idea so this will probably be more helpfull now <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>
<br /><br />I just hit submit instead of preview while typing it, that's why it was only small screens at first to the general public <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p29724" date="Posted: Fri Aug 06, 2004 11:18 pmÂ "><author>Vash</author><body><![CDATA[<div class="postbody">Skimmed through it; already know how to do it, but a great guide for people who dont <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" />.</div>]]></body></post><post id="p29725" date="Posted: Fri Aug 06, 2004 11:20 pmÂ "><author>Hunter</author><body><![CDATA[<div class="postbody">A quick question, what is the difference between nodraw and visportal?  Also, it is getting really annoying having to click stuff to rotate it, is there a faster way to rotate?</div>]]></body></post><post id="p29727" date="Posted: Fri Aug 06, 2004 11:22 pmÂ "><author>BNA!</author><body><![CDATA[<div class="postbody"><div class="quotetitle">Hunter wrote:</div><div class="quotecontent">A quick question, what is the difference between nodraw and visportal?  Also, it is getting really annoying having to click stuff to rotate it, is there a faster way to rotate?</div>
<br /><br />Nodraw is just a texture which doesn't draw in the game and is non-solid - visportal tells the renderer to place a visportal there and treat it as described in the tut.
<br /><br />rotating: look through the DoomEdit command list, but I don't think there's a different way.</div>]]></body></post><post id="p29728" date="Posted: Fri Aug 06, 2004 11:22 pmÂ "><author>BNA!</author><body><![CDATA[<div class="postbody"><div class="quotetitle">Vash wrote:</div><div class="quotecontent">Skimmed through it; already know how to do it, but a great guide for people who dont <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" />.</div>
<br /><br />That's the target audience <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p29729" date="Posted: Fri Aug 06, 2004 11:23 pmÂ "><author>Vash</author><body><![CDATA[<div class="postbody">Nodraw = deletes the polygon face that it is textured with. Its deleted forever, so it wont be rendered.
<br /><br />Visportal: Hides polygons that're being rendered beyond the players view. Usually, polygons behind a door (like walls and such - which you cannot see) are rendered, therefore adding more to the map to render, and putting more strain on your system. With visportal, it tells the engine not to render when the player cannot see.
<br /><br />I know I got the nodraw description right; but not entirley sure with Visportal.
<br /><br /><span style="font-weight: bold">[edit]</span>
<br /><br />Damn BNA, you beat me to it <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>]]></body></post><post id="p29733" date="Posted: Fri Aug 06, 2004 11:30 pmÂ "><author>Hunter</author><body><![CDATA[<div class="postbody">Hmmm, my visportals seem to be creating errors:
<br /><br />"WARNING: brush has multiple area portal sides at 488 696 100"
<br /><br />They work okay, but I would assume leaving these in there is bad mapping practice.</div>]]></body></post><post id="p29735" date="Posted: Fri Aug 06, 2004 11:36 pmÂ "><author>Vash</author><body><![CDATA[<div class="postbody">Using them correctly will greatly increase the size of your map and decrease load times <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" />. (Most likley anyway)</div>]]></body></post><post id="p29737" date="Posted: Fri Aug 06, 2004 11:43 pmÂ "><author>Hunter</author><body><![CDATA[<div class="postbody">Why would they increase the size of the map?</div>]]></body></post><post id="p29739" date="Posted: Fri Aug 06, 2004 11:50 pmÂ "><author>Vash</author><body><![CDATA[<div class="postbody">I meant you can increase the size of your map if you use stuff like nodraw, visportals, and other items like that. It'll cut down on polyogns and allow you to add more and more.</div>]]></body></post><post id="p29740" date="Posted: Fri Aug 06, 2004 11:52 pmÂ "><author>Hunter</author><body><![CDATA[<div class="postbody">Ah okay.  I still don't understand why you would use nodraw  <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>]]></body></post><post id="p29750" date="Posted: Sat Aug 07, 2004 12:05 amÂ "><author>BNA!</author><body><![CDATA[<div class="postbody"><div class="quotetitle">Hunter wrote:</div><div class="quotecontent">Ah okay.  I still don't understand why you would use nodraw  <img src="https://web.archive.org/web/20121105165634im_/http://www.doom3world.org/phpbb2/images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>
<br /><br />Sometimes you only want to have one side of your brush textured - then you use nodraw. Or when you scrip something and need invisible brushes as targets.</div>]]></body></post><post id="p29753" date="Posted: Sat Aug 07, 2004 12:09 amÂ "><author>Hunter</author><body><![CDATA[<div class="postbody">Ok.
<br /><br />What do you have to say about those errors I am getting (scroll up).</div>]]></body></post><post id="p29758" date="Posted: Sat Aug 07, 2004 12:19 amÂ "><author>Vash</author><body><![CDATA[<div class="postbody">Maybe one brush has three area portals on it? (Thats what it looks like anyway...)</div>]]></body></post><post id="p29834" date="Posted: Sat Aug 07, 2004 3:24 amÂ "><author>Coolbreeze78</author><body><![CDATA[<div class="postbody">Ok Im not sure what I am doing wrong here... 
<br /><br />Making the door... I right click on the area I want the door -&gt; choose Func -&gt; Func_Door.  I get a 4x4x2 block which I assume is ok.  Next I right click on the brush and choose New Model...
<br /><br />I get a box that says "Failed to create entity." I push ok and the Model viewer loads up.  Is this error normal or am I doing something wrong?</div>]]></body></post></posts></thread></xml>
