<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="23179"><title>(SOLVED) [Q4SDK] Speech text from lipSync title</title><posts><post id="p219206" date="Posted: Sun Oct 04, 2009 6:25 am "><author>adeonc</author><body><![CDATA[<div class="postbody">Alright, I came here to post that just because I really have no clue of how to do this (and I spend the last few hours trying to figure this out)<br /><br />In Misc.cpp, idFuncRadioChatter::Event_Activate<br /><br />There's a string called "sound".<br />sound = spawnArgs.GetString( "snd_radiochatter", "" );<br /><br />I noticed that it gets the value that's set on the map for the radio chatter event. Example: vo_1_2_18_20_1<br /><br />What I really need is to get the "text" label that's in some .lipsync file.<br />I also noticed that it's pretty unusual to have lipsync files for radio transmitions. Thus, I made a file called radio.lipsync and wrote few lines for test, like:<div class="codetitle"><b>Code:</b></div><div class="codecontent">lipSync vo_1_2_18_20_1<br />{<br />   description   "Corporal Kane, this is Strauss. I am in great danger. Rendezvous with me immediately!"<br />   text      "#str_300684"<br />   visemes   "english"   ""<br />   visemes   "french"   ""<br />   visemes   "italian"   ""<br />   visemes   "spanish"   ""<br />   visemes   "russian"   ""<br />   visemes   "polish"   ""<br />}</div>THEN, I'm trying to archieve a way to get this 'text' string in the ocasion. I imagined that it'd be useful to have the "sound" variable, that returns, in the example, vo_1_2_18_20_1. I think it might be possible to reach there through this identification, but I have no idea at all on how to do that.<br /><br />Any good ideas? My neurons are dying!<br /><br />Thanks.</div>]]></body></post><post id="p219211" date="Posted: Sun Oct 04, 2009 12:42 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">Once you've got the name of the decl, you can then use declManager to find it, and then pull the data out of it. I believe you should find the following code should do what you want:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">rvDeclLipSync *lipSync = declManager-&gt;FindLipSync(sound);<br />if (lipSync)<br />{<br />   const char *text = lipSync-&gt;GetTranscribeText();<br />   // you may need to convert the #str_xxxx string into the localised version using this<br />   // const char *localisedText = common-&gt;GetLocalizedString(text);<br />}</div><br /><br /><br />By the way, are you aware of the <a href="https://web.archive.org/web/20101225115413/http://www.moddb.com/mods/quake4cc/" class="postlink">Q4[CC] project</a>, which added closed captioning to Q4 already? It probably is abandonware now though.</div>]]></body></post><post id="p219214" date="Posted: Sun Oct 04, 2009 6:02 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Thanks for the help!<br /><br />It seems I had some approach to the solution last night if I compare with your code. Also, I had the same problem I'm having when I pasted it:<br /><img src="https://web.archive.org/web/20101225115413im_/http://i33.tinypic.com/2j1ne48.jpg" alt="Image" /><br /><img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br /><br />BTW, I'm aware of Q4[CC], but AFAIK it's for quake 1.3 (I'm currently using Q1.4), not to mention that the subtitles include also sounds effects... not really what I want.</div>]]></body></post><post id="p219215" date="Posted: Sun Oct 04, 2009 6:17 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">damn'ed consts <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />declare it as: "const rvDeclLipSync *lipSync = ...."<br /><br />The compiler is saying that FindDecl will only return a const object, ie one you cannot modify. But that should be fine for your needs, since you don't plan to modify the lipsync object.</div>]]></body></post><post id="p219218" date="Posted: Sun Oct 04, 2009 11:17 pm "><author>adeonc</author><body><![CDATA[<div class="postbody"><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">damn'ed consts <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />declare it as: "const rvDeclLipSync *lipSync = ...."<br /><br />The compiler is saying that FindDecl will only return a const object, ie one you cannot modify. But that should be fine for your needs, since you don't plan to modify the lipsync object.</div>WOa, that pretty much's gonna help me. You know, I'm a damn noob on C++. At least I'm learning quite much messing around with Quake 4 SDK.<br /><br />Thanks a million!<br /><br />EDIT: Oddly enough, my .lipsync files have no effect at all.<br />I copied lipsync folder to the .pk4 of my MOD. Then I noticed that the changes I make to these files change nothing.<br />For example, I changed the strings for hub_2.lipsync, just for test, and they're still the same ingame.<br /><br />What-a?<br />How to edit this bastard?<br /><br />Uhm... modifying the original pak file and it had effect. Then it means my pk4 file isn't priorized when loading the lipSync? Wtf?<br /><br />Thanks.</div>]]></body></post><post id="p219245" date="Posted: Tue Oct 06, 2009 3:27 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Help! Quake 4 isn't loading the .lipsync filesin my .pk4!</div>]]></body></post><post id="p219249" date="Posted: Tue Oct 06, 2009 4:19 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">You probably need to add a file of some other type into the pk4 - I've seen this a couple of times before with other filetypes. If you add an empty .def file in the "defs" folder, and it should pick up your pk4 file.<br /><br />I was going to have a go at reproducing your problem, but I haven't gotten around to it yet.<br /><br />One thing to check is that you're picking the "sound" variable up from the spawnArgs on the radiochatter entity and not inside the player. I think you're doing that right anyway, but worth checking since the code would compile in say the player entity, but would get back the wrong string.</div>]]></body></post><post id="p219273" date="Posted: Wed Oct 07, 2009 12:42 am "><author>adeonc</author><body><![CDATA[<div class="postbody"><img src="https://web.archive.org/web/20101225115413im_/http://i35.tinypic.com/n3os9j.png" alt="Image" /><br /><br />Okay, I've put the lipSync folder into my zpak_english.pk4 provisionally. Now I'm sure that your code works, thanks very much! Obviously, I'm gonna put your name (and this forum) into the credits, even if nobody's gonna ever download my MOD, I think <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br />The fact is that I'm doing this for my friends - mostly brazilians -, many can't understand spoken english.<br /><br />Anyway, I tried putting an empty "whatever.def" file into the folder defs in my pk4 and it didn't work. It seems that it loads everything but the .lipsync and .vismes files. Thats beyond weird IMO.<br />I really can't think of anything to try getting around this.<br /><img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br /><br /><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">One thing to check is that you're picking the "sound" variable up from the spawnArgs on the radiochatter entity and not inside the player. I think you're doing that right anyway, but worth checking since the code would compile in say the player entity, but would get back the wrong string.</div>Uhm... at least it's working, but your point makes sense... it's probably better to do that inside the player. Specially because I'm planning to put these subtitles into a multiplayer MOD later. But, first o'all, I wanna make these goddamn lipsync files load from my mod <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>]]></body></post><post id="p219295" date="Posted: Wed Oct 07, 2009 4:32 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Maybe I'm asking for too much help, but here I'm posting my unfinshed MOD.<br /><br />There, you can type on console <span style="font-style: italic">p_hud_debug 2</span> to see some info (including the phrase itself) whenever a NPC talks or the radio is activated.<br /><span style="font-style: italic">p_hud_debug 1</span> shows delay and stuff.<br /><br />Could you or anybody take a look and tell me what possibly's wrong with the lipSync files? (The map I'm using for testing is HUB 2)<br /><br />Thanks!</div>]]></body></post><post id="p219377" date="Posted: Sat Oct 10, 2009 9:55 am "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">Ok, well the main issue seems to be that you're not making pk4's the right way <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Your pk4 files seem to be .rar files that have been renamed, rather than .zip files that have been renamed. That is why Q4 cannot see the files inside it, as it uses zip not rar. If you re-pack the subtitlemod_beta.pk4 and pak001.pk4 files as zip files, it finds the contents.<br /><br />Having done that, I then found that your events.script has some errors in it (it references an unknown event or sth, but I guess you don't see the issue as it doesn't load it due to the pk4 issue). I've not debugged it, and have for now just removed it from the pk4.<br /><br />After making those tweaks it worked fine <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p219385" date="Posted: Sat Oct 10, 2009 1:36 pm "><author>adeonc</author><body><![CDATA[<div class="postbody"><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">Ok, well the main issue seems to be that you're not making pk4's the right way <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Your pk4 files seem to be .rar files that have been renamed, rather than .zip files that have been renamed. That is why Q4 cannot see the files inside it, as it uses zip not rar. If you re-pack the subtitlemod_beta.pk4 and pak001.pk4 files as zip files, it finds the contents.</div>Oh em gee, that was pretty simple, and how noob I am. I didn't even remember that I've changed the extension of a .rar. By the way, how did you find out which file type it was? <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /><br /><br /><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">Having done that, I then found that your events.script has some errors in it (it references an unknown event or sth, but I guess you don't see the issue as it doesn't load it due to the pk4 issue). I've not debugged it, and have for now just removed it from the pk4.</div>Oh, that's because in the beginning I thought that it's necessary to add an event with the name of the new void (UpdateSubtitle) in it. Now I already know that it's wrong, but hey, I think I'm less noob today than in the past few weeks <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Thanks a lot for the help <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div>]]></body></post><post id="p219390" date="Posted: Sat Oct 10, 2009 4:15 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody"><div class="quotetitle">adeonc wrote:</div><div class="quotecontent">Oh em gee, that was pretty simple, and how noob I am. I didn't even remember that I've changed the extension of a .rar. By the way, how did you find out which file type it was? <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /></div><br />I have pk4 associated with the XP built in zip support so that I can just browse them with explorer, so double-clicking it told me it was a "corrupt zip file", at which point I guessed it was something like that. Opening it in a hex editor (I used Visual Studio) showed the first 4 bytes as "Rar!"<br /><br /><div class="quotetitle">adeonc wrote:</div><div class="quotecontent">Thanks a lot for the help <img src="https://web.archive.org/web/20101225115413im_/http://www.doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div><br /><br />No probs, glad it's now working</div>]]></body></post><post id="p219206" date="Posted: Sun Oct 04, 2009 6:25 am "><author>adeonc</author><body><![CDATA[<div class="postbody">Alright, I came here to post that just because I really have no clue of how to do this (and I spend the last few hours trying to figure this out)<br /><br />In Misc.cpp, idFuncRadioChatter::Event_Activate<br /><br />There's a string called "sound".<br />sound = spawnArgs.GetString( "snd_radiochatter", "" );<br /><br />I noticed that it gets the value that's set on the map for the radio chatter event. Example: vo_1_2_18_20_1<br /><br />What I really need is to get the "text" label that's in some .lipsync file.<br />I also noticed that it's pretty unusual to have lipsync files for radio transmitions. Thus, I made a file called radio.lipsync and wrote few lines for test, like:<div class="codetitle"><b>Code:</b></div><div class="codecontent">lipSync vo_1_2_18_20_1<br />{<br />   description   "Corporal Kane, this is Strauss. I am in great danger. Rendezvous with me immediately!"<br />   text      "#str_300684"<br />   visemes   "english"   ""<br />   visemes   "french"   ""<br />   visemes   "italian"   ""<br />   visemes   "spanish"   ""<br />   visemes   "russian"   ""<br />   visemes   "polish"   ""<br />}</div>THEN, I'm trying to archieve a way to get this 'text' string in the ocasion. I imagined that it'd be useful to have the "sound" variable, that returns, in the example, vo_1_2_18_20_1. I think it might be possible to reach there through this identification, but I have no idea at all on how to do that.<br /><br />Any good ideas? My neurons are dying!<br /><br />Thanks.</div>]]></body></post><post id="p219211" date="Posted: Sun Oct 04, 2009 12:42 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">Once you've got the name of the decl, you can then use declManager to find it, and then pull the data out of it. I believe you should find the following code should do what you want:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">rvDeclLipSync *lipSync = declManager-&gt;FindLipSync(sound);<br />if (lipSync)<br />{<br />   const char *text = lipSync-&gt;GetTranscribeText();<br />   // you may need to convert the #str_xxxx string into the localised version using this<br />   // const char *localisedText = common-&gt;GetLocalizedString(text);<br />}</div><br /><br /><br />By the way, are you aware of the <a href="https://web.archive.org/web/20101225114354/http://www.moddb.com/mods/quake4cc/" class="postlink">Q4[CC] project</a>, which added closed captioning to Q4 already? It probably is abandonware now though.</div>]]></body></post><post id="p219214" date="Posted: Sun Oct 04, 2009 6:02 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Thanks for the help!<br /><br />It seems I had some approach to the solution last night if I compare with your code. Also, I had the same problem I'm having when I pasted it:<br /><img src="https://web.archive.org/web/20101225114354im_/http://i33.tinypic.com/2j1ne48.jpg" alt="Image" /><br /><img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br /><br />BTW, I'm aware of Q4[CC], but AFAIK it's for quake 1.3 (I'm currently using Q1.4), not to mention that the subtitles include also sounds effects... not really what I want.</div>]]></body></post><post id="p219215" date="Posted: Sun Oct 04, 2009 6:17 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">damn'ed consts <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />declare it as: "const rvDeclLipSync *lipSync = ...."<br /><br />The compiler is saying that FindDecl will only return a const object, ie one you cannot modify. But that should be fine for your needs, since you don't plan to modify the lipsync object.</div>]]></body></post><post id="p219218" date="Posted: Sun Oct 04, 2009 11:17 pm "><author>adeonc</author><body><![CDATA[<div class="postbody"><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">damn'ed consts <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />declare it as: "const rvDeclLipSync *lipSync = ...."<br /><br />The compiler is saying that FindDecl will only return a const object, ie one you cannot modify. But that should be fine for your needs, since you don't plan to modify the lipsync object.</div>WOa, that pretty much's gonna help me. You know, I'm a damn noob on C++. At least I'm learning quite much messing around with Quake 4 SDK.<br /><br />Thanks a million!<br /><br />EDIT: Oddly enough, my .lipsync files have no effect at all.<br />I copied lipsync folder to the .pk4 of my MOD. Then I noticed that the changes I make to these files change nothing.<br />For example, I changed the strings for hub_2.lipsync, just for test, and they're still the same ingame.<br /><br />What-a?<br />How to edit this bastard?<br /><br />Uhm... modifying the original pak file and it had effect. Then it means my pk4 file isn't priorized when loading the lipSync? Wtf?<br /><br />Thanks.</div>]]></body></post><post id="p219245" date="Posted: Tue Oct 06, 2009 3:27 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Help! Quake 4 isn't loading the .lipsync filesin my .pk4!</div>]]></body></post><post id="p219249" date="Posted: Tue Oct 06, 2009 4:19 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">You probably need to add a file of some other type into the pk4 - I've seen this a couple of times before with other filetypes. If you add an empty .def file in the "defs" folder, and it should pick up your pk4 file.<br /><br />I was going to have a go at reproducing your problem, but I haven't gotten around to it yet.<br /><br />One thing to check is that you're picking the "sound" variable up from the spawnArgs on the radiochatter entity and not inside the player. I think you're doing that right anyway, but worth checking since the code would compile in say the player entity, but would get back the wrong string.</div>]]></body></post><post id="p219273" date="Posted: Wed Oct 07, 2009 12:42 am "><author>adeonc</author><body><![CDATA[<div class="postbody"><img src="https://web.archive.org/web/20101225114354im_/http://i35.tinypic.com/n3os9j.png" alt="Image" /><br /><br />Okay, I've put the lipSync folder into my zpak_english.pk4 provisionally. Now I'm sure that your code works, thanks very much! Obviously, I'm gonna put your name (and this forum) into the credits, even if nobody's gonna ever download my MOD, I think <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br />The fact is that I'm doing this for my friends - mostly brazilians -, many can't understand spoken english.<br /><br />Anyway, I tried putting an empty "whatever.def" file into the folder defs in my pk4 and it didn't work. It seems that it loads everything but the .lipsync and .vismes files. Thats beyond weird IMO.<br />I really can't think of anything to try getting around this.<br /><img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br /><br /><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">One thing to check is that you're picking the "sound" variable up from the spawnArgs on the radiochatter entity and not inside the player. I think you're doing that right anyway, but worth checking since the code would compile in say the player entity, but would get back the wrong string.</div>Uhm... at least it's working, but your point makes sense... it's probably better to do that inside the player. Specially because I'm planning to put these subtitles into a multiplayer MOD later. But, first o'all, I wanna make these goddamn lipsync files load from my mod <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>]]></body></post><post id="p219295" date="Posted: Wed Oct 07, 2009 4:32 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Maybe I'm asking for too much help, but here I'm posting my unfinshed MOD.<br /><br />There, you can type on console <span style="font-style: italic">p_hud_debug 2</span> to see some info (including the phrase itself) whenever a NPC talks or the radio is activated.<br /><span style="font-style: italic">p_hud_debug 1</span> shows delay and stuff.<br /><br />Could you or anybody take a look and tell me what possibly's wrong with the lipSync files? (The map I'm using for testing is HUB 2)<br /><br />Thanks!</div>]]></body></post><post id="p219377" date="Posted: Sat Oct 10, 2009 9:55 am "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">Ok, well the main issue seems to be that you're not making pk4's the right way <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Your pk4 files seem to be .rar files that have been renamed, rather than .zip files that have been renamed. That is why Q4 cannot see the files inside it, as it uses zip not rar. If you re-pack the subtitlemod_beta.pk4 and pak001.pk4 files as zip files, it finds the contents.<br /><br />Having done that, I then found that your events.script has some errors in it (it references an unknown event or sth, but I guess you don't see the issue as it doesn't load it due to the pk4 issue). I've not debugged it, and have for now just removed it from the pk4.<br /><br />After making those tweaks it worked fine <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p219385" date="Posted: Sat Oct 10, 2009 1:36 pm "><author>adeonc</author><body><![CDATA[<div class="postbody"><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">Ok, well the main issue seems to be that you're not making pk4's the right way <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Your pk4 files seem to be .rar files that have been renamed, rather than .zip files that have been renamed. That is why Q4 cannot see the files inside it, as it uses zip not rar. If you re-pack the subtitlemod_beta.pk4 and pak001.pk4 files as zip files, it finds the contents.</div>Oh em gee, that was pretty simple, and how noob I am. I didn't even remember that I've changed the extension of a .rar. By the way, how did you find out which file type it was? <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /><br /><br /><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">Having done that, I then found that your events.script has some errors in it (it references an unknown event or sth, but I guess you don't see the issue as it doesn't load it due to the pk4 issue). I've not debugged it, and have for now just removed it from the pk4.</div>Oh, that's because in the beginning I thought that it's necessary to add an event with the name of the new void (UpdateSubtitle) in it. Now I already know that it's wrong, but hey, I think I'm less noob today than in the past few weeks <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Thanks a lot for the help <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div>]]></body></post><post id="p219390" date="Posted: Sat Oct 10, 2009 4:15 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody"><div class="quotetitle">adeonc wrote:</div><div class="quotecontent">Oh em gee, that was pretty simple, and how noob I am. I didn't even remember that I've changed the extension of a .rar. By the way, how did you find out which file type it was? <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /></div><br />I have pk4 associated with the XP built in zip support so that I can just browse them with explorer, so double-clicking it told me it was a "corrupt zip file", at which point I guessed it was something like that. Opening it in a hex editor (I used Visual Studio) showed the first 4 bytes as "Rar!"<br /><br /><div class="quotetitle">adeonc wrote:</div><div class="quotecontent">Thanks a lot for the help <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div><br /><br />No probs, glad it's now working</div>]]></body></post><post id="p219206" date="Posted: Sun Oct 04, 2009 6:25 am "><author>adeonc</author><body><![CDATA[<div class="postbody">Alright, I came here to post that just because I really have no clue of how to do this (and I spend the last few hours trying to figure this out)<br /><br />In Misc.cpp, idFuncRadioChatter::Event_Activate<br /><br />There's a string called "sound".<br />sound = spawnArgs.GetString( "snd_radiochatter", "" );<br /><br />I noticed that it gets the value that's set on the map for the radio chatter event. Example: vo_1_2_18_20_1<br /><br />What I really need is to get the "text" label that's in some .lipsync file.<br />I also noticed that it's pretty unusual to have lipsync files for radio transmitions. Thus, I made a file called radio.lipsync and wrote few lines for test, like:<div class="codetitle"><b>Code:</b></div><div class="codecontent">lipSync vo_1_2_18_20_1<br />{<br />   description   "Corporal Kane, this is Strauss. I am in great danger. Rendezvous with me immediately!"<br />   text      "#str_300684"<br />   visemes   "english"   ""<br />   visemes   "french"   ""<br />   visemes   "italian"   ""<br />   visemes   "spanish"   ""<br />   visemes   "russian"   ""<br />   visemes   "polish"   ""<br />}</div>THEN, I'm trying to archieve a way to get this 'text' string in the ocasion. I imagined that it'd be useful to have the "sound" variable, that returns, in the example, vo_1_2_18_20_1. I think it might be possible to reach there through this identification, but I have no idea at all on how to do that.<br /><br />Any good ideas? My neurons are dying!<br /><br />Thanks.</div>]]></body></post><post id="p219211" date="Posted: Sun Oct 04, 2009 12:42 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">Once you've got the name of the decl, you can then use declManager to find it, and then pull the data out of it. I believe you should find the following code should do what you want:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">rvDeclLipSync *lipSync = declManager-&gt;FindLipSync(sound);<br />if (lipSync)<br />{<br />   const char *text = lipSync-&gt;GetTranscribeText();<br />   // you may need to convert the #str_xxxx string into the localised version using this<br />   // const char *localisedText = common-&gt;GetLocalizedString(text);<br />}</div><br /><br /><br />By the way, are you aware of the <a href="https://web.archive.org/web/20101225114354/http://www.moddb.com/mods/quake4cc/" class="postlink">Q4[CC] project</a>, which added closed captioning to Q4 already? It probably is abandonware now though.</div>]]></body></post><post id="p219214" date="Posted: Sun Oct 04, 2009 6:02 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Thanks for the help!<br /><br />It seems I had some approach to the solution last night if I compare with your code. Also, I had the same problem I'm having when I pasted it:<br /><img src="https://web.archive.org/web/20101225114354im_/http://i33.tinypic.com/2j1ne48.jpg" alt="Image" /><br /><img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br /><br />BTW, I'm aware of Q4[CC], but AFAIK it's for quake 1.3 (I'm currently using Q1.4), not to mention that the subtitles include also sounds effects... not really what I want.</div>]]></body></post><post id="p219215" date="Posted: Sun Oct 04, 2009 6:17 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">damn'ed consts <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />declare it as: "const rvDeclLipSync *lipSync = ...."<br /><br />The compiler is saying that FindDecl will only return a const object, ie one you cannot modify. But that should be fine for your needs, since you don't plan to modify the lipsync object.</div>]]></body></post><post id="p219218" date="Posted: Sun Oct 04, 2009 11:17 pm "><author>adeonc</author><body><![CDATA[<div class="postbody"><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">damn'ed consts <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />declare it as: "const rvDeclLipSync *lipSync = ...."<br /><br />The compiler is saying that FindDecl will only return a const object, ie one you cannot modify. But that should be fine for your needs, since you don't plan to modify the lipsync object.</div>WOa, that pretty much's gonna help me. You know, I'm a damn noob on C++. At least I'm learning quite much messing around with Quake 4 SDK.<br /><br />Thanks a million!<br /><br />EDIT: Oddly enough, my .lipsync files have no effect at all.<br />I copied lipsync folder to the .pk4 of my MOD. Then I noticed that the changes I make to these files change nothing.<br />For example, I changed the strings for hub_2.lipsync, just for test, and they're still the same ingame.<br /><br />What-a?<br />How to edit this bastard?<br /><br />Uhm... modifying the original pak file and it had effect. Then it means my pk4 file isn't priorized when loading the lipSync? Wtf?<br /><br />Thanks.</div>]]></body></post><post id="p219245" date="Posted: Tue Oct 06, 2009 3:27 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Help! Quake 4 isn't loading the .lipsync filesin my .pk4!</div>]]></body></post><post id="p219249" date="Posted: Tue Oct 06, 2009 4:19 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">You probably need to add a file of some other type into the pk4 - I've seen this a couple of times before with other filetypes. If you add an empty .def file in the "defs" folder, and it should pick up your pk4 file.<br /><br />I was going to have a go at reproducing your problem, but I haven't gotten around to it yet.<br /><br />One thing to check is that you're picking the "sound" variable up from the spawnArgs on the radiochatter entity and not inside the player. I think you're doing that right anyway, but worth checking since the code would compile in say the player entity, but would get back the wrong string.</div>]]></body></post><post id="p219273" date="Posted: Wed Oct 07, 2009 12:42 am "><author>adeonc</author><body><![CDATA[<div class="postbody"><img src="https://web.archive.org/web/20101225114354im_/http://i35.tinypic.com/n3os9j.png" alt="Image" /><br /><br />Okay, I've put the lipSync folder into my zpak_english.pk4 provisionally. Now I'm sure that your code works, thanks very much! Obviously, I'm gonna put your name (and this forum) into the credits, even if nobody's gonna ever download my MOD, I think <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br />The fact is that I'm doing this for my friends - mostly brazilians -, many can't understand spoken english.<br /><br />Anyway, I tried putting an empty "whatever.def" file into the folder defs in my pk4 and it didn't work. It seems that it loads everything but the .lipsync and .vismes files. Thats beyond weird IMO.<br />I really can't think of anything to try getting around this.<br /><img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br /><br /><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">One thing to check is that you're picking the "sound" variable up from the spawnArgs on the radiochatter entity and not inside the player. I think you're doing that right anyway, but worth checking since the code would compile in say the player entity, but would get back the wrong string.</div>Uhm... at least it's working, but your point makes sense... it's probably better to do that inside the player. Specially because I'm planning to put these subtitles into a multiplayer MOD later. But, first o'all, I wanna make these goddamn lipsync files load from my mod <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>]]></body></post><post id="p219295" date="Posted: Wed Oct 07, 2009 4:32 pm "><author>adeonc</author><body><![CDATA[<div class="postbody">Maybe I'm asking for too much help, but here I'm posting my unfinshed MOD.<br /><br />There, you can type on console <span style="font-style: italic">p_hud_debug 2</span> to see some info (including the phrase itself) whenever a NPC talks or the radio is activated.<br /><span style="font-style: italic">p_hud_debug 1</span> shows delay and stuff.<br /><br />Could you or anybody take a look and tell me what possibly's wrong with the lipSync files? (The map I'm using for testing is HUB 2)<br /><br />Thanks!</div>]]></body></post><post id="p219377" date="Posted: Sat Oct 10, 2009 9:55 am "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">Ok, well the main issue seems to be that you're not making pk4's the right way <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Your pk4 files seem to be .rar files that have been renamed, rather than .zip files that have been renamed. That is why Q4 cannot see the files inside it, as it uses zip not rar. If you re-pack the subtitlemod_beta.pk4 and pak001.pk4 files as zip files, it finds the contents.<br /><br />Having done that, I then found that your events.script has some errors in it (it references an unknown event or sth, but I guess you don't see the issue as it doesn't load it due to the pk4 issue). I've not debugged it, and have for now just removed it from the pk4.<br /><br />After making those tweaks it worked fine <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p219385" date="Posted: Sat Oct 10, 2009 1:36 pm "><author>adeonc</author><body><![CDATA[<div class="postbody"><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">Ok, well the main issue seems to be that you're not making pk4's the right way <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Your pk4 files seem to be .rar files that have been renamed, rather than .zip files that have been renamed. That is why Q4 cannot see the files inside it, as it uses zip not rar. If you re-pack the subtitlemod_beta.pk4 and pak001.pk4 files as zip files, it finds the contents.</div>Oh em gee, that was pretty simple, and how noob I am. I didn't even remember that I've changed the extension of a .rar. By the way, how did you find out which file type it was? <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /><br /><br /><div class="quotetitle">AnthonyJa wrote:</div><div class="quotecontent">Having done that, I then found that your events.script has some errors in it (it references an unknown event or sth, but I guess you don't see the issue as it doesn't load it due to the pk4 issue). I've not debugged it, and have for now just removed it from the pk4.</div>Oh, that's because in the beginning I thought that it's necessary to add an event with the name of the new void (UpdateSubtitle) in it. Now I already know that it's wrong, but hey, I think I'm less noob today than in the past few weeks <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Thanks a lot for the help <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div>]]></body></post><post id="p219390" date="Posted: Sat Oct 10, 2009 4:15 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody"><div class="quotetitle">adeonc wrote:</div><div class="quotecontent">Oh em gee, that was pretty simple, and how noob I am. I didn't even remember that I've changed the extension of a .rar. By the way, how did you find out which file type it was? <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /></div><br />I have pk4 associated with the XP built in zip support so that I can just browse them with explorer, so double-clicking it told me it was a "corrupt zip file", at which point I guessed it was something like that. Opening it in a hex editor (I used Visual Studio) showed the first 4 bytes as "Rar!"<br /><br /><div class="quotetitle">adeonc wrote:</div><div class="quotecontent">Thanks a lot for the help <img src="https://web.archive.org/web/20101225114354im_/http://www.doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div><br /><br />No probs, glad it's now working</div>]]></body></post></posts></thread></xml>
