<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="17402"><title>Need help with custom skin files</title><posts><post id="p158709" date="Posted: Tue Oct 03, 2006 2:19 pm "><author>Tetzlaff</author><body><![CDATA[<div class="postbody">I made an alternative skin for the Z-Sec, consisting of a custom diffuse map, specular map and normal map. What I want to do is apply my custom skin to a model in the editor, just like you can apply the alternative a_hellimp skin to the Imp. 
<br />So, my goal is to have a regular zsec_pistol standing in my level side by side with a zsec_machinegun who is wearing my new custom skin.
<br /><br />I tried to set it up this way. The 3 new skin textures are named 
<br /><br />mgsecurity.tga 
<br />mgsecurity_local.tga
<br />mgsecurity_s.tga
<br /><br />and placed in 
<br /><br />models/characters/male_npc/security
<br /><br />(just like the regular dsecurity skin). I also put .dds versions of the textures in the respective directory.
<br /><br />Then I created a new .mtr file in "materials" named tetz_monsters.mtr :
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">models/characters/male_npc/security/mgsecurity<br />{<br />        noselfShadow<br />        clamp<br />      unsmoothedTangents<br />      flesh<br />      forceOverlays<br /><br />   {   // burning corpse effect<br />      if   parm7         // only when dead<br />      // make a burned away alpha test for the normal skin<br />      blend   gl_zero, gl_one         // don't draw anything<br />      <br />      map models/monsters/spectre/global_dis.tga   // replace this with a monster-specific texture<br />      alphaTest 0.05 + 1.5 * (time - parm7)<br />   }<br /><br /><br />       diffusemap     models/characters/male_npc/security/mgsecurity.tga<br /><br />      {<br />         blend bumpmap<br />          map  addnormals(models/characters/male_npc/security/mgsecurity_local.tga, heightmap(models/characters/male_npc/security/security_h.tga, 5 ) )<br />         <br />        }<br />        specularmap   models/characters/male_npc/security/mgsecurity_s.tga<br />}</div><br /><br />Then I created a skin file in "skins" named skins_monsters_tetz.skin, but I´m totally confused, don´t know how I should set this all up correctly. Is the mtr file done right, and if yes, how do I reference it in the .skin file?<br /><br />All files are packed in a pk4 file named skn_zsec.pk4 and put in the Doom3 base directory. The skin textures are working allright when I set them up as replacement skins (replacing all the Zsec skins alike), so the problem really lies in the mtr. and .skin files.<br /><br /><br />edit: I can select my skin in the editor, and when I apply it to the model the value is<br /><br />skins/models/monsters/mgsecurity<br /><br />but in game, it still shows the standard Zsec skin instead of my custom skin. <br />My skin file:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">skin skins/models/monsters/mgsecurity {<br />   models/characters/male_npc/security/security models/characters/male_npc/security/mgsecurity<br />   }</div></div>]]></body></post><post id="p158716" date="Posted: Tue Oct 03, 2006 4:48 pm "><author>der_ton</author><body><![CDATA[<div class="postbody">These links might help:
<br /><!-- m --><a class="postlink" href="/web/20070509181516/http://www.modwiki.net/wiki/Skin_%28decl%29">http://www.modwiki.net/wiki/Skin_%28decl%29</a><!-- m -->
<br /><!-- m --><a class="postlink" href="/web/20070509181516/http://iddevnet.com/doom3/skins.php">http://iddevnet.com/doom3/skins.php</a><!-- m -->
<br /><br />If you still have problems, also post your skin file. <img src="/web/20070509181516im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />You can test if your material is working by applying it to level geometry in the map editor, or by modifying a .md5mesh file so that it uses your new material directly.</div>]]></body></post><post id="p158720" date="Posted: Tue Oct 03, 2006 6:17 pm "><author>Tetzlaff</author><body><![CDATA[<div class="postbody">Thanks, I will see if I can figure it out.</div>]]></body></post><post id="p158784" date="Posted: Wed Oct 04, 2006 8:50 am "><author>Tetzlaff</author><body><![CDATA[<div class="postbody">I still can not get it to work. I updated my post above with the .skin file.
<br /><br />I can select my skin in the editor, but after I apply it to the model, it still shows the standard Zsec skin. Could somebody maybe check the code? I can´t see where the error is.</div>]]></body></post><post id="p158785" date="Posted: Wed Oct 04, 2006 9:14 am "><author>der_ton</author><body><![CDATA[<div class="postbody">I think I read somewhere that skins are not applied in the editor, but ingame.
<br /><br />Can you check this?</div>]]></body></post><post id="p158786" date="Posted: Wed Oct 04, 2006 9:28 am "><author>6th Venom</author><body><![CDATA[<div class="postbody">more simple to create a new entity like:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">model npc_mgsecurity {<br />   inherit            model npc_security<br />        skin                             skins/models/monsters/mgsecurity<br />}<br /></div><br /><br />...cause the standard npc_security model define a skin too:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">model npc_security {<br />   inherit                     npc_base<br />   mesh                     models/md5/chars/security.md5mesh<br />   skin                     skins/characters/npcs/regsec.skin<br />   channel torso               ( *Waist )<br />   channel legs               ( origin Body Body2 *Hips -*Waist SPINNER eyecontrol chair)<br /><br />}<br /></div>
<br />Maybe that's the problem, so rather than define a skin in the editor, define a model (the new one with the right skin).</div>]]></body></post><post id="p158788" date="Posted: Wed Oct 04, 2006 9:47 am "><author>Tetzlaff</author><body><![CDATA[<div class="postbody"><div class="quotetitle">der_ton wrote:</div><div class="quotecontent">I think I read somewhere that skins are not applied in the editor, but ingame.<br /><br />Can you check this?</div>
<br /><br />I don´t think so, you can apply the a_hellimp skin to the Imp in the Editor, I think that´s the way it´s supposed to work.
<br /><br />@ 6th Venom: when I create a new entity like that, will it still work with the Zsec monster?</div>]]></body></post><post id="p158791" date="Posted: Wed Oct 04, 2006 10:44 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">Applying a skin is as simple as setting an entity's "skin" key/value pair.
<br /><br />You can do that from within the editor, in a script, or in a custom entity declaration. Anywhere you can set key/value pairs.</div>]]></body></post><post id="p158795" date="Posted: Wed Oct 04, 2006 11:23 am "><author>Tetzlaff</author><body><![CDATA[<div class="postbody">So what am I doing wrong here? I put a Zsec into my map, applied to the key "skin" the value "skins/models/monsters/mgsecurity", but there is no result in game.</div>]]></body></post><post id="p158802" date="Posted: Wed Oct 04, 2006 1:18 pm "><author>6th Venom</author><body><![CDATA[<div class="postbody">the original shader for the security model (and the dead one too) is <span style="font-weight: bold">models/characters/male_npc/security/dsecurity</span>, so you skin should be:<div class="codetitle"><b>Code:</b></div><div class="codecontent">skin skins/models/monsters/mgsecurity {<br />models/characters/male_npc/security/dsecurity models/characters/male_npc/security/mgsecurity<br />}</div>
<br />that's the real problem i think.  <img src="/web/20070509181516im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p158804" date="Posted: Wed Oct 04, 2006 1:46 pm "><author>Tetzlaff</author><body><![CDATA[<div class="postbody">Thank you very much Venom, now it´s working!
<br /><br />Only a small problem left: there is the underlying skeleton model visible at some points, probably have to make it nodraw somehow. I think someone had a similar problem, will do a search.
<br /><br />edit: And another problem... the skin works fine until the Zsec is dead - then suddenly the standard skin is displayed.
<br /><br />edit 2: found some info here <!-- m --><a class="postlink" href="/web/20070509181516/http://www.doom3world.org/phpbb2/viewtopic.php?t=15993">http://www.doom3world.org/phpbb2/viewtopic.php?t=15993</a><!-- m --></div>]]></body></post><post id="p158895" date="Posted: Thu Oct 05, 2006 5:06 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">Determine what model is used for that entity and open it in a text editor to find out what material shaders are referenced. You can then edit your skin to accomidate whatever shader is responcible for the skeleton portion of the mesh.
<br /><br />Most of the enemies in the game are removed when they die and are replaced by ragdoll entities. But because the ragdoll does not have the same "skin" key/value pair, it's no surprise that the skin is not applied.
<br /><br />The trick here is to create a new ragdoll entity by writing a new entity definition. In this new definition you'd inherit the key/value pairs from the original ragdoll but add a "skin" key/value pair that uses your custom skin.
<br /><br />From that point it's simply a matter of pointing the "ragdoll" key/value pair of the actor to your custom ragdoll definition.</div>]]></body></post><post id="p158946" date="Posted: Fri Oct 06, 2006 9:49 am "><author>Tetzlaff</author><body><![CDATA[<div class="postbody">Thanks, I will try this.
<br /><br /><div class="quotetitle">rich_is_bored wrote:</div><div class="quotecontent">The trick here is to create a new ragdoll entity by writing a new entity definition. In this new definition you'd inherit the key/value pairs from the original ragdoll but add a "skin" key/value pair that uses your custom skin.</div>
<br /><br />For this new entity definition, I`ll have to write a new .def file, where I have to add my custom definitions? So I basicly create a new monster type, which references to the standard Zsec, except for the skins?</div>]]></body></post><post id="p158949" date="Posted: Fri Oct 06, 2006 10:09 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">You put custom definitions files in a "def" folder.
<br /><br />And no, you're not creating a new monster type. You're creating a new ragdoll type.
<br /><br />For clarification, look at the zsec's entity declaration. Find the "ragdoll" key/value pair. That entity is the ragdoll entity used for the zsec.
<br /><br />You create a new entity declaration that looks something like this...
<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">entityDef myCustomRagdoll<br />{<br />   "inherit" "whatever the old ragdoll is called"<br />   "skin"   "myCustomSkin"<br />}</div>
<br /><br />Now I'm not sure where you are setting the skin key/value pair for the zsec but you'd set the ragdoll key/value pair in the same manner only this time you point it to your custom entity declaration.</div>]]></body></post></posts></thread></xml>
