<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="17463"><title>Entity's attached light.</title><posts><post id="p159161" date="Posted: Sun Oct 08, 2006 10:18 pm "><author>6th Venom</author><body><![CDATA[<div class="postbody">Ok, i did try to attach a light on an entity (a lamp) directly into the entitydef, but didn't achieve it.  <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_cry.gif" alt=":cry:" title="Crying or Very sad" /><br />I tested:&#13;<br />-to make a light entity and "def_attach" it to my lamp model...&#13;<br />-to define a mtr_light_shader with all the params (radius, color, etc.)...&#13;<br />-to make a light, with my lamp for model...&#13;<br /><br />...but none of this allow me to create a moveable lamp that start on (the 2 first don't work at all), breakable with debris (the 3rd don't) that turn off when dead, without any scripts.&#13;<br /><br />I planned to use it a lot in a map, and i don't want to make a big script for checking each lamp to know if i got to remove or not the appropriate light.&#13;<br /><br />Anyone did something similar? How?&#13;<br /><br />If i really got to use script, how can i make only one generic loop that check any death/break (let's say lamp1_1), then remove "/n"_light (lamp1_1_light) at the same time.&#13;<br />Like this, i will bind lamp1_1_light to lamp1_1, lamp1_2_light to lamp1_2, etc. in the editor, and let this little loop erase appropriate light if i break a lamp.&#13;<br /><br />Any idea?&#13;<br /><br />Thanks all.&#13;<br /><br />EDIT: the 2 firsts don't work cause i use ASEs for models and collisions, don't allow to attach to any joints (cause don't got any bones).&#13;<br />EDIT2: I tested with a Md5mesh+AF (for moveable) but i still can't "def_attach" a light to it...</div>]]></body></post><post id="p159212" date="Posted: Mon Oct 09, 2006 7:00 pm "><author>6th Venom</author><body><![CDATA[<div class="postbody">I did a small script to create &amp; bind a light (my light entity) to lamp models, here it is:&#13;<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void create_lamplight (entity ent_lamp){<br />     vector light_origin;<br />     string light_name;<br />     entity light_ent;<br /><br />     light_name=ent_lamp.getName()+"_light";<br />     light_origin=ent_lamp.getVectorKey("origin");<br /><br />     sys.setSpawnArg("origin", light_origin);<br />     sys.setSpawnArg("name", light_name);<br /><br />     light_ent=sys.spawn("env_lamp1_light");<br /><br />     light_ent.bindPosition(ent_lamp);<br />}<br /><br /><br />void setup_objects()<br />{<br />     create_lamplight($env_lamp1_on_breakable_1);<br />}<br /><br />// function that executes when script is loaded<br /><br />void main ()<br />{<br />   setup_objects();<br />}</div>&#13;<br /><br />Now i got a couple of new questions:&#13;<br />A) If i call the "create_lamplight" script directly into the entities editor (mapeditor) by each lamps entities, will it work like i placed it in the "setup_objects" script? (like i did here for $env_lamp1_on_breakable_1)&#13;<br /><br />B) What Script events should i use to check entities death? (i can't just run a loop with all my $env_lamps check "health" stat [getFloatKey("health")] at each frame  <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> , plus i don't know how many will be in my map)&#13;<br /><br />Please, noobcoder (me) really need help on this!  <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /></div>]]></body></post><post id="p159215" date="Posted: Mon Oct 09, 2006 7:35 pm "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">The only way to call functions from within the level editor is to assign a "call" key/value pair to an entity and point it to the function you wish to run. However, I can't remember if that sort of thing works with parameters.&#13;<br /><br />But the more important issue is that entities who are setup to call functions in that manner, won't call anything until they are triggered.&#13;<br /><br />As for your second question, key/value pairs are not always updated. Most of them, including the "health" key/value pair, are only used as spawn arguments.&#13;<br /><br />In other words, you could monitor the "health" key/value pair but it wouldn't reflect any changes to an entities actual health value. All the key/value pair does is tell the game how much health the entity should start with.&#13;<br /><br />You do realize however that light entities can be "broken" and they can have models assigned to them? That's probably the approach you should be going for.</div>]]></body></post><post id="p159228" date="Posted: Mon Oct 09, 2006 8:38 pm "><author>6th Venom</author><body><![CDATA[<div class="postbody">First of all, thank you rich to answer! damn, i hoped an answer so long...  <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /><br /><br />Secondly, all you say look like to be justified and true.&#13;<br />But i got one problem with the "broken" light method, i can't spawn debris with that (or actually i did not succed doing it)...&#13;<br /><br />So i made an upgrade of my little script with my little knowledge (learn as i need):&#13;<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void create_lamplight (entity ent_lamp){<br />     vector light_origin;<br />     string light_name;<br />     entity light_ent;<br /><br />     light_name=ent_lamp.getName()+"_light";<br />     light_origin=ent_lamp.getVectorKey("origin");<br /><br />     sys.setSpawnArg("origin", light_origin);<br />     sys.setSpawnArg("name", light_name);<br /><br />     light_ent=sys.spawn("env_lamp1_light");<br /><br />     light_ent.bindPosition(ent_lamp);<br />}<br /><br />void remove_lamplight (entity ent_lamp){<br />     float  ent_health;<br />     string ent_name;<br />     entity ent_light;<br /><br />     ent_name=ent_lamp.getName()+"_light";<br />     ent_light=sys.getEntity(ent_name);<br />     ent_light.remove();<br />}<br /><br />void check_lamplight (entity ent_lamp){<br />     float  ent_health;<br />     string ent_name;<br />     entity ent_light;<br /><br />   while (1) {<br />         ent_health=ent_lamp.getFloatKey("health");<br />    if ( ent_health &lt; 1 ) {<br />         remove_lamplight(ent_lamp);<br />                   sys.killthread("check_lamplight");<br />    }<br />         sys.waitFrame();<br />  }<br />}<br /><br />void setup_objects()<br />{<br />     create_lamplight($env_lamp1_on_breakable_1);<br />     check_lamplight($env_lamp1_on_breakable_1);<br />}<br /><br />// function that executes when script is loaded<br /><br />void main ()<br />{<br />   setup_objects();<br />}<br /></div>&#13;<br />This one work good, but it look like the slowdown the whole framerate, maybe cause of the loop... plus there is another problem that came with it:&#13;<br />The engine don't kill the model right when it is broken, so my light is only removed 2-3 seconds after i break the lamp... strange thing.&#13;<br /><br />Any other options? A script optimisation? (i repeat i'm a noob...)&#13;<br /><br />EDIT: It seems that your right about the health check too, that's do nothing, that's why my light only disapear when the model is totally removed from the world...</div>]]></body></post><post id="p159291" date="Posted: Tue Oct 10, 2006 5:11 pm "><author>6th Venom</author><body><![CDATA[<div class="postbody">I didn't suceed with scripts, but obtain good results with many many tricks method... thanks anyway rich for help.</div>]]></body></post></posts></thread></xml>
