<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="15229"><title>Doom3 crash... I'm going nuts!</title><posts><post id="p138798" date="Posted: Sun Apr 02, 2006 8:31 am "><author>BloodRayne</author><body><![CDATA[<div class="postbody">At seemingly random points my Ultimate Mod is crashing. I have 99% of it in place but for these damned crashes. I've been searching THREE weeks for this bug and I've commented out almost every single piece of code for my mod and still... it crashes at random moments with a 'cannot read from memory error'.&#13;<br /><br />I'm pretty much losing my patience with it; does anybody know what kind of script can cause a 'cannot read from memory' error? I'll post up a screenshot of the error as soon as I manage to recreate it.&#13;<br /><br />Some things I do know:&#13;<br />- It doesn't happen in the mainmenu (I can leave that running for hours no probs).&#13;<br />- It does happen in the mainmenu after starting a game.&#13;<br />- It happens at random times (not right after a creature dying or something like that). I can quickload a game; not touch the mouse for 10 minutes then BANG it crashes without me ever touching the mouse.&#13;<br />- It doesn't happen with any other mod I've made on the same executable (i.o.w. it's only with the Ultimate mod).&#13;<br /><br />I'm not willing to post all my code here (because almost every script file in the game was altered in one way or another). What I would like to do is pass the mod over to anyone with skills to see if they can find out what's wrong (here's looking at you PBMax <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /> ).&#13;<br /><br />So if anybody ever ran into this sort of problem, can you let me know so I'll know better what to look for?&#13;<br /><br />Thanx in advance, guys!&#13;<br /><br />edit: Attached a screenshot&#13;<br /><a href="/web/20070509181516/http://img97.imageshack.us/my.php?image=clipboard024hr.jpg" class="postlink"><img src="/web/20070509181516im_/http://img97.imageshack.us/img97/4648/clipboard024hr.th.jpg" alt="Image" /></a></div>]]></body></post><post id="p138878" date="Posted: Mon Apr 03, 2006 2:30 am "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">ok, this HAS happened to me with my Last STand mod once or twice.  I belive it had to do with a loop somewhere.  IE it wasn't detected as infinite but it WAS infinite.</div>]]></body></post><post id="p138896" date="Posted: Mon Apr 03, 2006 9:48 am "><author>BloodRayne</author><body><![CDATA[<div class="postbody">Thanks for your answer. I've been checking the code, it's based on a loop, but I don't see how it could be a 'runaway' loop. It's basically something like this.&#13;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Void ult_loop {<br />    while (1) {<br />        (...code that calls a thread on ai_player...)<br />        sys.waitframe();<br />    }<br />}<br /></div>&#13;<br /><br />You may ask yourself why I did this. It's because the _init event is not called from ai_player.script when you load a game (it basically skips the entire init event which sucks). Otherwise I'ld just make a loop in there. &#13;<br /><br />But I don't see how that loop could cause the error; many scripts in D3 use the same way of looping. Before I just called the thread on AI_Player in the (idle) loop of the legs and some other idle loops for the player but then the ccrash happened as well. &#13;<br /><br />In fact, all this mess started when I added my own custom windowdef to the hud.gui file. Strange this is that when I take out the code that sets the guiparm (and use the original hud) the crash still happens.&#13;<br /><br />But...the error is the exact same as when I make a gui that has an empty variable.&#13;<br />I basically edited all the SP maps to make the start entities into "$info_player_start1" then I use the setGuiParm command to set it's width (sort of like a stamina meter). &#13;<br /><br />So I'm basically back to square 1.&#13;<br /><br />I'ld like to start a process of elimination and simply comment out all of my scripts and see when the crash starts to happen after uncommenting them but that's almost undoable because it sometimes takes 20 minutes before it crashes. With all the scripts in the mod it would take weeks before I can test everything.</div>]]></body></post><post id="p138909" date="Posted: Mon Apr 03, 2006 1:59 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">calling the thread on AI player may be the problem.  I put a script in that check zombie settings &amp; sometimes it wouldn't work properly.  Just sometimes for me though.  I don't have the old script to look at anymore as I got it working a month or so ago.  <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /></div>]]></body></post><post id="p138917" date="Posted: Mon Apr 03, 2006 3:17 pm "><author>BloodRayne</author><body><![CDATA[<div class="postbody"><div class="quotetitle">The Happy Friar wrote:</div><div class="quotecontent">calling the thread on AI player may be the problem.  <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /></div>&#13;<br />I wish it was!&#13;<br /><br />But the thing is that this method was working fine before I added the gui. <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /><br />Technically speaking this error occurs when the game is trying to access a memory area that's not accesable (e.g. empty).&#13;<br /><br />This happens when you reference a variable that doesn't exist etc..etc.. I've checked all places where there's variables and everything is 'filled'. But the fact that it is happening randomly does suggest a problem with the loop somewhere.&#13;<br /><br />[edit] damn I wish I could be more specific. <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /></div>]]></body></post><post id="p138925" date="Posted: Mon Apr 03, 2006 4:19 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">are you sure the variable ALWAYS exists?  &#13;<br /><br />Maybe ou could post the GUI?  If it's caused by that guie then it would happen to others.</div>]]></body></post><post id="p138926" date="Posted: Mon Apr 03, 2006 4:29 pm "><author>BloodRayne</author><body><![CDATA[<div class="postbody">Ok, gui code... here goes. <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />But I really think that this code is solid and bugfree. In each SP map, I've renamed the player start entities to 'info_player_start_1' and the reference works; the gui responds predictibly.&#13;<br /><br />This event is fired upon the monster_killed(); event.&#13;<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />if ( something != 1 ){<br />   if (someValue &lt; 10 ) {<br />      someValue = someValue + 1;<br />   }   <br />   if ( someValue &lt; 0 ) {<br />      someValue = 0;<br />   } <br /><br />   $info_player_start_1.setGuiParm( "someValue", someValue );<br /><br />}<br /></div><br /><br />Then the gui, this is inside hud.gui:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">        windowDef Something<br />   {<br />      rect 10, 413, 142,25<br />      visible   1<br />      background   "gui/ult/tdd"<br />      noevents   1<br /><br />      windowDef bkg_something<br />      {<br />         noevents   1<br />         rect      65, 7, ( "gui::someValue" * 7 ), 7<br />         forecolor   0.8 ,1 ,1 ,1 <br />         background   "gui/ult/tdd_fill"<br />         visible      1<br />      }<br />   }<br /></div></div>]]></body></post><post id="p138949" date="Posted: Mon Apr 03, 2006 6:51 pm "><author>pbmax</author><body><![CDATA[<div class="postbody"><div class="quotetitle">BloodRayne wrote:</div><div class="quotecontent">What I would like to do is pass the mod over to anyone with skills to see if they can find out what's wrong (here's looking at you PBMax <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /> ).</div>&#13;<br /><br />i'm certainly not any more skilled than you are. the only thing i could offer is a second pair of eyes to catch something you may have overlooked.&#13;<br /><br /><br />here's a few thoughts:&#13;<br /><br />-run each weapon mod alone one at a time to narrow it down (and hopefully its not a combination of weapon mods). i know it would take a long time, but you already have 3 weeks invested into it.&#13;<br /><br />-perhaps its limited to your computer configuration? let another person run it for a few hours to see if it happen on thier machine.&#13;<br /><br />-you must have a ton of variables. are all of them uniquely named from your other variables and id's?</div>]]></body></post><post id="p139065" date="Posted: Tue Apr 04, 2006 8:08 pm "><author>BloodRayne</author><body><![CDATA[<div class="postbody">Thanks. <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />It wasn't in the weaponry. The bulk of the code of the mod is in ai_player.script which made me squeel and look over that script over and over again. Until I remembered to look at the original loop that I made, which let me to a litte surprise. Look at the code below and guess what's wrong. <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void ultLoop() {<br />   float    framWatta;<br />   <br />   framWatta = 0;<br />   while ( 1 ) {<br />      framWatta = framWatta + 1;<br />      if ( framWatta &gt; 10 ) {<br />               $player1.callFunction( "checkir" );<br />      }<br />      sys.waitFrame();<br />   }<br />}<br /></div><br /><br />hehe... heheheee.... *slaps head*<br />Ok so you've propably noticed already... I made a runaway variable lol.<br />framWatta the float was just growing and growing as I forgot to reset it to 0 after each check was made. D'OOOOOHHH!!<br /><br />so I fixed it:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void ultLoop() {<br />   float    framWatta;<br />   <br />   framWatta = 0;<br />   while ( 1 ) {<br />      framWatta = framWatta + 1;<br />      if ( framWatta &gt; 10 ) {<br />               $player1.callFunction( "checkir" );<br />                         framWatta = 0;     //let it be eternally noted that BR is a dumbass<br />      }<br />      sys.waitFrame();<br />   }<br />}<br /></div>&#13;<br /><br /><img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_mad.gif" alt=":x" title="Mad" /><img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div>]]></body></post><post id="p139072" date="Posted: Tue Apr 04, 2006 8:45 pm "><author>pbmax</author><body><![CDATA[<div class="postbody">so where did you put that code exactly?</div>]]></body></post><post id="p139122" date="Posted: Wed Apr 05, 2006 5:36 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">I like your comments. <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p139127" date="Posted: Wed Apr 05, 2006 6:55 am "><author>BloodRayne</author><body><![CDATA[<div class="postbody"><div class="quotetitle">pbmax wrote:</div><div class="quotecontent">so where did you put that code exactly?</div><br />I made a scripfile called 'ultimate_funcs.script' and make a reference to it via doom_main.script so the functions and objects are available. In there is the ult_loop script.<br /><br />Because Cvars aren't stored in savegames I use it as a cheap hack to see if all my variables have been initialised. So I have a cvar called 'ult_initialised' and if it's anything other than '1' then I re-initialise the vars and in that initialisation loop I also call the ult_loop script.<br /><br />I really, really, really thought that the runaway variable was the cause of the crash; so after posting my eureka I went and played the mod thinking it wouldn't crash. It didnt; for the first 20 minutes then the dreaded 'cannot read from memory' error propped up again.<br /><br />PB: Can I upload the mod as a zip file so you could take a look at it?<br /><br /><div class="quotetitle">rich_is_bored wrote:</div><div class="quotecontent">I like your comments. <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>&#13;<br />It's the truth; and I can't handle it baby!</div>]]></body></post><post id="p139144" date="Posted: Wed Apr 05, 2006 2:15 pm "><author>pbmax</author><body><![CDATA[<div class="postbody">sure. i can't promise anything though...</div>]]></body></post><post id="p158696" date="Posted: Tue Oct 03, 2006 11:05 am "><author>Giganoto</author><body><![CDATA[<div class="postbody">This is a very late reply, but I'm at work and feel more like modding than working :p So I'm reading through the forum a bit...&#13;<br /><br />A suggestion: start using a version control system <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":-)" title="Smile" /> Ya even for a mod... Best way to fall back on previous versions to detect which modifications caused the error.&#13;<br />PS: I ain't using any atm neither. But I'm just still a noob modder, this will change tho <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_razz.gif" alt=":-P" title="Razz" /><br /><br />Is this solved yet? If it isn't, I wouldn't focus on "the gui being the cause" thing. It happens after about 20 minutes, so it could have been easily overlooked in previous tests...</div>]]></body></post></posts></thread></xml>
