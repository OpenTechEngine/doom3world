<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="23952"><title>ai stuff again</title><posts><post id="p227532" date="Posted: Sat Sep 25, 2010 5:44 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">hi guys,<br /><br />two questions:<br />does somebody know how to get the singleplayer ai stuff into multiplayer games? tether stuff that works on sp ends in multiplayer with monsters running into the walls.<br /><br />2nd one needs a little example as intro:<br /><br />i got 3 rooms, A - B - C<br /><br />in A monsters spawn for team 0, in C monsters for team 1. in each room is a tether which will be targetted for the enemy team, to run accross the map to the enemy spawn. they meet in mid, the B room. they fight, but they dont fight till the end. as triggered they try to reach the tether in highest priority..<br /><br />how to tell the ai, to finish the fight and run after it to the tether?<br /><br />thx for help</div>]]></body></post><post id="p227556" date="Posted: Mon Sep 27, 2010 3:18 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">Needs to be done in the SDK.  Some people did do it (I forget who).  From what I've read, it's not as easy as adding a new #define or an include.</div>]]></body></post><post id="p227565" date="Posted: Mon Sep 27, 2010 4:35 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">atm im trying to work around with some ai triggers. the result is fine for the sandbox, but i have to evaluate if the amount of triggers and threads will affect the performance.</div>]]></body></post><post id="p227569" date="Posted: Mon Sep 27, 2010 5:11 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">As the friar said, you're going to have to go SDK side if you need this to work in real multiplayer - ie, with multiple people connected to the server. Are you trying to do something that simply works like multiplayer mode, but will only actually be one player?</div>]]></body></post><post id="p227571" date="Posted: Mon Sep 27, 2010 5:25 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">oh, yeah sure... tx. somebody got any experience, even on the doom sdk? they should be "very" similar.</div>]]></body></post><post id="p227576" date="Posted: Mon Sep 27, 2010 6:58 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">actually, Q4 is as far from D3 as you can almost get.  <img src="https://web.archive.org/web/20101225120318im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" />  lots of stuff was moved/cut/added/changed to make Q4.<br /><br />I seem to remember a Q4 coop mod in dev once.  Oneofthe8devilz released his coop code for D3, so that could be a start.<br /><br />Any particular reason you're using Q4 vs D3 (I found Q4's AI to be pretty darn good myself).</div>]]></body></post><post id="p227591" date="Posted: Mon Sep 27, 2010 10:04 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody"><div class="quotetitle">bdmn wrote:</div><div class="quotecontent">how to tell the ai, to finish the fight and run after it to the tether?</div><br /><br />That's going to need an SDK change too from what I can see. I've never looked closely at the tactical AI (maybe I should? might make bots more intelligent...), but it looks as if being on a tether disables some of the other tactical decisions like melee / follow, in idAI::FilterTactical:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   // No tether move if not tethered<br />   if ( !IsTethered ( ) ) {<br />:<br />   // When tethered disable actions that dont adhear to the tether.<br />   } else {<br />      availableTactical &amp;= ~(AITACTICAL_MELEE_BIT | AITACTICAL_MOVE_FOLLOW_BIT | AITACTICAL_HIDE_BIT  | AITACTICAL_COVER_ADVANCE_BIT | AITACTICAL_COVER_FLANK_BIT | AITACTICAL_COVER_RETREAT_BIT | AITACTICAL_COVER_AMBUSH_BIT);<br />   }<br /></div><br /><br />Removing that else clause looks like it would probably allow a tethered rvAITactical to decide to melee instead of sticking to it's tether, but I've certainly not tried it (ofc, they might get very side-tracked by the fight which is I guess why Raven did that).</div>]]></body></post><post id="p227627" date="Posted: Tue Sep 28, 2010 2:56 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">thanks for you answer. i tried it, but this seems the wrong point. they dont finish fight, they attack while moving and stop fight out of range. reaching the tether breaks the game.<br /><br />the condition isTethered checks if the monster is already at a tether, and the else statement handles the true case. it looks like they reset all states when a monster reaches the tether to let some kind of manager or the monster himself decide which states are valid from now on (depending on tether conditions,etc)<br /><br />i really need to figure out where the hell the decision is made that its better reaching the tether than fighting with enemies in range... <br /><br />i tried an overkill script which logically should solve the problems with several threads watching lists and triggering ai_trigger_multiples etc. but if u have 3 monsters each side ai will start to get pretty delayed and buggy.</div>]]></body></post><post id="p227628" date="Posted: Tue Sep 28, 2010 5:26 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">thanks again, i got it. all changes have been made in AI_States.cpp. thanks for pointing me in the right direction.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">switch ( newTactical ) {<br />   case AITACTICAL_MOVE_TETHER:<br />      if(enemy.ent){<br />         result = MoveToAttack ( enemy.ent, animator.GetAnim ( "ranged_attack" ) );<br />         // Found nothing but still have a find going<br />         if ( !result &amp;&amp; aasFind ) {<br />            // turn ranged back on for next update on next frame<br />            combat.tacticalMaskUpdate |= AITACTICAL_RANGED_BIT;<br />            return false;<br />         }<br />         break;<br />      }<br />      result = MoveToTether ( tether );<br />      break;<br /></div><br /><br /><br /><br />your codespot had to be changed too:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// No tether move if not tethered<br />if ( !IsTethered ( ) ) {<br />   availableTactical &amp;= ~(AITACTICAL_MOVE_TETHER_BIT);<br />   // Filter out any tactical states that require a leader<br />   if ( !leader || (enemy.ent &amp;&amp; IsEnemyVisible() &amp;&amp; enemy.range &lt; move.followRange[1] * 2.0f ) ) {<br />      availableTactical &amp;= ~(AITACTICAL_MOVE_FOLLOW_BIT);<br />   } else if ( leader &amp;&amp; !enemy.ent ) {<br />      availableTactical &amp;= ~(AITACTICAL_COVER_BITS);<br />   }<br />        // When tethered disable actions that dont adhear to the tether.<br />} else {<br />   if(!enemy.ent){<br />      availableTactical &amp;= ~(AITACTICAL_MELEE_BIT|AITACTICAL_MOVE_FOLLOW_BIT|AITACTICAL_HIDE_BIT|AITACTICAL_COVER_ADVANCE_BIT|AITACTICAL_COVER_FLANK_BIT|AITACTICAL_COVER_RETREAT_BIT|AITACTICAL_COVER_AMBUSH_BIT);<br />   }<br />}<br /></div><br /><br /><br /><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// handle Auto break tethers<br />if ( IsTethered ( ) &amp;&amp; tether-&gt;IsAutoBreak ( ) &amp;&amp; IsWithinTether ( ) ) {<br />   tether = NULL;<br />}<br /><br />// bdmn begin:<br />      if(IsTethered ( ) &amp;&amp; IsWithinTether () ){<br />         tether = NULL;<br />      }<br />// bdmn end <br /></div><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />case AITACTICAL_MOVE_TETHER:<br />   // If not moving we dont want to idle in the move state so skip it<br />   if ( !move.fl.moving ) {<br />      return AICTRESULT_SKIP;<br />   }<br />   // We are still heading towards our tether so dont reissue a move<br />   return AICTRESULT_OK;      <br /></div></div>]]></body></post><post id="p227532" date="Posted: Sat Sep 25, 2010 5:44 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">hi guys,<br /><br />two questions:<br />does somebody know how to get the singleplayer ai stuff into multiplayer games? tether stuff that works on sp ends in multiplayer with monsters running into the walls.<br /><br />2nd one needs a little example as intro:<br /><br />i got 3 rooms, A - B - C<br /><br />in A monsters spawn for team 0, in C monsters for team 1. in each room is a tether which will be targetted for the enemy team, to run accross the map to the enemy spawn. they meet in mid, the B room. they fight, but they dont fight till the end. as triggered they try to reach the tether in highest priority..<br /><br />how to tell the ai, to finish the fight and run after it to the tether?<br /><br />thx for help</div>]]></body></post><post id="p227556" date="Posted: Mon Sep 27, 2010 3:18 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">Needs to be done in the SDK.  Some people did do it (I forget who).  From what I've read, it's not as easy as adding a new #define or an include.</div>]]></body></post><post id="p227565" date="Posted: Mon Sep 27, 2010 4:35 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">atm im trying to work around with some ai triggers. the result is fine for the sandbox, but i have to evaluate if the amount of triggers and threads will affect the performance.</div>]]></body></post><post id="p227569" date="Posted: Mon Sep 27, 2010 5:11 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">As the friar said, you're going to have to go SDK side if you need this to work in real multiplayer - ie, with multiple people connected to the server. Are you trying to do something that simply works like multiplayer mode, but will only actually be one player?</div>]]></body></post><post id="p227571" date="Posted: Mon Sep 27, 2010 5:25 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">oh, yeah sure... tx. somebody got any experience, even on the doom sdk? they should be "very" similar.</div>]]></body></post><post id="p227576" date="Posted: Mon Sep 27, 2010 6:58 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">actually, Q4 is as far from D3 as you can almost get.  <img src="https://web.archive.org/web/20101225114145im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" />  lots of stuff was moved/cut/added/changed to make Q4.<br /><br />I seem to remember a Q4 coop mod in dev once.  Oneofthe8devilz released his coop code for D3, so that could be a start.<br /><br />Any particular reason you're using Q4 vs D3 (I found Q4's AI to be pretty darn good myself).</div>]]></body></post><post id="p227591" date="Posted: Mon Sep 27, 2010 10:04 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody"><div class="quotetitle">bdmn wrote:</div><div class="quotecontent">how to tell the ai, to finish the fight and run after it to the tether?</div><br /><br />That's going to need an SDK change too from what I can see. I've never looked closely at the tactical AI (maybe I should? might make bots more intelligent...), but it looks as if being on a tether disables some of the other tactical decisions like melee / follow, in idAI::FilterTactical:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   // No tether move if not tethered<br />   if ( !IsTethered ( ) ) {<br />:<br />   // When tethered disable actions that dont adhear to the tether.<br />   } else {<br />      availableTactical &amp;= ~(AITACTICAL_MELEE_BIT | AITACTICAL_MOVE_FOLLOW_BIT | AITACTICAL_HIDE_BIT  | AITACTICAL_COVER_ADVANCE_BIT | AITACTICAL_COVER_FLANK_BIT | AITACTICAL_COVER_RETREAT_BIT | AITACTICAL_COVER_AMBUSH_BIT);<br />   }<br /></div><br /><br />Removing that else clause looks like it would probably allow a tethered rvAITactical to decide to melee instead of sticking to it's tether, but I've certainly not tried it (ofc, they might get very side-tracked by the fight which is I guess why Raven did that).</div>]]></body></post><post id="p227627" date="Posted: Tue Sep 28, 2010 2:56 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">thanks for you answer. i tried it, but this seems the wrong point. they dont finish fight, they attack while moving and stop fight out of range. reaching the tether breaks the game.<br /><br />the condition isTethered checks if the monster is already at a tether, and the else statement handles the true case. it looks like they reset all states when a monster reaches the tether to let some kind of manager or the monster himself decide which states are valid from now on (depending on tether conditions,etc)<br /><br />i really need to figure out where the hell the decision is made that its better reaching the tether than fighting with enemies in range... <br /><br />i tried an overkill script which logically should solve the problems with several threads watching lists and triggering ai_trigger_multiples etc. but if u have 3 monsters each side ai will start to get pretty delayed and buggy.</div>]]></body></post><post id="p227628" date="Posted: Tue Sep 28, 2010 5:26 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">thanks again, i got it. all changes have been made in AI_States.cpp. thanks for pointing me in the right direction.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">switch ( newTactical ) {<br />   case AITACTICAL_MOVE_TETHER:<br />      if(enemy.ent){<br />         result = MoveToAttack ( enemy.ent, animator.GetAnim ( "ranged_attack" ) );<br />         // Found nothing but still have a find going<br />         if ( !result &amp;&amp; aasFind ) {<br />            // turn ranged back on for next update on next frame<br />            combat.tacticalMaskUpdate |= AITACTICAL_RANGED_BIT;<br />            return false;<br />         }<br />         break;<br />      }<br />      result = MoveToTether ( tether );<br />      break;<br /></div><br /><br /><br /><br />your codespot had to be changed too:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// No tether move if not tethered<br />if ( !IsTethered ( ) ) {<br />   availableTactical &amp;= ~(AITACTICAL_MOVE_TETHER_BIT);<br />   // Filter out any tactical states that require a leader<br />   if ( !leader || (enemy.ent &amp;&amp; IsEnemyVisible() &amp;&amp; enemy.range &lt; move.followRange[1] * 2.0f ) ) {<br />      availableTactical &amp;= ~(AITACTICAL_MOVE_FOLLOW_BIT);<br />   } else if ( leader &amp;&amp; !enemy.ent ) {<br />      availableTactical &amp;= ~(AITACTICAL_COVER_BITS);<br />   }<br />        // When tethered disable actions that dont adhear to the tether.<br />} else {<br />   if(!enemy.ent){<br />      availableTactical &amp;= ~(AITACTICAL_MELEE_BIT|AITACTICAL_MOVE_FOLLOW_BIT|AITACTICAL_HIDE_BIT|AITACTICAL_COVER_ADVANCE_BIT|AITACTICAL_COVER_FLANK_BIT|AITACTICAL_COVER_RETREAT_BIT|AITACTICAL_COVER_AMBUSH_BIT);<br />   }<br />}<br /></div><br /><br /><br /><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// handle Auto break tethers<br />if ( IsTethered ( ) &amp;&amp; tether-&gt;IsAutoBreak ( ) &amp;&amp; IsWithinTether ( ) ) {<br />   tether = NULL;<br />}<br /><br />// bdmn begin:<br />      if(IsTethered ( ) &amp;&amp; IsWithinTether () ){<br />         tether = NULL;<br />      }<br />// bdmn end <br /></div><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />case AITACTICAL_MOVE_TETHER:<br />   // If not moving we dont want to idle in the move state so skip it<br />   if ( !move.fl.moving ) {<br />      return AICTRESULT_SKIP;<br />   }<br />   // We are still heading towards our tether so dont reissue a move<br />   return AICTRESULT_OK;      <br /></div></div>]]></body></post><post id="p227532" date="Posted: Sat Sep 25, 2010 5:44 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">hi guys,<br /><br />two questions:<br />does somebody know how to get the singleplayer ai stuff into multiplayer games? tether stuff that works on sp ends in multiplayer with monsters running into the walls.<br /><br />2nd one needs a little example as intro:<br /><br />i got 3 rooms, A - B - C<br /><br />in A monsters spawn for team 0, in C monsters for team 1. in each room is a tether which will be targetted for the enemy team, to run accross the map to the enemy spawn. they meet in mid, the B room. they fight, but they dont fight till the end. as triggered they try to reach the tether in highest priority..<br /><br />how to tell the ai, to finish the fight and run after it to the tether?<br /><br />thx for help</div>]]></body></post><post id="p227556" date="Posted: Mon Sep 27, 2010 3:18 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">Needs to be done in the SDK.  Some people did do it (I forget who).  From what I've read, it's not as easy as adding a new #define or an include.</div>]]></body></post><post id="p227565" date="Posted: Mon Sep 27, 2010 4:35 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">atm im trying to work around with some ai triggers. the result is fine for the sandbox, but i have to evaluate if the amount of triggers and threads will affect the performance.</div>]]></body></post><post id="p227569" date="Posted: Mon Sep 27, 2010 5:11 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">As the friar said, you're going to have to go SDK side if you need this to work in real multiplayer - ie, with multiple people connected to the server. Are you trying to do something that simply works like multiplayer mode, but will only actually be one player?</div>]]></body></post><post id="p227571" date="Posted: Mon Sep 27, 2010 5:25 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">oh, yeah sure... tx. somebody got any experience, even on the doom sdk? they should be "very" similar.</div>]]></body></post><post id="p227576" date="Posted: Mon Sep 27, 2010 6:58 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">actually, Q4 is as far from D3 as you can almost get.  <img src="https://web.archive.org/web/20101225114145im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" />  lots of stuff was moved/cut/added/changed to make Q4.<br /><br />I seem to remember a Q4 coop mod in dev once.  Oneofthe8devilz released his coop code for D3, so that could be a start.<br /><br />Any particular reason you're using Q4 vs D3 (I found Q4's AI to be pretty darn good myself).</div>]]></body></post><post id="p227591" date="Posted: Mon Sep 27, 2010 10:04 pm "><author>AnthonyJa</author><body><![CDATA[<div class="postbody"><div class="quotetitle">bdmn wrote:</div><div class="quotecontent">how to tell the ai, to finish the fight and run after it to the tether?</div><br /><br />That's going to need an SDK change too from what I can see. I've never looked closely at the tactical AI (maybe I should? might make bots more intelligent...), but it looks as if being on a tether disables some of the other tactical decisions like melee / follow, in idAI::FilterTactical:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   // No tether move if not tethered<br />   if ( !IsTethered ( ) ) {<br />:<br />   // When tethered disable actions that dont adhear to the tether.<br />   } else {<br />      availableTactical &amp;= ~(AITACTICAL_MELEE_BIT | AITACTICAL_MOVE_FOLLOW_BIT | AITACTICAL_HIDE_BIT  | AITACTICAL_COVER_ADVANCE_BIT | AITACTICAL_COVER_FLANK_BIT | AITACTICAL_COVER_RETREAT_BIT | AITACTICAL_COVER_AMBUSH_BIT);<br />   }<br /></div><br /><br />Removing that else clause looks like it would probably allow a tethered rvAITactical to decide to melee instead of sticking to it's tether, but I've certainly not tried it (ofc, they might get very side-tracked by the fight which is I guess why Raven did that).</div>]]></body></post><post id="p227627" date="Posted: Tue Sep 28, 2010 2:56 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">thanks for you answer. i tried it, but this seems the wrong point. they dont finish fight, they attack while moving and stop fight out of range. reaching the tether breaks the game.<br /><br />the condition isTethered checks if the monster is already at a tether, and the else statement handles the true case. it looks like they reset all states when a monster reaches the tether to let some kind of manager or the monster himself decide which states are valid from now on (depending on tether conditions,etc)<br /><br />i really need to figure out where the hell the decision is made that its better reaching the tether than fighting with enemies in range... <br /><br />i tried an overkill script which logically should solve the problems with several threads watching lists and triggering ai_trigger_multiples etc. but if u have 3 monsters each side ai will start to get pretty delayed and buggy.</div>]]></body></post><post id="p227628" date="Posted: Tue Sep 28, 2010 5:26 pm "><author>bdmn</author><body><![CDATA[<div class="postbody">thanks again, i got it. all changes have been made in AI_States.cpp. thanks for pointing me in the right direction.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">switch ( newTactical ) {<br />   case AITACTICAL_MOVE_TETHER:<br />      if(enemy.ent){<br />         result = MoveToAttack ( enemy.ent, animator.GetAnim ( "ranged_attack" ) );<br />         // Found nothing but still have a find going<br />         if ( !result &amp;&amp; aasFind ) {<br />            // turn ranged back on for next update on next frame<br />            combat.tacticalMaskUpdate |= AITACTICAL_RANGED_BIT;<br />            return false;<br />         }<br />         break;<br />      }<br />      result = MoveToTether ( tether );<br />      break;<br /></div><br /><br /><br /><br />your codespot had to be changed too:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// No tether move if not tethered<br />if ( !IsTethered ( ) ) {<br />   availableTactical &amp;= ~(AITACTICAL_MOVE_TETHER_BIT);<br />   // Filter out any tactical states that require a leader<br />   if ( !leader || (enemy.ent &amp;&amp; IsEnemyVisible() &amp;&amp; enemy.range &lt; move.followRange[1] * 2.0f ) ) {<br />      availableTactical &amp;= ~(AITACTICAL_MOVE_FOLLOW_BIT);<br />   } else if ( leader &amp;&amp; !enemy.ent ) {<br />      availableTactical &amp;= ~(AITACTICAL_COVER_BITS);<br />   }<br />        // When tethered disable actions that dont adhear to the tether.<br />} else {<br />   if(!enemy.ent){<br />      availableTactical &amp;= ~(AITACTICAL_MELEE_BIT|AITACTICAL_MOVE_FOLLOW_BIT|AITACTICAL_HIDE_BIT|AITACTICAL_COVER_ADVANCE_BIT|AITACTICAL_COVER_FLANK_BIT|AITACTICAL_COVER_RETREAT_BIT|AITACTICAL_COVER_AMBUSH_BIT);<br />   }<br />}<br /></div><br /><br /><br /><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// handle Auto break tethers<br />if ( IsTethered ( ) &amp;&amp; tether-&gt;IsAutoBreak ( ) &amp;&amp; IsWithinTether ( ) ) {<br />   tether = NULL;<br />}<br /><br />// bdmn begin:<br />      if(IsTethered ( ) &amp;&amp; IsWithinTether () ){<br />         tether = NULL;<br />      }<br />// bdmn end <br /></div><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />case AITACTICAL_MOVE_TETHER:<br />   // If not moving we dont want to idle in the move state so skip it<br />   if ( !move.fl.moving ) {<br />      return AICTRESULT_SKIP;<br />   }<br />   // We are still heading towards our tether so dont reissue a move<br />   return AICTRESULT_OK;      <br /></div></div>]]></body></post></posts></thread></xml>
