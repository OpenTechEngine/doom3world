<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="18866"><title>Weapon import problem and question.</title><posts><post id="p171641" date="Posted: Tue Feb 27, 2007 12:54 am "><author>Criminal</author><body><![CDATA[<div class="postbody">Okay i have searched this forum ALOT and i still couldnt really answer my question. My question is do you HAVE to recompile and change the class.cpp to import a custom weapon into the game? Essentially we've coded some custom walkers already but just simply putting in a new pistol is getting to be very annoying. &#13;<br /><br />"weaponclass"				"rvWeaponBlaster"&#13;<br /><br />this is the weapon class i am currently using and i thought you could still use a stock weapon class without changing the whole class.cpp . Am i wrong? For now ill post my code for this particular weapon which is called "HSP" and maybe you guys can find something that im just not seeing.&#13;<br /><br />The main problem is when i go to pickup the weapon (which i see fine in game) in the console it just keeps repeating "unknown weapon"&#13;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">//----------------------------------------------------------------<br />// hsp.def<br />//<br />// Copyright 2002-2004 Raven Software<br />//----------------------------------------------------------------<br />//--------------------------------------------------------------------------------------------------------------------<br />// Weapon Defintion<br />//-------------------------------------------------------------------------------------------------------------------0<br /><br />model isdle {<br />   mesh   models/weapons/hsp/hsp.md5mesh<br />   anim idle   models/weapons/hsp/idle.md5anim<br /><br /><br /><br /><br /><br /><br /><br />entityDef weapon_hsp<br /><br /><br />{<br />   "editor_menu"            "pickup"<br />   "editor_color"            ".3 .3 1"<br />   "editor_mins"            "-16 -16 0"<br />   "editor_maxs"            "16 16 32"<br /><br />   "editor_usage"            "hsp"<br /><br />   "spawnclass"            "idItem"<br />   "weaponclass"            "rvWeaponBlaster"<br />   "weaponname"            "hsp"<br />   "size"                  "32 32 32"<br /><br />     "model_view"            "viewmodel_hsp"<br />     "model_world"            "worldmodel_hsp"<br />   "model"                "models/weapons/hsp/hsp.ase"<br /><br />   "joint_attach"            "PST_ATTACHER"<br />   "joint_view_flashlight"      "barrel"<br />   "joint_view_flash"         "barrel"<br />   "joint_world_flash"         "muzzle_flash"<br /><br />   // Firing properties<br />   "chargeTime"            ".8"<br />   "chargeDelay"            ".1"<br />   "chargeGlow"            "0 .4"<br />   "fireRate"               ".15"<br />   "spread"               ".2"<br /><br />//   "def_projectile"         "projectile_blaster"<br />   "def_hitscan"            "hitscan_blaster"<br />   "def_altprojectile"         "projectile_blaster_charged"<br />   "ammoType"               "ammo_blaster"<br />   "clipSize"               "0"<br />   "ammoRequired"            "0"<br />//   "launchFromBarrel"         "1"<br /><br />   "inv_weapon"            "weapon_hsp"<br />   "inv_item"               "5"<br />   "inv_icon"               "gfx/guis/hud/icons/item_blaster.tga"<br />   "inv_name"               "hsp"<br /><br />//   "gui"                  "guis/weapons/blaster_ammo.gui"<br />   "mtr_icon"               "gfx/guis/hud/icons/gun_blaster"<br /><br />   "mtr_crosshair"            "gfx/guis/crosshairs/crosshair_blaster"<br />//   "crosshairOffsetX"         "2"<br />//   "crosshairOffsetY"         "2"<br /><br />   // -------------------- Recoil and Muzzle Kick ---------------------------------------<br /><br />   "muzzle_kick_time"         "0.1"<br />   "muzzle_kick_maxtime"      "0.2"<br />   "muzzle_kick_angles"      "-5 0 0"<br />   "muzzle_kick_offset"      "2 0 0"<br /><br />   "recoilTime"            "100"<br />   "recoilAngles"            "-2 0 0"<br />   <br />   // ---------------------------- Flashlight ---------------------------------------<br />   <br />   "mtr_flashlightShader"      "gfx/lights/flashlight"<br />   "flashlightColor"         "1 1 .9"<br />   "flashlightRadius"         "400"<br />   "flashlightAngle"         "15.0"<br />   "flashlightTarget"         "1000 0 0"<br />   "flashlightUp"            "0 375 0"<br />   "flashlightRight"         "0 0 -375"<br />   "flashlightPointLight"      "0"<br /><br /><br />   // ---------------------------- Muzzle Flash ---------------------------------------<br /><br />   "mtr_flashShader"         "lights/muzzleflash"<br />   "flashColor"            "0.7 0.8 1"<br />   "flashRadius"            "200"<br />   "flashPointLight"         "1"<br />   "flashTime"               ".1"<br />   "flashViewOffset"         "15 5 -10"<br /><br />   // ------------------------- Sounds and Effects ---------------------------------------<br />        <br />   "snd_charge"            "weapon_blaster_charge"<br />   "snd_charge_loop"         "weapon_blaster_charged"<br />   "snd_charge_click"         "weapon_blaster_charge_click"<br />   "snd_quaddamage"         "weapon_quaddamage_fire"<br /><br />    "fx_normalflash"         "effects/weapons/blaster/muzzleflash.fx"<br />    "fx_chargedflash"         "effects/weapons/blaster/charged/muzzleflash.fx"      <br />   "fx_respawn"            "effects/mp/itemrespawn.fx"<br />    "fx_muzzleflash_world"      "effects/weapons/blaster/muzzleflash_world.fx"<br /><br />   "snd_acquire"            "pickup_weapon"<br /><br />   "def_viewStyle"            "viewStyle_q3_blaster"<br />   "def_viewStyle1"         "viewStyle_shouldered_blaster"<br /><br />    <br />   "foreshorten"            ".65"<br />   <br />   "weaponAngleOffsetAverages" "10"<br />   "weaponAngleOffsetScale"    ".25"<br />   "weaponAngleOffsetMax"      "10"<br />   "weaponOffsetTime"         "600"<br />   "weaponOffsetScale"         "0.003"<br />   <br />   "net_syncPhysics"         "1"<br />}<br /><br />//--------------------------------------------------------------------------------------------------------------------<br />// Models<br />//-------------------------------------------------------------------------------------------------------------------0<br /><br />model viewmodel_hsp<br />{<br />   mesh                  models/weapons/hsp/view.md5mesh<br /><br />   anim idle                models/weapons/hsp/idle.md5anim   <br />   anim raise               models/weapons/hsp/raise.md5anim<br />   {<br />      rate               1.4<br />      frame 6               sound_weapon   weapon_hsp_ready<br />   }      <br />   anim putaway            models/weapons/hsp/lower.md5anim<br />   {<br />      frame 1               sound_weapon   weapon_switch<br />   }<br /><br />   anim fire1                models/weapons/hsp/fire.md5anim<br />   {<br />      frame 1               sound_weapon   weapon_blaster_fire<br />      frame 1               sound_item      weapon_blaster_fire_stereo<br />   }<br />   anim fire2                models/weapons/hsp/fire2.md5anim<br />   {<br />      frame 1               sound_weapon   weapon_blaster_fire<br />      frame 1               sound_item      weapon_blaster_fire_stereo<br />   }<br /><br />   anim flashlight            models/weapons/hsp/flashlight.md5anim<br />   {<br />      frame 8               sound_weapon   weapon_hsp_flashlight<br />   }<br />   <br />   anim charging            models/weapons/hsp/charge_up.md5anim<br />   anim chargedfire         models/weapons/hsp/big_recoil.md5anim<br />   {<br />      frame 1               sound_weapon   weapon_blaster_fire_charged<br />      frame 1               sound_item      weapon_blaster_fire_stereo<br />   }<br />}<br /><br />model weapon_hsp_view_strogg<br />{<br />   inherit                  weapon_blaster_view<br />   mesh                  models/weapons/hsp/view_strogg.md5mesh<br />}<br /><br />model worldmodel_hsp<br />{<br />   mesh            <br />models/weapons/hsp/world/hsp.md5mesh<br />   anim idle            models/weapons/hsp/world/idle.md5anim<br />}<br /><br />//--------------------------------------------------------------------------------------------------------------------<br />// Mods<br />//-------------------------------------------------------------------------------------------------------------------0<br /><br />//--------------------------------------------------------------------------------------------------------------------<br />// Projectile<br />//-------------------------------------------------------------------------------------------------------------------0<br /><br />entityDef hitscan_blaster<br />{<br />   "range"                  "10000"<br /><br />   "fx_impact"               "effects/weapons/blaster/impact_default.fx"<br />   "fx_impact_water"         "effects/ambient/splash_smll.fx"<br />   "fx_impact_concrete"      "effects/weapons/hyperblaster/impact_concrete.fx"<br />   "fx_impact_flesh"         "effects/weapons/hyperblaster/impact_flesh.fx"<br />   "fx_impact_monstermetal"   "effects/weapons/hyperblaster/impact_flesh.fx"<br />   "fx_impact_glass"         "effects/weapons/blaster/impact_glass.fx"               <br />   "fx_impact_bpglass"         "effects/weapons/blaster/impact_bpglass.fx"<br />   "fx_impact_electronics"      "effects/weapons/hyperblaster/impact_electronics.fx"   <br /><br />   "fx_path"               "effects/weapons/blaster/trail.fx"<br />   <br />   "def_damage"            "damage_blaster"<br />      <br />   "push"                  "7500"<br /><br />   "impact_gib"            "1"<br />}<br /><br />entityDef projectile_blaster<br />{<br />   "spawnclass"            "idProjectile"<br />   "mins"                  "-2 -2 -2"<br />   "maxs"                  "2 2 2"<br />   "cone"                  "2"<br />   "noshadows"               "1"<br />                                                <br />   "def_damage"            "damage_blaster"<br />                        <br />   "velocity"               "1500 0 0"<br />   "fuse"                  "4"<br />   "push"                  "7500"<br />                        <br />   "detonate_on_fuse"         "1"<br />   "detonate_on_death"         "0"<br />   "detonate_on_world"         "1"<br />   "detonate_on_actor"         "1"<br />                        <br />   "impact_gib"            "1"<br />                        <br />   "decal_bounce"            ""<br />   "decal_size"            "8"<br />                        <br />   "fx_fly"               "effects/weapons/blaster/fly.fx"<br />   "fx_impact"               "effects/weapons/blaster/impact_default.fx"<br />   "fx_impact_water"         "effects/ambient/splash_smll.fx"<br />   "fx_impact_flesh"         "effects/weapons/blaster/impact_flesh.fx"<br />   "fx_impact_monstermetal"   "effects/weapons/blaster/impact_monstermetal.fx"<br />   "fx_impact_electronics"      "effects/weapons/machinegun/impact_electronics.fx"<br />   "fx_impact_armor"         "effects/weapons/machinegun/impact_armor.fx"<br />   <br />   "fx_teleport_enter"      "effects/mp/item_teleport.fx"<br />   "fx_teleport"         "effects/mp/item_teleport.fx"<br />}<br /><br />entityDef projectile_blaster_charged<br />{<br />   "inherit"               "projectile_blaster"<br /><br />   "mins"                  "-8 -8 -8"<br />   "maxs"                  "8 8 8"<br /><br />   "velocity"               "2000 0 0"<br /><br />   "fx_fly"               "effects/weapons/blaster/charged/fly.fx"<br />   "fx_impact"               "effects/weapons/blaster/charged/impact_default.fx"<br />   "fx_impact_flesh"         "effects/weapons/blaster/impact_flesh_charged.fx"<br />   "fx_impact_monstermetal"   "effects/weapons/blaster/impact_monstermetal_charged.fx"<br />   "fx_impact_electronics"      "effects/weapons/machinegun/impact_electronics.fx"<br />   "fx_impact_armor"         "effects/weapons/machinegun/impact_armor.fx"<br /><br /><br />   "def_damage"            "damage_blaster_charged"<br />   "def_splash_damage"         "damage_blastersplash_charged"<br />}<br /><br />//--------------------------------------------------------------------------------------------------------------------<br />// Damage<br />//-------------------------------------------------------------------------------------------------------------------0<br /><br />entityDef damage_blaster<br />{<br />   "inherit"               "damage_bullet"<br />   "damage"               "8"<br /><br />   "fx_wound"               "effects/wounds/energy.fx"<br /><br />   "deathPush"               "100"<br />   "deathPushMin"            "2000 250"<br />   "deathPushMax"            "5000 500"<br />}<br /><br />entityDef damage_blaster_charged<br />{<br />   "inherit"               "damage_blaster"<br />   "damage"               "50"<br />}<br /><br />entityDef damage_blastersplash_charged<br />{<br />   "inherit"               "damage_blaster"<br />   <br />   "damage"               "40"<br />   "radius"               "50"<br />   "knockback"               "30"<br />   "push"                  "2500"<br />}<br /></div></div>]]></body></post><post id="p171656" date="Posted: Tue Feb 27, 2007 2:36 am "><author>AnthonyJa</author><body><![CDATA[<div class="postbody">If something spams a warning over and over again, the easiest way to figure out why is to search for that warning, and then look at why it displays that message.&#13;<br /><br />Assuming you're talking about this, from mpgame\Player.cpp(931):&#13;<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   gameLocal.Warning( "Unknown weapon '%s'", weaponName.c_str() );<br /></div>&#13;<br /><br />then the reason is that you've not added the weapon into the player.def in a def_weaponX slot. Also look for other bits in there, as you need to add a few things I think.</div>]]></body></post><post id="p171672" date="Posted: Tue Feb 27, 2007 5:55 am "><author>Criminal</author><body><![CDATA[<div class="postbody">Yeah i already added it into the Player def in an existing slot. So let me be sure i'm understanding....if you dont add it into the class.css you CAN still import the weapon in you just have to essentially replace another one in the weapons slots correct??</div>]]></body></post><post id="p171677" date="Posted: Tue Feb 27, 2007 7:52 am "><author>Infernal=WFR</author><body><![CDATA[<div class="postbody">lets make it very clear:&#13;<br /><br />lets do this:&#13;<br /><br />entityDef Weapon_string_name {&#13;<br /><br />"weaponclass" "rvWeaponBlaster"&#13;<br />}&#13;<br /><br /><br />Weapon_string_name has to be in a weapon slot on the player.&#13;<br /><br />the string in "weaponclass" is the one that has to be in idClass.cpp.  Note that you will ONLY have to add the "rvWeaponBlaster" data string to idClass.cpp if it's not defined in code yet.  If you are creating a completely new weapon, you would typically copy code from the closest weapon type, declare a new code object type, add that to idclass.cpp registration and then use it in the "weaponclass" line in your new entitydef.&#13;<br /><br /><br />also.. if you weren't careful and added it only to entitydef player in the first weapon spot.. then if you load the game in multiplayer, entitydef player_mp will have overriten your new weapon in the weapon slots.</div>]]></body></post><post id="p188846" date="Posted: Thu Sep 20, 2007 7:30 am "><author>kensvehla</author><body><![CDATA[<div class="postbody">Ok, after many hours of trying things again and again this (artist, not scripter) is becoming frustrated.   <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br /><br />I am running a dev team at school and things have been going quite smoothly up until trying to get our weapons into the players hands.  (Don't worry its not an MD5 export issue). We have the weapons modeled, our characters done levels finished and a ton of art assests as well as custom mp game types done, but the weapons are having issues. Basically I'm having issues more with the definition file side of things.  I can everything in the def if requested but for now I'll just post the upper part.  The error I'm getting is:<br /><br />------------ Processing events --------------<br />---------------------------------------------<br />Error ERP_DROP: entityDef not found: player_viewweapon<br />------------ Game Map Shutdown --------------<br />---------------------------------------------<br />********************<br />ERROR: entityDef not found: player_viewweapon<br />********************<br />clientState != CS_CONNECTING, not waiting for game auth, authKey ignored<br />]condump weaponerror<br />Dumped console text to weaponerror.txt.<br /><br />----<br /><br />now I know what you're thinking, but I do have a both a player.def and a "weapon.def", at this point i'd be willing to send a small test pk4 with just the weapon in it, if they could help me/us/the team.  figure out why this isn't working.  We're hoping to present and get this up and running by november, and this is the only hiccup in the mod we've really had.  Right now I"m just trying to replace an existing weapon, not add a whole new slot.  I've been looking through every .def file I can, and I can't find anything on "player_viewweapon" anywhere.  Again guys I'm very familiar with the Doom3 engine, (we're using Q4) but, this just has me stumped.  <br /><br /><br />sample def script:<br /><br />//----------------------------------------------------------------<br />// svinfinity.def<br />//<br />// Copyright 2002-2004 Raven Software<br />//----------------------------------------------------------------<br /><br />export svinfinity<br />{<br />	options  -sourcedir models/weapons/svinfinity/animations -destdir models/weapons/svinfinity <br /><br /><br />	mesh	view_mesh.ma 				-dest svinfinity<br />	anim	pistol_idle.ma 				-dest idle<br /><br />}<br /><br /><br />entityDef weapon_svinfinity<br />{<br />	"editor_menu"				"pickup"<br />	"editor_color"				".3 .3 1"<br />	"editor_mins"				"-16 -16 0"<br />	"editor_maxs"				"16 16 32"<br /><br />	"editor_usage"				"svinfinity"<br /><br />	"spawnclass"				"idItem"<br />	"weaponclass"				"rvWeaponBlaster"<br />	"weaponname"				"Blaster"<br />	"size"						"32 32 32"<br /><br />  	"model_view"				"weapon_svinfinity_view"<br /><br />  	"model_world"				"weapon_svinfinity_world"<br />	"model" 					"models/weapons/svinfinity_world/svinfinity.ase"<br /><br />	"joint_attach"				"PST_ATTACHER"<br />	"joint_view_flashlight"		"barrel"<br />	"joint_view_flash"			"barrel"<br />	"joint_world_flash"			"muzzle_flash"<br /><br />	// Firing properties<br />	"chargeTime"				".8"<br />	"chargeDelay"				".1"<br />	"chargeGlow"				"0 .4"<br />	"fireRate"					".15"<br />	"spread"					".2"<br /><br />//	"def_projectile"			"projectile_svinfinity"<br />	"def_hitscan"				"hitscan_blaster"</div>]]></body></post><post id="p188902" date="Posted: Fri Sep 21, 2007 4:57 am "><author>Infernal=WFR</author><body><![CDATA[<div class="postbody">snippet from hyperblaster.def<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">model weapon_hyperblaster_view<br />{<br />   mesh                  models/weapons/hyperblaster/mesh.md5mesh<br />   <br />   skin                  skins/weapons/hyperblaster/nobounce<br />   <br />   anim idle                models/weapons/hyperblaster/idle.md5anim   <br />   anim fire                models/weapons/hyperblaster/fire.md5anim   <br />   {<br />      frame 1               sound_weapon   weapon_hyperblaster_fire<br />      frame 1               sound_item      weapon_hyperblaster_fire_stereo<br />   }<br />   anim reload             models/weapons/hyperblaster/reload.md5anim   <br />   {<br />      frame 1               sound_weapon   weapon_hyperblaster_cell_out<br />      frame 21            sound_item      weapon_hyperblaster_cell_in<br />      frame 34            sound_weapon   weapon_hyperblaster_close<br />   }<br />   anim raise               models/weapons/hyperblaster/raise.md5anim<br />   anim putaway            models/weapons/hyperblaster/lower.md5anim<br />   {<br />      frame 1               sound_weapon   weapon_switch<br />   }<br />}<br /></div><br />have you defined a view model for your weapon_svinfinity_view and also the model for weapon_svinfinity_world?<br /><br />just asking.</div>]]></body></post><post id="p188905" date="Posted: Fri Sep 21, 2007 7:44 am "><author>kensvehla</author><body><![CDATA[<div class="postbody">thx for your reply, yes I have actually both for the view and the world model defined as you have shown above.   Again I am familiar with the engine, but am not much for scripting and programming.  LOL More of an artist <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" />  I do know that the Md5's are correct b/c I am able to open and view them in different md5 viewers.  At least as far as the geometry and animations are concerned.  I spent literally the entire night, last night trying to figure out what this was, but have had no luck,   <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" />, Hopefully you have some more words of wisdom for me  <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br /><br /><br /><br />taken from the def file:  (again this is just a test before I go in and get everything else working. I wanted to get the idle working first)  Less to break <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" />  forgive the formatting as it is being skewed somehow by the forums.<br /><br /><br />//--------------------------------------------------------------------------------------------------------------------<br />// Models<br />//-------------------------------------------------------------------------------------------------------------------0<br /><br />model weapon_svinfinity_view<br />{<br />	mesh						models/weapons/svinfinity/view.md5mesh<br /><br />	anim idle 					models/weapons/svinfinity/idle.md5anim	<br />}<br /><br />model weapon_svinfinity_world <br />{<br />	mesh				models/weapons/svinfinity/world/view.md5mesh<br />	anim idle				models/weapons/svinfinity/world/idle.md5anim<br />}</div>]]></body></post><post id="p188949" date="Posted: Sat Sep 22, 2007 1:48 am "><author>Infernal=WFR</author><body><![CDATA[<div class="postbody">Um snippet from player.def in baseq4 pk4s<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />entityDef player_viewweapon {<br />   "spawnclass"            "rvViewWeapon"<br />}<br /><br /></div><br /><br />Player.def holds ALOT more than just the player's entitydef, if you have a custom player.def, it is loaded instead, not over top of the q4 .def.  This means that if your player.def doesn't contain all the different required entity definitions that the q4 one has, your player.def will cause your game to crash in such fashion.</div>]]></body></post><post id="p188987" date="Posted: Sat Sep 22, 2007 10:03 pm "><author>kensvehla</author><body><![CDATA[<div class="postbody">Alright I shall give this a try, thx for your help I"ll letyouknow how it works out <img src="/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p189211" date="Posted: Thu Sep 27, 2007 2:14 am "><author>kensvehla</author><body><![CDATA[<div class="postbody">ok, got that fixed but now I have another error that is popping up.<br /><br />"EntityDef not found ; player_animatedentity"<br /><br />Now I'm assuming that you're probably go




<!--
     FILE ARCHIVED ON 18:15:16 May 9, 2007 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 21:04:10 Sep 24, 2014.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
--></div>]]></body></post></posts></thread></xml>
