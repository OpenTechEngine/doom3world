<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="25906"><title>func_animate disappears when I get close to it</title><posts><post id="p242638" date="Posted: Wed Sep 26, 2012 5:29 am "><author>motorsep</author><body><![CDATA[<div class="postbody">I have an entity that inherits func_animate on the map (animated md5 model). When I get too close to it, it disappears. I move away, it appears. I would prefer for it to just be there when I pass through it. Has anyone encountered and resolved similar issue?<br /><br />Here are the entity's setting:<br /><br /><img src="https://web.archive.org/web/20130320004035im_/http://i.imgur.com/fBUD9.jpg" alt="Image" /></div>]]></body></post><post id="p242639" date="Posted: Wed Sep 26, 2012 6:54 am "><author>BloodRayne</author><body><![CDATA[<div class="postbody">I have the exact same issue in Grimm. No clue how to solve it.</div>]]></body></post><post id="p242640" date="Posted: Wed Sep 26, 2012 7:09 am "><author>Gary</author><body><![CDATA[<div class="postbody">Bounding box problems? LODs set up wrong/corrupt? Are there fade/render distances per entity in Doom3? If so, those values maybe wrong. (Wait, maybe there are no LODs in D3... can't remember) <br /><br />I'm just guessing, I'm a Source modder. So I'm just saying what ever causes a similar problems...</div>]]></body></post><post id="p242641" date="Posted: Wed Sep 26, 2012 10:35 am "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />I am not 100% sure if this is what you are experiencing exactly but...<br /><br />EDIT: What I say here is not quite correct. You can in fact use "mins" and "maxs" to set up a basic clip bounding box.<br /><br />Where you aware that func_animate (idAnimated) does not have code in the SDK to set up a clip model at all.<br /><br />So you will always be able to walk through it (It may dissapear from view if player is in / on it) unless you bind a func_clipmodel to it, put clip brushes around it or modify the SDK code so that you can enter a simple bounding box clip setup from an entity def if you are using a lot of them like myself and you decide its worth it.<br /><br />Hope that helps.<br /><br />Cheers</div>]]></body></post><post id="p242642" date="Posted: Wed Sep 26, 2012 1:05 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I did a quick check in game and it looks like idanimated is always used for cinematics...  I thought there was some bridges &amp; what not where it wasn't.  <img src="https://web.archive.org/web/20130320004035im_/http://www.doom3world.org/phpbb2/images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>]]></body></post><post id="p242643" date="Posted: Wed Sep 26, 2012 3:53 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">@solarsplace: care to share your SDK code? <img src="https://web.archive.org/web/20130320004035im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p242644" date="Posted: Wed Sep 26, 2012 4:07 pm "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />How could I refuse! - here you go.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">/*<br />===============<br />idAnimated::Spawn<br />================<br />*/<br />void idAnimated::Spawn( void ) {<br />   idStr      animname;<br />   int         anim2;<br />   float      wait;<br />   const char   *joint;<br /><br />   joint = spawnArgs.GetString( "sound_bone", "origin" ); <br />   soundJoint = animator.GetJointHandle( joint );<br />   if ( soundJoint == INVALID_JOINT ) {<br />      gameLocal.Warning( "idAnimated '%s' at (%s): cannot find joint '%s' for sound playback", name.c_str(), GetPhysics()-&gt;GetOrigin().ToString(0), joint );<br />   }<br /><br />   LoadAF();<br /><br />   // allow bullets to collide with a combat model<br />   if ( spawnArgs.GetBool( "combatModel", "0" ) ) {<br />      combatModel = new idClipModel( modelDefHandle );<br />   }<br /><br />   // allow the entity to take damage<br />   if ( spawnArgs.GetBool( "takeDamage", "0" ) ) {<br />      fl.takedamage = true;<br />   }<br /><br />   blendFrames = 0;<br /><br />   current_anim_index = 0;<br />   spawnArgs.GetInt( "num_anims", "0", num_anims );<br /><br />   blendFrames = spawnArgs.GetInt( "blend_in" );<br /><br />   animname = spawnArgs.GetString( num_anims ? "anim1" : "anim" );<br />   if ( !animname.Length() ) {<br />      anim = 0;<br />   } else {<br />      anim = animator.GetAnim( animname );<br />      if ( !anim ) {<br />         gameLocal.Error( "idAnimated '%s' at (%s): cannot find anim '%s'", name.c_str(), GetPhysics()-&gt;GetOrigin().ToString(0), animname.c_str() );<br />      }<br />   }<br /><br />   if ( spawnArgs.GetBool( "hide" ) ) {<br />      Hide();<br /><br />      if ( !num_anims ) {<br />         blendFrames = 0;<br />      }<br />   } else if ( spawnArgs.GetString( "start_anim", "", animname ) ) {<br />      anim2 = animator.GetAnim( animname );<br />      if ( !anim2 ) {<br />         gameLocal.Error( "idAnimated '%s' at (%s): cannot find anim '%s'", name.c_str(), GetPhysics()-&gt;GetOrigin().ToString(0), animname.c_str() );<br />      }<br />      animator.CycleAnim( ANIMCHANNEL_ALL, anim2, gameLocal.time, 0 );<br />   } else if ( anim ) {<br />      // init joints to the first frame of the animation<br />      animator.SetFrame( ANIMCHANNEL_ALL, anim, 1, gameLocal.time, 0 );      <br /><br />      if ( !num_anims ) {<br />         blendFrames = 0;<br />      }<br />   }<br /><br />   spawnArgs.GetFloat( "wait", "-1", wait );<br /><br />   // **************************************************************<br />   // **************************************************************<br />   // *** Solarsplace - 22nd Dec 2011 - Make func_animated solid<br /><br />   idClipModel *clipModel = NULL;<br />   idVec3 size;<br />   idBounds bounds;<br />   bool setClipModel = false;<br /><br />   if ( spawnArgs.GetVector( "arx_clip_size", NULL, size ) ) {<br /><br />      if ( ( size.x &lt; 0.0f ) || ( size.y &lt; 0.0f ) || ( size.z &lt; 0.0f ) ) {<br />         gameLocal.Error( "idAnimated::Spawn - Invalid size '%s' on entity '%s'", size.ToString(), name.c_str() );<br />      }<br /><br />      bounds[0].Set( size.x * -0.5f, size.y * -0.5f, 0.0f );<br />      bounds[1].Set( size.x * 0.5f, size.y * 0.5f, size.z );<br />      setClipModel = true;<br />   }<br /><br />   if ( setClipModel ) {<br /><br />      idTraceModel trm;<br />      trm.SetupBox( bounds );<br />      clipModel = new idClipModel( trm );<br />   <br />      GetPhysics()-&gt;SetClipModel( clipModel, 1.0f );<br />      GetPhysics()-&gt;SetContents( CONTENTS_SOLID );<br />   }<br /><br />   // **************************************************************<br />   // **************************************************************<br /><br />   if ( wait &gt;= 0 ) {<br />      PostEventSec( &amp;EV_Activate, wait, this );<br />   }<br />}</div><br /><br />Edit:<br /><br />Then add a key to your entity in the editor or set up a .def item like this etc:<br /><br />entityDef myThing {<br /><br />	"inherit"			"func_animate"<br /><br />	"arx_clip_size"		"8 16 32" // Solarplace - Custom SDK - Make idAnimate have clip model.<br /><br />	"model"			"myThing"<br /><br />	etc...</div>]]></body></post><post id="p242645" date="Posted: Wed Sep 26, 2012 4:17 pm "><author>BloodRayne</author><body><![CDATA[<div class="postbody">I've tested with this extensively before in Grimm.<br /><br />It's entirely possible to clip a func_animate without code or mapping fuzz like clip/func_clip.<br /><br />Just add this to the entitydef of the func_animate:<br />"mins"  "size size size"<br />"maxs" "size size size"<br /><br />(not to be confused with 'editor_mins' and 'editor_maxs')<br /><br />Then the engine will clip the func_animate. But that doesn't solve this problem, which also happens with af's.<br />(attached a shot with g_showEntityInfo option on to show the clip working, the blue box around the flag shows where it clips).<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">			<a href="https://web.archive.org/web/20130320004035/http://www.doom3world.org/phpbb2/download/file.php?id=855&amp;mode=view"><img src="https://web.archive.org/web/20130320004035im_/http://www.doom3world.org/phpbb2/download/file.php?id=855&amp;t=1" alt="shot00211.jpg" /></a><br /><span class="gensmall">shot00211.jpg [ 320.96 KB | Viewed 38 times ]</span>
		
		<br /></div><br /><br />It has to do with the origin bone and the way the engine lods a func_animate somehow.<br />It only happens when you look below a certain angle, e.g. the origin bone of the func_animate falls 'out of view', the engine then clips the entire func_animate.<br /><br />I can't sit up longer than 5 mins otherwise I'd be experimenting with it further right now, I would like to see what happens when you place the origin bone on the ground.</div>]]></body></post><post id="p242646" date="Posted: Wed Sep 26, 2012 4:25 pm "><author>motorsep</author><body><![CDATA[<div class="postbody"><div class="quotetitle">solarsplace wrote:</div><div class="quotecontent">Hi<br />	"arx_clip_size"		"8 16 32" // Solarplace - Custom SDK - Make idAnimate have clip model.<br />etc...</div><br /><br />Thanks man!<br /><br />So does that mean collision boundaries are static? What if my models changes its shape and angles and comes out of the set boundaries ?</div>]]></body></post><post id="p242647" date="Posted: Wed Sep 26, 2012 4:29 pm "><author>motorsep</author><body><![CDATA[<div class="postbody"><div class="quotetitle">BloodRayne wrote:</div><div class="quotecontent">Then the engine will clip the func_animate. But that doesn't solve this problem, which also happens with af's. (attached a shot with g_showEntityInfo option on to show the clip working, the blue box around the flag shows where it clips).</div><br /><br />So I suppose clipping origin bone with brushes is a thing to do? My model doesn't disappear under different view angles, only if I get too close to it.</div>]]></body></post><post id="p242648" date="Posted: Wed Sep 26, 2012 4:31 pm "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />Intersting about your func_animate dissapearing. I have these on walls too as wall torches and have never see them dissapear  <img src="https://web.archive.org/web/20130320004035im_/http://www.doom3world.org/phpbb2/images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  - how very odd!<br /><br />About the clip model - I think (but need to check when I get home) that the mins and maxes will not work on an idAnimated object.<br /><br />The reason I say this is that idEntity from its 'spawn' function makes a call to 'InitDefaultPhysics' which seems to be the only place that 'mins' and 'maxs' are read. However idAnimated has its own 'spawn' method and does not make any call to 'InitDefaultPhysics' to set up any default collision.<br /><br />Are you sure you have not got one of your special scripts spawning some func_clipmodel?<br /><br />Anyway - i'l double check later - cant see how its possible from looking at the code right now...<br /><br />Cheers</div>]]></body></post><post id="p242649" date="Posted: Wed Sep 26, 2012 4:37 pm "><author>BloodRayne</author><body><![CDATA[<div class="postbody"><div class="quotetitle">solarsplace wrote:</div><div class="quotecontent">Hi<br /><br />Intersting about your func_animate dissapearing. I have these on walls too as wall torches and have never see them dissapear  <img src="https://web.archive.org/web/20130320004035im_/http://www.doom3world.org/phpbb2/images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  - how very odd!<br /><br />About the clip model - I think (but need to check when I get home) that the mins and maxes will not work on an idAnimated object.<br /><br />The reason I say this is that idEntity from its 'spawn' function makes a call to 'InitDefaultPhysics' which seems to be the only place that 'mins' and 'maxs' are read. However idAnimated has its own 'spawn' method and does not make any call to 'InitDefaultPhysics' to set up any default collision.<br /><br />Are you sure you have not got one of your special scripts spawning some func_clipmodel?<br /><br />Anyway - i'l double check later - cant see how its possible from looking at the code right now...<br /><br />Cheers</div><br />I have it working, no scripting nothing. It must be inheriting from a lower base function or something.<br />mins/maxs works 100%, no code necessary.</div>]]></body></post><post id="p242650" date="Posted: Wed Sep 26, 2012 5:06 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I've been looking at the stock models that use idAnimate and I don't believe it's the origin bone.  I can't get one entity in the stock game that uses idAnimate to dissapear (specifically trying with enpro_cin_female &amp; caverns_bridge).   I can move all around them, close, far, etc. and they always look as expected.<br /><br />I've noticed the disappear if I spawn the flag entity or if I use the testmodel+testanim commands, so it's not entity related (as testmodel doesn't need an entitydef to work, just a modeldef or a physical model in a folder, such as a .ase).<br /><br />I've noticed that with the custom flag I'm testing from motorsep, when the origin isn't in my FOV the flag disappears, then the bones disappear too when the origin bone bounding box leaves my view.  That does NOT happen with poppy or the bridge.<br /><br />You're both doing flags (bloodrayne's pic shows a flag), right?  You're both using the vertex-to-md5 exporter?<br /><br />Maybe it's the exporter.  could explain why solarplace doesn't have the issue, he's not using that exporter.  I believe I reexported my flag though and it still happened.  Maybe a blender 2.6x thing, or a newer exporter thing?  I still use 2.49 for the most part.<br /><br />EDIT: min/max most likely work because the code looks like it also uses idAFEntity_Gibbable.</div>]]></body></post><post id="p242651" date="Posted: Wed Sep 26, 2012 5:09 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">Are stock entities md5 models or lwo/ase models?</div>]]></body></post><post id="p242652" date="Posted: Wed Sep 26, 2012 5:10 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">both.  items/pickups/movables are ase/lwo &amp; animated are md5.</div>]]></body></post><post id="p242653" date="Posted: Wed Sep 26, 2012 5:23 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">It's definitely the custom content &amp; not the engine, I put all the d3 pk4 files in to motorsep's engine and everything stock D3 works.</div>]]></body></post><post id="p242654" date="Posted: Wed Sep 26, 2012 5:26 pm "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />I think BR is correct the mins and maxs will generate a clip model, having looked at the code again. Wish I knew that before doing some un-needed custom code - oh well..... one learns from experience.<br /><br />I forgot that the 'spawn' functions in the SDK are slightly different than usual setup. The 'spawn' method is executed first for idEntity and then in addition the 'spawn' method for each class that inherits from idEntity is called in addition not instead of.<br /><br />My retarded - sorry for any confusion.<br /><br />Cheers</div>]]></body></post><post id="p242655" date="Posted: Wed Sep 26, 2012 5:40 pm "><author>motorsep</author><body><![CDATA[<div class="postbody"><div class="quotetitle">The Happy Friar wrote:</div><div class="quotecontent">It's definitely the custom content &amp; not the engine, I put all the d3 pk4 files in to motorsep's engine and everything stock D3 works.</div><br /><br />Can you please specify the map and the model in stock Doom 3 or rather RoE which has func_animate with md5 model?</div>]]></body></post><post id="p242656" date="Posted: Wed Sep 26, 2012 6:15 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">Like I said, it's just not the func_animate, it also happens with a testModel &amp; testAnim.  <br /><br />I looked @ enpro_cin_female (poppy in game/enpro) &amp; caverns_bridge (map game/caverns2).<br /><br />the bridge uses the spawnclass "idAnimated" in it's def and poppy inherits cin_base, which itself inherits func_animated and uses the spawnclass "idAnimated", and func_animated uses spawnclass "idAnimated" (don't forget, when you inherit you assume all the properties of the inherited entity and what's changed is what's in your new entityDef).<br /><br />I took my hitler md5mesh/anim &amp; made a new .def file that's based around caverns_bridge.  Long story short, it works just like you'd expect: plays animations w/o disappearing (no collision though).<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">			<span class="genmed">
				<img src="https://web.archive.org/web/20130320004035im_/http://www.doom3world.org/phpbb2/styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /><a href="https://web.archive.org/web/20130320004035/http://www.doom3world.org/phpbb2/download/file.php?id=856">hitler_anim.zip</a> [1.36 MB]
			</span><br /><span class="gensmall">Downloaded 19 times</span>
		
		<br /></div><br /><br />Rename it to .pk4 to view it in game: "testmodel hitler_test" "testanim fire" (or walk).</div>]]></body></post><post id="p242657" date="Posted: Wed Sep 26, 2012 6:21 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">See, you don't inherit func_animate, you simply spawn model with idAnimated spawnclass. That means you don't have that flexibility of messing with your model via triggers (not that the flag needs that).<br /><br />Here is the video of how the issue looks like: <!-- m --><a class="postlink" href="https://web.archive.org/web/20130320004035/http://www.youtube.com/watch?v=tujS3AkLKkQ">http://www.youtube.com/watch?v=tujS3AkLKkQ</a><!-- m --></div>]]></body></post><post id="p242658" date="Posted: Wed Sep 26, 2012 7:13 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I know what it does.<br /><br />I checked: testmodel inherits from idAnimated, which func_animate does.<br /><br />Any entity that calls the class "idAnimated" all have the same functionality, func_animate just sets up defaults.  key/values are based on the class not the entityDef.<br /><br />Either way, it's an asset issue.  I have a flag model for Quake 2 I made, maybe later I'll try to port it to D3.</div>]]></body></post><post id="p242659" date="Posted: Wed Sep 26, 2012 7:41 pm "><author>Brain Trepaning</author><body><![CDATA[<div class="postbody">I used to fix this by moving the placement of the origin bone prior to export from the modeling program. I found when the model's origin point (red spot) in the editor was a few units away from the actual model because I did not build it on 0,0,0, the model would disappear when i got close and the origin bone point was no longer in my FOV.</div>]]></body></post><post id="p242660" date="Posted: Wed Sep 26, 2012 8:57 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">Ok, I messed with origin bone and I can confirm that disappearance happens when origin bone is out of player's FOV.</div>]]></body></post><post id="p242663" date="Posted: Thu Sep 27, 2012 2:50 am "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I took motorsep's flag model ,imported it in to Blender 249 &amp; reexported it and it worked no issues.<br /><br />The animation files are different for some reason.  He used 2.63 with md5exporter I believe, so try using 2.49 to re-export and see if it works.</div>]]></body></post><post id="p242670" date="Posted: Thu Sep 27, 2012 10:01 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">That I confirm. For whatever reason block of code that generates bounds for each frame isn't working correctly on 2.63.<br /><br />And that's the only issue with the output. I manually replaced bounds in 2.63 output and the func_animate no longer disappears.</div>]]></body></post><post id="p242638" date="Posted: Wed Sep 26, 2012 5:29 am "><author>motorsep</author><body><![CDATA[<div class="postbody">I have an entity that inherits func_animate on the map (animated md5 model). When I get too close to it, it disappears. I move away, it appears. I would prefer for it to just be there when I pass through it. Has anyone encountered and resolved similar issue?<br /><br />Here are the entity's setting:<br /><br /><img src="https://web.archive.org/web/20130320005920im_/http://i.imgur.com/fBUD9.jpg" alt="Image" /></div>]]></body></post><post id="p242639" date="Posted: Wed Sep 26, 2012 6:54 am "><author>BloodRayne</author><body><![CDATA[<div class="postbody">I have the exact same issue in Grimm. No clue how to solve it.</div>]]></body></post><post id="p242640" date="Posted: Wed Sep 26, 2012 7:09 am "><author>Gary</author><body><![CDATA[<div class="postbody">Bounding box problems? LODs set up wrong/corrupt? Are there fade/render distances per entity in Doom3? If so, those values maybe wrong. (Wait, maybe there are no LODs in D3... can't remember) <br /><br />I'm just guessing, I'm a Source modder. So I'm just saying what ever causes a similar problems...</div>]]></body></post><post id="p242641" date="Posted: Wed Sep 26, 2012 10:35 am "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />I am not 100% sure if this is what you are experiencing exactly but...<br /><br />EDIT: What I say here is not quite correct. You can in fact use "mins" and "maxs" to set up a basic clip bounding box.<br /><br />Where you aware that func_animate (idAnimated) does not have code in the SDK to set up a clip model at all.<br /><br />So you will always be able to walk through it (It may dissapear from view if player is in / on it) unless you bind a func_clipmodel to it, put clip brushes around it or modify the SDK code so that you can enter a simple bounding box clip setup from an entity def if you are using a lot of them like myself and you decide its worth it.<br /><br />Hope that helps.<br /><br />Cheers</div>]]></body></post><post id="p242642" date="Posted: Wed Sep 26, 2012 1:05 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I did a quick check in game and it looks like idanimated is always used for cinematics...  I thought there was some bridges &amp; what not where it wasn't.  <img src="https://web.archive.org/web/20130320005920im_/http://www.doom3world.org/phpbb2/images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>]]></body></post><post id="p242643" date="Posted: Wed Sep 26, 2012 3:53 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">@solarsplace: care to share your SDK code? <img src="https://web.archive.org/web/20130320005920im_/http://www.doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p242644" date="Posted: Wed Sep 26, 2012 4:07 pm "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />How could I refuse! - here you go.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">/*<br />===============<br />idAnimated::Spawn<br />================<br />*/<br />void idAnimated::Spawn( void ) {<br />   idStr      animname;<br />   int         anim2;<br />   float      wait;<br />   const char   *joint;<br /><br />   joint = spawnArgs.GetString( "sound_bone", "origin" ); <br />   soundJoint = animator.GetJointHandle( joint );<br />   if ( soundJoint == INVALID_JOINT ) {<br />      gameLocal.Warning( "idAnimated '%s' at (%s): cannot find joint '%s' for sound playback", name.c_str(), GetPhysics()-&gt;GetOrigin().ToString(0), joint );<br />   }<br /><br />   LoadAF();<br /><br />   // allow bullets to collide with a combat model<br />   if ( spawnArgs.GetBool( "combatModel", "0" ) ) {<br />      combatModel = new idClipModel( modelDefHandle );<br />   }<br /><br />   // allow the entity to take damage<br />   if ( spawnArgs.GetBool( "takeDamage", "0" ) ) {<br />      fl.takedamage = true;<br />   }<br /><br />   blendFrames = 0;<br /><br />   current_anim_index = 0;<br />   spawnArgs.GetInt( "num_anims", "0", num_anims );<br /><br />   blendFrames = spawnArgs.GetInt( "blend_in" );<br /><br />   animname = spawnArgs.GetString( num_anims ? "anim1" : "anim" );<br />   if ( !animname.Length() ) {<br />      anim = 0;<br />   } else {<br />      anim = animator.GetAnim( animname );<br />      if ( !anim ) {<br />         gameLocal.Error( "idAnimated '%s' at (%s): cannot find anim '%s'", name.c_str(), GetPhysics()-&gt;GetOrigin().ToString(0), animname.c_str() );<br />      }<br />   }<br /><br />   if ( spawnArgs.GetBool( "hide" ) ) {<br />      Hide();<br /><br />      if ( !num_anims ) {<br />         blendFrames = 0;<br />      }<br />   } else if ( spawnArgs.GetString( "start_anim", "", animname ) ) {<br />      anim2 = animator.GetAnim( animname );<br />      if ( !anim2 ) {<br />         gameLocal.Error( "idAnimated '%s' at (%s): cannot find anim '%s'", name.c_str(), GetPhysics()-&gt;GetOrigin().ToString(0), animname.c_str() );<br />      }<br />      animator.CycleAnim( ANIMCHANNEL_ALL, anim2, gameLocal.time, 0 );<br />   } else if ( anim ) {<br />      // init joints to the first frame of the animation<br />      animator.SetFrame( ANIMCHANNEL_ALL, anim, 1, gameLocal.time, 0 );      <br /><br />      if ( !num_anims ) {<br />         blendFrames = 0;<br />      }<br />   }<br /><br />   spawnArgs.GetFloat( "wait", "-1", wait );<br /><br />   // **************************************************************<br />   // **************************************************************<br />   // *** Solarsplace - 22nd Dec 2011 - Make func_animated solid<br /><br />   idClipModel *clipModel = NULL;<br />   idVec3 size;<br />   idBounds bounds;<br />   bool setClipModel = false;<br /><br />   if ( spawnArgs.GetVector( "arx_clip_size", NULL, size ) ) {<br /><br />      if ( ( size.x &lt; 0.0f ) || ( size.y &lt; 0.0f ) || ( size.z &lt; 0.0f ) ) {<br />         gameLocal.Error( "idAnimated::Spawn - Invalid size '%s' on entity '%s'", size.ToString(), name.c_str() );<br />      }<br /><br />      bounds[0].Set( size.x * -0.5f, size.y * -0.5f, 0.0f );<br />      bounds[1].Set( size.x * 0.5f, size.y * 0.5f, size.z );<br />      setClipModel = true;<br />   }<br /><br />   if ( setClipModel ) {<br /><br />      idTraceModel trm;<br />      trm.SetupBox( bounds );<br />      clipModel = new idClipModel( trm );<br />   <br />      GetPhysics()-&gt;SetClipModel( clipModel, 1.0f );<br />      GetPhysics()-&gt;SetContents( CONTENTS_SOLID );<br />   }<br /><br />   // **************************************************************<br />   // **************************************************************<br /><br />   if ( wait &gt;= 0 ) {<br />      PostEventSec( &amp;EV_Activate, wait, this );<br />   }<br />}</div><br /><br />Edit:<br /><br />Then add a key to your entity in the editor or set up a .def item like this etc:<br /><br />entityDef myThing {<br /><br />	"inherit"			"func_animate"<br /><br />	"arx_clip_size"		"8 16 32" // Solarplace - Custom SDK - Make idAnimate have clip model.<br /><br />	"model"			"myThing"<br /><br />	etc...</div>]]></body></post><post id="p242645" date="Posted: Wed Sep 26, 2012 4:17 pm "><author>BloodRayne</author><body><![CDATA[<div class="postbody">I've tested with this extensively before in Grimm.<br /><br />It's entirely possible to clip a func_animate without code or mapping fuzz like clip/func_clip.<br /><br />Just add this to the entitydef of the func_animate:<br />"mins"  "size size size"<br />"maxs" "size size size"<br /><br />(not to be confused with 'editor_mins' and 'editor_maxs')<br /><br />Then the engine will clip the func_animate. But that doesn't solve this problem, which also happens with af's.<br />(attached a shot with g_showEntityInfo option on to show the clip working, the blue box around the flag shows where it clips).<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">			<a href="https://web.archive.org/web/20130320005920/http://www.doom3world.org/phpbb2/download/file.php?id=855&amp;mode=view"><img src="https://web.archive.org/web/20130320005920im_/http://www.doom3world.org/phpbb2/download/file.php?id=855&amp;t=1" alt="shot00211.jpg" /></a><br /><span class="gensmall">shot00211.jpg [ 320.96 KB | Viewed 38 times ]</span>
		
		<br /></div><br /><br />It has to do with the origin bone and the way the engine lods a func_animate somehow.<br />It only happens when you look below a certain angle, e.g. the origin bone of the func_animate falls 'out of view', the engine then clips the entire func_animate.<br /><br />I can't sit up longer than 5 mins otherwise I'd be experimenting with it further right now, I would like to see what happens when you place the origin bone on the ground.</div>]]></body></post><post id="p242646" date="Posted: Wed Sep 26, 2012 4:25 pm "><author>motorsep</author><body><![CDATA[<div class="postbody"><div class="quotetitle">solarsplace wrote:</div><div class="quotecontent">Hi<br />	"arx_clip_size"		"8 16 32" // Solarplace - Custom SDK - Make idAnimate have clip model.<br />etc...</div><br /><br />Thanks man!<br /><br />So does that mean collision boundaries are static? What if my models changes its shape and angles and comes out of the set boundaries ?</div>]]></body></post><post id="p242647" date="Posted: Wed Sep 26, 2012 4:29 pm "><author>motorsep</author><body><![CDATA[<div class="postbody"><div class="quotetitle">BloodRayne wrote:</div><div class="quotecontent">Then the engine will clip the func_animate. But that doesn't solve this problem, which also happens with af's. (attached a shot with g_showEntityInfo option on to show the clip working, the blue box around the flag shows where it clips).</div><br /><br />So I suppose clipping origin bone with brushes is a thing to do? My model doesn't disappear under different view angles, only if I get too close to it.</div>]]></body></post><post id="p242648" date="Posted: Wed Sep 26, 2012 4:31 pm "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />Intersting about your func_animate dissapearing. I have these on walls too as wall torches and have never see them dissapear  <img src="https://web.archive.org/web/20130320005920im_/http://www.doom3world.org/phpbb2/images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  - how very odd!<br /><br />About the clip model - I think (but need to check when I get home) that the mins and maxes will not work on an idAnimated object.<br /><br />The reason I say this is that idEntity from its 'spawn' function makes a call to 'InitDefaultPhysics' which seems to be the only place that 'mins' and 'maxs' are read. However idAnimated has its own 'spawn' method and does not make any call to 'InitDefaultPhysics' to set up any default collision.<br /><br />Are you sure you have not got one of your special scripts spawning some func_clipmodel?<br /><br />Anyway - i'l double check later - cant see how its possible from looking at the code right now...<br /><br />Cheers</div>]]></body></post><post id="p242649" date="Posted: Wed Sep 26, 2012 4:37 pm "><author>BloodRayne</author><body><![CDATA[<div class="postbody"><div class="quotetitle">solarsplace wrote:</div><div class="quotecontent">Hi<br /><br />Intersting about your func_animate dissapearing. I have these on walls too as wall torches and have never see them dissapear  <img src="https://web.archive.org/web/20130320005920im_/http://www.doom3world.org/phpbb2/images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  - how very odd!<br /><br />About the clip model - I think (but need to check when I get home) that the mins and maxes will not work on an idAnimated object.<br /><br />The reason I say this is that idEntity from its 'spawn' function makes a call to 'InitDefaultPhysics' which seems to be the only place that 'mins' and 'maxs' are read. However idAnimated has its own 'spawn' method and does not make any call to 'InitDefaultPhysics' to set up any default collision.<br /><br />Are you sure you have not got one of your special scripts spawning some func_clipmodel?<br /><br />Anyway - i'l double check later - cant see how its possible from looking at the code right now...<br /><br />Cheers</div><br />I have it working, no scripting nothing. It must be inheriting from a lower base function or something.<br />mins/maxs works 100%, no code necessary.</div>]]></body></post><post id="p242650" date="Posted: Wed Sep 26, 2012 5:06 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I've been looking at the stock models that use idAnimate and I don't believe it's the origin bone.  I can't get one entity in the stock game that uses idAnimate to dissapear (specifically trying with enpro_cin_female &amp; caverns_bridge).   I can move all around them, close, far, etc. and they always look as expected.<br /><br />I've noticed the disappear if I spawn the flag entity or if I use the testmodel+testanim commands, so it's not entity related (as testmodel doesn't need an entitydef to work, just a modeldef or a physical model in a folder, such as a .ase).<br /><br />I've noticed that with the custom flag I'm testing from motorsep, when the origin isn't in my FOV the flag disappears, then the bones disappear too when the origin bone bounding box leaves my view.  That does NOT happen with poppy or the bridge.<br /><br />You're both doing flags (bloodrayne's pic shows a flag), right?  You're both using the vertex-to-md5 exporter?<br /><br />Maybe it's the exporter.  could explain why solarplace doesn't have the issue, he's not using that exporter.  I believe I reexported my flag though and it still happened.  Maybe a blender 2.6x thing, or a newer exporter thing?  I still use 2.49 for the most part.<br /><br />EDIT: min/max most likely work because the code looks like it also uses idAFEntity_Gibbable.</div>]]></body></post><post id="p242651" date="Posted: Wed Sep 26, 2012 5:09 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">Are stock entities md5 models or lwo/ase models?</div>]]></body></post><post id="p242652" date="Posted: Wed Sep 26, 2012 5:10 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">both.  items/pickups/movables are ase/lwo &amp; animated are md5.</div>]]></body></post><post id="p242653" date="Posted: Wed Sep 26, 2012 5:23 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">It's definitely the custom content &amp; not the engine, I put all the d3 pk4 files in to motorsep's engine and everything stock D3 works.</div>]]></body></post><post id="p242654" date="Posted: Wed Sep 26, 2012 5:26 pm "><author>solarsplace</author><body><![CDATA[<div class="postbody">Hi<br /><br />I think BR is correct the mins and maxs will generate a clip model, having looked at the code again. Wish I knew that before doing some un-needed custom code - oh well..... one learns from experience.<br /><br />I forgot that the 'spawn' functions in the SDK are slightly different than usual setup. The 'spawn' method is executed first for idEntity and then in addition the 'spawn' method for each class that inherits from idEntity is called in addition not instead of.<br /><br />My retarded - sorry for any confusion.<br /><br />Cheers</div>]]></body></post><post id="p242655" date="Posted: Wed Sep 26, 2012 5:40 pm "><author>motorsep</author><body><![CDATA[<div class="postbody"><div class="quotetitle">The Happy Friar wrote:</div><div class="quotecontent">It's definitely the custom content &amp; not the engine, I put all the d3 pk4 files in to motorsep's engine and everything stock D3 works.</div><br /><br />Can you please specify the map and the model in stock Doom 3 or rather RoE which has func_animate with md5 model?</div>]]></body></post><post id="p242656" date="Posted: Wed Sep 26, 2012 6:15 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">Like I said, it's just not the func_animate, it also happens with a testModel &amp; testAnim.  <br /><br />I looked @ enpro_cin_female (poppy in game/enpro) &amp; caverns_bridge (map game/caverns2).<br /><br />the bridge uses the spawnclass "idAnimated" in it's def and poppy inherits cin_base, which itself inherits func_animated and uses the spawnclass "idAnimated", and func_animated uses spawnclass "idAnimated" (don't forget, when you inherit you assume all the properties of the inherited entity and what's changed is what's in your new entityDef).<br /><br />I took my hitler md5mesh/anim &amp; made a new .def file that's based around caverns_bridge.  Long story short, it works just like you'd expect: plays animations w/o disappearing (no collision though).<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">			<span class="genmed">
				<img src="https://web.archive.org/web/20130320005920im_/http://www.doom3world.org/phpbb2/styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /><a href="https://web.archive.org/web/20130320005920/http://www.doom3world.org/phpbb2/download/file.php?id=856">hitler_anim.zip</a> [1.36 MB]
			</span><br /><span class="gensmall">Downloaded 19 times</span>
		
		<br /></div><br /><br />Rename it to .pk4 to view it in game: "testmodel hitler_test" "testanim fire" (or walk).</div>]]></body></post><post id="p242657" date="Posted: Wed Sep 26, 2012 6:21 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">See, you don't inherit func_animate, you simply spawn model with idAnimated spawnclass. That means you don't have that flexibility of messing with your model via triggers (not that the flag needs that).<br /><br />Here is the video of how the issue looks like: <!-- m --><a class="postlink" href="https://web.archive.org/web/20130320005920/http://www.youtube.com/watch?v=tujS3AkLKkQ">http://www.youtube.com/watch?v=tujS3AkLKkQ</a><!-- m --></div>]]></body></post><post id="p242658" date="Posted: Wed Sep 26, 2012 7:13 pm "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I know what it does.<br /><br />I checked: testmodel inherits from idAnimated, which func_animate does.<br /><br />Any entity that calls the class "idAnimated" all have the same functionality, func_animate just sets up defaults.  key/values are based on the class not the entityDef.<br /><br />Either way, it's an asset issue.  I have a flag model for Quake 2 I made, maybe later I'll try to port it to D3.</div>]]></body></post><post id="p242659" date="Posted: Wed Sep 26, 2012 7:41 pm "><author>Brain Trepaning</author><body><![CDATA[<div class="postbody">I used to fix this by moving the placement of the origin bone prior to export from the modeling program. I found when the model's origin point (red spot) in the editor was a few units away from the actual model because I did not build it on 0,0,0, the model would disappear when i got close and the origin bone point was no longer in my FOV.</div>]]></body></post><post id="p242660" date="Posted: Wed Sep 26, 2012 8:57 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">Ok, I messed with origin bone and I can confirm that disappearance happens when origin bone is out of player's FOV.</div>]]></body></post><post id="p242663" date="Posted: Thu Sep 27, 2012 2:50 am "><author>The Happy Friar</author><body><![CDATA[<div class="postbody">I took motorsep's flag model ,imported it in to Blender 249 &amp; reexported it and it worked no issues.<br /><br />The animation files are different for some reason.  He used 2.63 with md5exporter I believe, so try using 2.49 to re-export and see if it works.</div>]]></body></post><post id="p242670" date="Posted: Thu Sep 27, 2012 10:01 pm "><author>motorsep</author><body><![CDATA[<div class="postbody">That I confirm. For whatever reason block of code that generates bounds for each frame isn't working correctly on 2.63.<br /><br />And that's the only issue with the output. I manually replaced bounds in 2.63 output and the func_animate no longer disappears.</div>]]></body></post></posts></thread></xml>
