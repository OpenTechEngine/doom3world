<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="19707"><title>Can a stage ignore the colour of the illuminating light?</title><posts><post id="p179909" date="Posted: Tue Jun 05, 2007 2:47 pm "><author>simulation</author><body><![CDATA[<div class="postbody">I'm using a material on a model in a mainmenu.gui renderDef and altering the lightColor of the renderDef to dynamically colour the surfaces of the model - I can't think of another way because you can't get access to the shaderparms for a renderDef.&#13;<br /><br />This works fine except that the whole model gets lit with the applied light. I'd like only certain shader stages to use the light color if that is possible.&#13;<br /><br />For example...&#13;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">material test_shader {<br />    // This stage is lit as normal,<br />    // with the colour of the light hitting the surface<br />    {<br />        blend diffuse<br />        map lit_stage_d.tga<br />    }<br />    {<br />        blend bumpmap<br />        map addnormals(lit_stage_local.tga,heightmap(lit_stage_h.tga, 5))<br />    }<br />    {<br />        blend specular<br />        map lit_stage_s.tga<br />    }<br />    // I want this stage to be lit with "white" light so that bump/spec<br />    // are rendered but the diffuse remains uncoloured by the light<br />    {<br />        blend diffuse<br />        map unlit_stage_d.tga<br />    }<br />    {<br />        blend bumpmap<br />        map addnormals(unlit_stage_local.tga,heightmap(unlit_stage_h.tga, 5))<br />    }<br />    {<br />        blend specular<br />        map unlit_stage_s.tga<br />    }<br />}</div><br /><br />The best I've managed so far is to implement the "unlit" stage as "blend add", but thats not great because it bypasses the bump/spec stages and appears flat. <br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">material test_shader {<br />    // This stage is lit as normal,<br />    // with the colour of the light hitting the surface<br />    {<br />        blend diffuse<br />        map lit_stage_d.tga<br />    }<br />    {<br />        blend bumpmap<br />        map addnormals(lit_stage_local.tga,heightmap(lit_stage_h.tga, 5))<br />    }<br />    {<br />        blend specular<br />        map lit_stage_s.tga<br />    }<br />    // This stage remains unlit fine but because it is "blend add"<br />    // it is "flat"<br />    {<br />        blend add<br />        map unlit_stage_d.tga<br />    }<br />}</div>&#13;<br /><br />This is how it looks with the above shader. The body is bump/specced fine (lit stage) but the arms, head and boots (blend add stage) look poor.&#13;<br /><br /><img src="https://web.archive.org/web/20070509181516im_/http://www.the-emz.com/images/d3w/renderdef.jpg" alt="Image" /><br /><br />Any suggestions?&#13;<br /><br />Sim</div>]]></body></post><post id="p179954" date="Posted: Wed Jun 06, 2007 1:21 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">I haven't played with renderDefs much. Is it possible to light a model with two or more lights?&#13;<br /><br />If so, you can use the "spectrum" keyword on a per material basis. More on that here...&#13;<br /><br /><!-- m --><a class="postlink" href="https://web.archive.org/web/20070509181516/http://www.modwiki.net/wiki/Spectrum_%28Material_global_keyword%29">http://www.modwiki.net/wiki/Spectrum_%2 ... keyword%29</a><!-- m --></div>]]></body></post><post id="p179967" date="Posted: Wed Jun 06, 2007 7:29 am "><author>simulation</author><body><![CDATA[<div class="postbody"><div class="quotetitle">rich_is_bored wrote:</div><div class="quotecontent">I haven't played with renderDefs much. Is it possible to light a model with two or more lights?<br /><br />If so, you can use the "spectrum" keyword on a per material basis. More on that here...<br /><br /><!-- m --><a class="postlink" href="https://web.archive.org/web/20070509181516/http://www.modwiki.net/wiki/Spectrum_%28Material_global_keyword%29">http://www.modwiki.net/wiki/Spectrum_%2 ... keyword%29</a><!-- m --></div>&#13;<br /><br />Thanks Rich, but unfortunately not <img src="https://web.archive.org/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_sad.gif" alt=":(" title="Sad" /> In Q4 the renderDef supports multiple light sources but not D3.&#13;<br /><br />Even if it did, the light is simply defined as a Vec4:&#13;<br /><br />   lightColor r,g,b,x (not sure what it uses x for)&#13;<br /><br />I'll have a dig through the materials and see if there is a default light material that it uses for the renderDef light source.&#13;<br /><br />I've thought of using a spectrum as I've found that to be really useful for selective effects, but as far as I can see it is a shader keyword, not a stage keyword.&#13;<br /><br />Sim</div>]]></body></post><post id="p179969" date="Posted: Wed Jun 06, 2007 10:24 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">Let's say shaderparms worked. What would you be doing with them?</div>]]></body></post><post id="p179971" date="Posted: Wed Jun 06, 2007 11:13 am "><author>simulation</author><body><![CDATA[<div class="postbody"><div class="quotetitle">rich_is_bored wrote:</div><div class="quotecontent">Let's say shaderparms worked. What would you be doing with them?</div>&#13;<br /><br />The idea is to adjust the R,G,B to allow a "colored" stage with a greyscale diffuse map to vary.&#13;<br /><br />I've taken a slightly different approach and coerced the SDK into adjusting the material definition of my model skins on the fly. Finally managed to achieve my goal...&#13;<br /><br />I've uploaded a preview of my work in progress menu...&#13;<br /><br /><a href="https://web.archive.org/web/20070509181516/http://www.the-emz.com/download/Movie_MD5.wmv" class="postlink">http://www.the-emz.com/download/Movie_MD5.wmv</a>&#13;<br /><br />The body here is still a single material, but the diffusemap is in two parts. One is the area that does not get colored, the other is a greyscale.&#13;<br /><br />I still can't get at the model's shaderparms but I'm now using this shader...&#13;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">material skins/gui/marine/body {<br />   noselfShadow<br />   noOverlays<br />   clamp<br />   bumpmap      addnormals(models/characters/male_npc/marine/marine_local.tga,heightmap(models/characters/male_npc/marine/marine_h.tga, 5))<br />   {<br />      blend   diffusemap   <br />      map      scale(models/characters/male_npc/marine/marine_patch.tga,2,2,2,1)<br />      red      0.1<br />      green   0.2<br />      blue   0.3<br />   }<br />   {<br />      blend    diffusemap<br />      map      models/characters/male_npc/marine/marine_base.tga<br />   }<br />   specularmap   models/characters/male_npc/marine/mp1_s.tga<br />}</div>&#13;<br /><br />I dynamically adjust the red, green and blue values using the SDK to change the base material.&#13;<br /><br />Sim</div>]]></body></post><post id="p180103" date="Posted: Thu Jun 07, 2007 10:56 am "><author>rich_is_bored</author><body><![CDATA[<div class="postbody">That's a very clean interface you have there. <img src="https://web.archive.org/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>]]></body></post><post id="p180105" date="Posted: Thu Jun 07, 2007 11:01 am "><author>simulation</author><body><![CDATA[<div class="postbody"><div class="quotetitle">rich_is_bored wrote:</div><div class="quotecontent">That's a very clean interface you have there. <img src="https://web.archive.org/web/20070509181516im_/http://doom3world.org/phpbb2/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>&#13;<br /><br />It still a work in progress but its getting better. I just uploaded a new version of the video (same link as above).</div>]]></body></post></posts></thread></xml>
