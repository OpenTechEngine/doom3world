<?xml version="1.0" encoding="UTF-8"?>
<xml><thread id="6853"><title>MBolus Tutorial: Monsters on the Walls, Part 2</title><posts><post id="p57844" date="Posted: Wed Oct 20, 2004 6:46 am "><author>MBolus</author><body><![CDATA[<div class="postbody"><span style="font-size: 200%; line-height: normal"><span style="font-weight: bold">MBolus Tutorial: Monsters on the Walls, Part 2</span></span>
<br /><span style="font-size: 150%; line-height: normal">(Walking on all walls, floors, and ceilings)</span>
<br /><br /><img src="https://web.archive.org/web/20100522162615im_/http://img100.exs.cx/img100/3897/magimptrucei1s.jpg" alt="Image" /><br /><br /><span style="font-size: 150%; line-height: normal">Introduction</span>
<br />Welcome to Part 2 of my tutorial. To the best of my knowledge, this is the first time that the following techniques are being discussed (other than my messages regarding Part 1). I have developed a lot of experience with handling gravity over the past few months, and this will reveal much of what I have discovered. I will include some scripting for those who are interested, although much of it is for extraneous enhancements in Part 2. It is not absolutely necessary to have learned Part 1 first, for it was just a simple introduction to get the information out to you while I made the time to put this part of the tutorial together, and to build a foundation for those who might need it to understand Part 2. 
<br /><br />One of the first things you will see in the rudimentary accompanying map is several maggots chasing you as you head for a way out of a quarantine area; one of your options is to use a type of ladder, but that sort of thing doesn't stop the monsters from dynamically pursuing you, and it does not require major coding. In Part 3 I can demonstrate how a monster can walk after you on the floor, climb up the ladder / fence or even the wall after you, and then follow you again on the next floor up, but you can get similar effective pursuits using the methods here, without heavy scripting.
<br /><br />You will also see a bit of pathing in some rooms; I did not yet take the time to fine tune some of the paths, so some errors in pathfinding are permitted for this release so you can get the information earlier. I also use my Monster Cam: for a few seconds you step into the skin of an imp walking down a hallway, with his claws where your hands should be; for a more detailed explanation, just see my nice Monster Cam tutorial!
<br /><br />I will also introduce a simple form of a hybrid type of creature the Imptruger, with just a few .def files for you to put into your def directory in the base directory (you may prefer another location, but that does the trick). After you also place my .map and .script files into your maps directory in the base directory, just restart Doom 3 and enjoy. (v.02 of the .rar can just be unrar'ed into your base subdirectory of your Doom 3 directory, and everything should go into its place, but the above info helps in case of errors during extracting with WinRAR or whatever you use). 
<br /><br />By the way, you can replace the mutant type of imp with a regular one in the editor, if you don't like him. You will get just a few errors handling the Magtruger, but that should be no problem just to check it out; I haven't finished it yet, but it is soooo cute I couldn't leave it out. As you will see, for now I just defined its chest as a head_joint. I might later release a version of the map without these creatures, and maybe a version set up like pk4 etc., so you are welcome to wait until then, as the meat of the info is here in the text. 
<br /><br />You will be able to download the file containing the .map, .script, and .def files from any of the sites listed below:
<br /><br />/*
<br /><a href="https://web.archive.org/web/20100522162615/http://www.doomcentral.net/hosted/MBMonsWallPart2.rar" class="postlink">http://www.doomcentral.net/hosted/MBMonsWallPart2.rar</a>
<br /><a href="https://web.archive.org/web/20100522162615/http://www.mnemic.tk/education/writtentutorials/files/MBMonsWallPart2.rar" class="postlink">http://www.mnemic.tk/education/writtentutorials/files/MBMonsWallPart2.rar</a>
<br />*/
<br /><br /><img src="https://web.archive.org/web/20100522162615im_/http://img85.exs.cx/img85/6148/impcamclaws2s.jpg" alt="Image" /><br /><br /><span style="font-size: 150%; line-height: normal">GravityDir</span>
<br />As I have been indicating on Doom3World.org for a while now, a great way to alter a monster’s sense of gravity is to enter a value for its key gravityDir. In my map you will see many examples of different values for gravityDir along with their effects. A value of 0 allows free floating. Any trailing zeroes in the vector can be omitted, and some of my scripting makes use of this feature which simplifies certain scenarios. For example, -.5 bases a monster on west surfaces, and permits it to jump very far from the wall. 0 .75 .75 lets it hang out on the north wall and the ceiling, as it is not attracted to an x direction but is somewhat attracted to positive y and z. Very high and low ranges can be used. The following chart shows the direction of attraction for each component of the vector:
<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">     0     0    +z    ceiling<br /><br />     0    +y     0    north walls<br /><br />    +x     0     0    east walls<br />       <br />     0    -y     0    south walls<br /><br />    -x     0     0    west walls<br /><br />     0     0    -z    floor<br /><br />   Essentially infinite combinations of values are possible</div><br /><br /><span style="font-size: 150%; line-height: normal">Scripting</span><br />There are multiple ways to script dynamic changes in gravityDir, e.g. for going around many corners, or even for jumping from one wall to its opposing surface. One way is to use a trigger which calls a function. It is easy enough to write more complex scripts, but I will start with a simple generalization for Part 2, which is a bit better than that in Part 1. <br /><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void reverse_monster_gravity (entity ent_mon_this) //reverse the x component of gravityDir for appropriate scenarios<br />{<br />string mon_class ;                 //className<br />string mon_gra ;                   //gravityDir<br />float mon_gra_len ;               <br /><br />   sys.copySpawnArgs(ent_mon_this); //copy a lot of the spawn arguments<br />   sys.setSpawnArg("origin",ent_mon_this.getWorldOrigin());<br />   mon_class=ent_mon_this.getKey("className");    <br />//   sys.setSpawnArg("name",ent_mon_this.getName());       //if desired<br />   mon_gra=ent_mon_this.getKey("gravityDir");<br />   mon_gra_len=sys.strLength(mon_gra);      <br /><br />   if(sys.strLeft(mon_gra,1)=="-"){<br />      mon_gra=sys.strRight(mon_gra,mon_gra_len-1);<br />   }<br />   else{<br />      mon_gra="-"+mon_gra;<br />   }   <br /><br />   sys.setSpawnArg("gravityDir",mon_gra);                 //insert the new gravity<br />   ent_mon_this.remove();<br />   ent_mon_this.waitFrame();<br />   sys.spawn(mon_class); //spawn with updated settings, including gravity<br />}</div><br /><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void rev_imp_14w()             //reverse gravity for a specific entity<br />{<br />   if (sys.random(6)&lt;2){<br />      reverse_monster_gravity($monster_demon_imp_crawler_14w);       //pass to reverse_monster_gravity<br />   }<br />}</div>
<br /><br />Part 1 shows multiple editor screen shots, for those who are interested. I may add more images to Part 2 later, when time permits.
<br /><br />As you can tell, this is not a finished map, and I plan to update it including some improvement in speed, textures, and more. For example, I may remove some glass and monsters as I test it on a variety of machines. (I don't yet need messages in the thread mentioning these things, although feel free to PM me.) My machines run it well so far, but this is still a rough draft that I will still be smoothing out. You will find much extra code in the .script file for similar reasons. 
<br /><br />... more next time!
<br />(EDIT: added URLs for map)
<br /><br /><img src="https://web.archive.org/web/20100522162615im_/http://img43.exs.cx/img43/9868/impbetout3s.jpg" alt="Image" /></div>]]></body></post><post id="p57857" date="Posted: Wed Oct 20, 2004 8:37 am "><author>MNeMiC</author><body><![CDATA[<div class="postbody">This sure looks interesting, I'm gonna host the file ASAP when I get back from school.</div>]]></body></post><post id="p58206" date="Posted: Thu Oct 21, 2004 3:16 pm "><author>Necrotoxin</author><body><![CDATA[<div class="postbody">I've messed with this, but without scripts it just doesnt look natural. Like in Aliens vs. Predator, 1 or 2, the alien crawls all over the place, but in doom it just doesnt work that way. (There's just something not right about killing something on the ceiling and it falls to the ceiling. I'd like to see an AvP 3 in the Doom 3 engine or a Justin Fisher's remake of Aliens TC for Doom 1 in Doom 3)</div>]]></body></post><post id="p58341" date="Posted: Fri Oct 22, 2004 1:32 am "><author>MBolus</author><body><![CDATA[<div class="postbody"><div class="quotetitle">MNeMiC wrote:</div><div class="quotecontent">This sure looks interesting, I'm gonna host the file ASAP when I get back from school.</div><br />Okay, I can add the url to the tut when you get it on your site!<br /><br /><div class="quotetitle">Necrotoxin wrote:</div><div class="quotecontent">I've messed with this, but without scripts it just doesnt look natural. Like in Aliens vs. Predator, 1 or 2, the alien crawls all over the place, but in doom it just doesnt work that way. (There's just something not right about killing something on the ceiling and it falls to the ceiling.</div>
<br />In my tutorial and map, they crawl between the walls, ceiling, and so on. Also, check out the Pinky on the ceiling in the Relaxation Room of the North Administration area: it is very natural, including its interaction with the ceiling Wraith. In some of the areas I do make it less natural, so you can see some of the control or pathing you can exert. Although Part 3 will be even better, Part 2 already achieves quite a bit without getting that deep and heavy. 
<br /><br />Necrotoxin, if you shoot my ceiling creatures, they will fall to the ground as they should. Check it out!</div>]]></body></post><post id="p58399" date="Posted: Fri Oct 22, 2004 10:32 am "><author>MNeMiC</author><body><![CDATA[<div class="postbody">
<!-- w -->
  <a class="postlink" href="https://web.archive.org/web/20100522162615/http://www.mnemic.tk/education/writtentutorials/files/MBMonsWallPart2.rar">http://www.mnemic.tk/education/writtent ... lPart2.rar</a>
<!-- w -->
</div>]]></body></post><post id="p58413" date="Posted: Fri Oct 22, 2004 12:08 pm "><author>Sloanbone</author><body><![CDATA[<div class="postbody"><a href="https://web.archive.org/web/20100522162615/http://www.doomcentral.net/hosted/MBMonsWallPart2.rar" class="postlink">http://www.doomcentral.net/hosted/MBMonsWallPart2.rar</a>
<br /><br /><a href="https://web.archive.org/web/20100522162615/http://www.doomcentral.net/tut1.php" class="postlink">http://www.doomcentral.net/tut1.php</a></div>]]></body></post><post id="p58421" date="Posted: Fri Oct 22, 2004 1:03 pm "><author>pbmax</author><body><![CDATA[<div class="postbody">mbolus, i have a question for you...
<br /><br />when you copy the spawn arguments of an imp, remove that imp and then respawn another imp (using most of the copied spawn arguments), do the animations line up correctly between the two???
<br /><br />for example, if it was in the middle of tossing a fireball at you, and you replace it with a new imp, does the new imp continue to throw the fireball at you as if nothing happened???</div>]]></body></post><post id="p58653" date="Posted: Sat Oct 23, 2004 5:07 pm "><author>MBolus</author><body><![CDATA[<div class="postbody"><div class="quotetitle">pbmax wrote:</div><div class="quotecontent">mbolus, i have a question for you...when you copy the spawn arguments of an imp, remove that imp and then respawn another imp (using most of the copied spawn arguments), do the animations line up correctly between the two???<br />for example, if it was in the middle of tossing a fireball at you, and you replace it with a new imp, does the new imp continue to throw the fireball at you as if nothing happened???</div>
<br />Strictly speaking, the lineup can be imperfect if you use that simple method. What I have found is that you should explicitly specify args that absolutely must be updated since the previous spawn. Let me know how it works with your project, but you normally won't have to do a setSpawnArg for certain things like:
<br />     attack_cone
<br />     cinematic (e.g., for visibility with Monster Cam or other cameras)
<br />     name
<br />     on_activate
<br />     ragdoll (but you could change this if you want)
<br /><br />I do a setSpawnArg for <span style="font-weight: bold">origin</span> after doing a getWorldOrigin on an entity that I am replacing. If you don't set the <span style="font-weight: bold">anim</span> and <span style="font-weight: bold">frame</span> it might not get noticed, but be aware that merely using copySpawnArgs will leave those as they initially were. 
<br /><br />On a similar subject, I am about to test health, and anticipate a getHealth and setHealth or setSpawnArg or similar combination would be useful for it.</div>]]></body></post></posts></thread></xml>
